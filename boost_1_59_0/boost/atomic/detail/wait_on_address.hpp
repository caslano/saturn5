/*
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * Copyright (c) 2021 Andrey Semashev
 */
/*!
 * \file   atomic/detail/wait_on_address.hpp
 *
 * This header contains declaration of runtime detection of \c WaitOnAddress and related APIs on Windows.
 */

#ifndef BOOST_ATOMIC_DETAIL_WAIT_ON_ADDRESS_HPP_INCLUDED_
#define BOOST_ATOMIC_DETAIL_WAIT_ON_ADDRESS_HPP_INCLUDED_

#include <boost/atomic/detail/config.hpp>
#include <boost/static_assert.hpp>
#include <boost/memory_order.hpp>
#include <boost/winapi/basic_types.hpp>
#include <boost/atomic/detail/link.hpp>
#include <boost/atomic/detail/once_flag.hpp>
#include <boost/atomic/detail/header.hpp>

#ifdef BOOST_HAS_PRAGMA_ONCE
#pragma once
#endif

namespace boost {
namespace atomics {
namespace detail {

typedef boost::winapi::BOOL_ BOOST_WINAPI_WINAPI_CC
wait_on_address_t(
    volatile boost::winapi::VOID_* addr,
    boost::winapi::PVOID_ compare_addr,
    boost::winapi::SIZE_T_ size,
    boost::winapi::DWORD_ timeout_ms);

typedef boost::winapi::VOID_ BOOST_WINAPI_WINAPI_CC
wake_by_address_t(boost::winapi::PVOID_ addr);

extern BOOST_ATOMIC_DECL wait_on_address_t* wait_on_address;
extern BOOST_ATOMIC_DECL wake_by_address_t* wake_by_address_single;
extern BOOST_ATOMIC_DECL wake_by_address_t* wake_by_address_all;

extern BOOST_ATOMIC_DECL once_flag wait_functions_once_flag;
BOOST_ATOMIC_DECL void initialize_wait_functions() BOOST_NOEXCEPT;

BOOST_FORCEINLINE void ensure_wait_functions_initialized() BOOST_NOEXCEPT
{
    BOOST_STATIC_ASSERT_MSG(once_flag_operations::is_always_lock_free, "Boost.Atomic unsupported target platform: native atomic operations not implemented for bytes");
    if (BOOST_LIKELY(once_flag_operations::load(wait_functions_once_flag.m_flag, boost::memory_order_acquire) == 0u))
        return;

    initialize_wait_functions();
}

} // namespace detail
} // namespace atomics
} // namespace boost

#include <boost/atomic/detail/footer.hpp>

#endif // BOOST_ATOMIC_DETAIL_WAIT_ON_ADDRESS_HPP_INCLUDED_

/* wait_on_address.hpp
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
*/