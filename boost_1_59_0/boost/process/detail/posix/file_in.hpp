// Copyright (c) 2006, 2007 Julio M. Merino Vidal
// Copyright (c) 2008 Ilya Sokolov, Boris Schaeling
// Copyright (c) 2009 Boris Schaeling
// Copyright (c) 2010 Felipe Tanus, Boris Schaeling
// Copyright (c) 2011, 2012 Jeff Flinn, Boris Schaeling
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_POSIX_FILE_IN_HPP
#define BOOST_PROCESS_DETAIL_POSIX_FILE_IN_HPP

#include <boost/process/pipe.hpp>
#include <boost/process/detail/posix/handler.hpp>
#include <boost/process/detail/posix/file_descriptor.hpp>
#include <boost/process/detail/used_handles.hpp>
#include <cstdio>
#include <unistd.h>

namespace boost { namespace process { namespace detail { namespace posix {

struct file_in : handler_base_ext, ::boost::process::detail::uses_handles
{
    file_descriptor file;
    int handle = file.handle();

    std::array<int, 2> get_used_handles()
    {
        return {{STDIN_FILENO, handle}};
    }

    template<typename T>
    file_in(T&& t) : file(std::forward<T>(t)) {}
    file_in(FILE * f) : handle(fileno(f)) {}

    template <class WindowsExecutor>
    void on_exec_setup(WindowsExecutor &e) const
    {
        if (::dup2(handle, STDIN_FILENO) == -1)
             e.set_error(::boost::process::detail::get_last_error(), "dup2() failed");
    }
};

}}}}

#endif

/* file_in.hpp
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
*/