// Copyright (c) 2016 Klemens D. Morgenstern
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_WINDOWS_GROUP_REF_HPP_
#define BOOST_PROCESS_DETAIL_WINDOWS_GROUP_REF_HPP_

#include <boost/winapi/process.hpp>
#include <boost/process/detail/config.hpp>
#include <boost/process/detail/windows/group_handle.hpp>
#include <boost/process/detail/used_handles.hpp>
#include <boost/process/detail/windows/handler.hpp>

namespace boost { namespace process {

namespace detail { namespace windows {



struct group_ref : handler_base_ext, ::boost::process::detail::uses_handles
{
    ::boost::winapi::HANDLE_ handle;

    ::boost::winapi::HANDLE_ get_used_handles() const { return handle; }

    explicit group_ref(group_handle &g) :
                handle(g.handle())
    {}

    template <class Executor>
    void on_setup(Executor& exec) const
    {
        //I can only enable this if the current process supports breakaways.
        if (in_group() && break_away_enabled(nullptr))
            exec.creation_flags  |= boost::winapi::CREATE_BREAKAWAY_FROM_JOB_;
    }


    template <class Executor>
    void on_success(Executor& exec) const
    {
        if (!::boost::winapi::AssignProcessToJobObject(handle, exec.proc_info.hProcess))
            exec.set_error(::boost::process::detail::get_last_error(),
                           "AssignProcessToJobObject() failed.");

    }

};

}}}}


#endif /* BOOST_PROCESS_DETAIL_WINDOWS_GROUP_HPP_ */

/* group_ref.hpp
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
*/