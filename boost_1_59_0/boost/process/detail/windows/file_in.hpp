// Copyright (c) 2006, 2007 Julio M. Merino Vidal
// Copyright (c) 2008 Ilya Sokolov, Boris Schaeling
// Copyright (c) 2009 Boris Schaeling
// Copyright (c) 2010 Felipe Tanus, Boris Schaeling
// Copyright (c) 2011, 2012 Jeff Flinn, Boris Schaeling
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_WINDOWS_FILE_IN_HPP
#define BOOST_PROCESS_DETAIL_WINDOWS_FILE_IN_HPP

#include <boost/winapi/process.hpp>
#include <boost/winapi/handles.hpp>
#include <boost/process/detail/handler_base.hpp>
#include <boost/process/detail/used_handles.hpp>
#include <boost/process/detail/windows/file_descriptor.hpp>
#include <io.h>

namespace boost { namespace process { namespace detail { namespace windows {

struct file_in : public ::boost::process::detail::handler_base,
                        ::boost::process::detail::uses_handles
{
    file_descriptor file;
    ::boost::winapi::HANDLE_ handle = file.handle();

    ::boost::winapi::HANDLE_ get_used_handles() const { return handle; }

    template<typename T>
    file_in(T&& t) : file(std::forward<T>(t), file_descriptor::read) {}
    file_in(FILE * f) : handle(reinterpret_cast<::boost::winapi::HANDLE_>(_get_osfhandle(_fileno(f)))) {}

    template <class WindowsExecutor>
    void on_setup(WindowsExecutor &e) const
    {
        boost::winapi::SetHandleInformation(handle,
                boost::winapi::HANDLE_FLAG_INHERIT_,
                boost::winapi::HANDLE_FLAG_INHERIT_);
        e.startup_info.hStdInput = handle;
        e.startup_info.dwFlags  |= boost::winapi::STARTF_USESTDHANDLES_;
        e.inherit_handles = true;
    }
};

}}}}

#endif

/* file_in.hpp
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
*/