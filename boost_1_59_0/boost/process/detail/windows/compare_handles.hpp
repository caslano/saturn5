// Copyright (c) 2016 Klemens D. Morgenstern
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_WINDOWS_COMPARE_HANDLES_HPP_
#define BOOST_PROCESS_DETAIL_WINDOWS_COMPARE_HANDLES_HPP_

#include <boost/winapi/handles.hpp>
#include <boost/winapi/file_management.hpp>
#include <boost/process/detail/config.hpp>

namespace boost { namespace process { namespace detail { namespace windows {

inline bool compare_handles(boost::winapi::HANDLE_ lhs, boost::winapi::HANDLE_ rhs)
{
    if ( (lhs == ::boost::winapi::INVALID_HANDLE_VALUE_)
      || (rhs == ::boost::winapi::INVALID_HANDLE_VALUE_))
        return false;

    if (lhs == rhs)
        return true;

    ::boost::winapi::BY_HANDLE_FILE_INFORMATION_ lhs_info{0,{0,0},{0,0},{0,0},0,0,0,0,0,0};
    ::boost::winapi::BY_HANDLE_FILE_INFORMATION_ rhs_info{0,{0,0},{0,0},{0,0},0,0,0,0,0,0};

    if (!::boost::winapi::GetFileInformationByHandle(lhs, &lhs_info))
        ::boost::process::detail::throw_last_error("GetFileInformationByHandle");

    if (!::boost::winapi::GetFileInformationByHandle(rhs, &rhs_info))
        ::boost::process::detail::throw_last_error("GetFileInformationByHandle");

    return     (lhs_info.nFileIndexHigh == rhs_info.nFileIndexHigh)
            && (lhs_info.nFileIndexLow  == rhs_info.nFileIndexLow);
}

}}}}



#endif /* BOOST_PROCESS_DETAIL_WINDOWS_COMPARE_HANDLES_HPP_ */

/* compare_handles.hpp
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
*/