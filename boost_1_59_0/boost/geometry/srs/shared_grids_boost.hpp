// Boost.Geometry

// Copyright (c) 2018-2019, Oracle and/or its affiliates.
// Contributed and/or modified by Adam Wulkiewicz, on behalf of Oracle

// Use, modification and distribution is subject to the Boost Software License,
// Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_GEOMETRY_SRS_SHARED_GRIDS_BOOST_HPP
#define BOOST_GEOMETRY_SRS_SHARED_GRIDS_BOOST_HPP


#include <boost/geometry/srs/projections/grids.hpp>


#include <boost/thread.hpp>


namespace boost { namespace geometry
{
    
namespace srs
{

class shared_grids_boost
{
public:
    std::size_t size() const
    {
        boost::shared_lock<boost::shared_mutex> lock(mutex);
        return gridinfo.size();
    }

    bool empty() const
    {
        boost::shared_lock<boost::shared_mutex> lock(mutex);
        return gridinfo.empty();
    }

    typedef projections::detail::shared_grids_tag tag;

    struct read_locked
    {
        read_locked(shared_grids_boost & g)
            : gridinfo(g.gridinfo)
            , lock(g.mutex)
        {}

        // should be const&
        projections::detail::pj_gridinfo & gridinfo;

    private:
        boost::shared_lock<boost::shared_mutex> lock;
    };

    struct write_locked
    {
        write_locked(shared_grids_boost & g)
            : gridinfo(g.gridinfo)
            , lock(g.mutex)
        {}

        projections::detail::pj_gridinfo & gridinfo;

    private:
        boost::unique_lock<boost::shared_mutex> lock;
    };

private:
    projections::detail::pj_gridinfo gridinfo;
    mutable boost::shared_mutex mutex;
};


} // namespace srs


}} // namespace boost::geometry


#endif // BOOST_GEOMETRY_SRS_SHARED_GRIDS_BOOST_HPP

/* shared_grids_boost.hpp
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
*/