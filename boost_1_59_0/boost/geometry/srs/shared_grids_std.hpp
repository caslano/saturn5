// Boost.Geometry

// Copyright (c) 2018-2019, Oracle and/or its affiliates.
// Contributed and/or modified by Adam Wulkiewicz, on behalf of Oracle

// Use, modification and distribution is subject to the Boost Software License,
// Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_GEOMETRY_SRS_SHARED_GRIDS_STD_HPP
#define BOOST_GEOMETRY_SRS_SHARED_GRIDS_STD_HPP


#include <boost/config.hpp>

#ifdef BOOST_NO_CXX14_HDR_SHARED_MUTEX
#error "C++14 <shared_mutex> header required."
#endif

#include <boost/geometry/srs/projections/grids.hpp>

#include <mutex>
#include <shared_mutex>


namespace boost { namespace geometry
{
    
namespace srs
{

class shared_grids_std
{

// VS 2015 Update 2
#if defined(_MSC_FULL_VER) && (_MSC_FULL_VER >= 190023918)
    typedef std::shared_mutex mutex_type;
// Other C++17
#elif !defined(BOOST_NO_CXX14_HDR_SHARED_MUTEX) && (__cplusplus > 201402L)
    typedef std::shared_mutex mutex_type;
#else
    typedef std::shared_timed_mutex mutex_type;
#endif

public:
    std::size_t size() const
    {
        std::shared_lock<mutex_type> lock(mutex);
        return gridinfo.size();
    }

    bool empty() const
    {
        std::shared_lock<mutex_type> lock(mutex);
        return gridinfo.empty();
    }

    typedef projections::detail::shared_grids_tag tag;

    struct read_locked
    {
        read_locked(shared_grids_std & g)
            : gridinfo(g.gridinfo)
            , lock(g.mutex)
        {}

        // should be const&
        projections::detail::pj_gridinfo & gridinfo;

    private:
        std::shared_lock<mutex_type> lock;
    };

    struct write_locked
    {
        write_locked(shared_grids_std & g)
            : gridinfo(g.gridinfo)
            , lock(g.mutex)
        {}

        projections::detail::pj_gridinfo & gridinfo;

    private:
        std::unique_lock<mutex_type> lock;
    };

private:
    projections::detail::pj_gridinfo gridinfo;
    mutable mutex_type mutex;
};


} // namespace srs


}} // namespace boost::geometry


#endif // BOOST_GEOMETRY_SRS_SHARED_GRIDS_STD_HPP

/* shared_grids_std.hpp
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
*/