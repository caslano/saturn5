//          Copyright Oliver Kowalke 2013.
// Distributed under the Boost Software License, Version 1.0.
//    (See accompanying file LICENSE_1_0.txt or copy at
//          http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_FIBERS_ALGO_ROUND_ROBIN_H
#define BOOST_FIBERS_ALGO_ROUND_ROBIN_H

#include <condition_variable>
#include <chrono>
#include <mutex>

#include <boost/config.hpp>

#include <boost/fiber/algo/algorithm.hpp>
#include <boost/fiber/context.hpp>
#include <boost/fiber/detail/config.hpp>
#include <boost/fiber/scheduler.hpp>

#ifdef BOOST_HAS_ABI_HEADERS
#  include BOOST_ABI_PREFIX
#endif

#ifdef _MSC_VER
# pragma warning(push)
# pragma warning(disable:4251)
#endif

namespace boost {
namespace fibers {
namespace algo {

class BOOST_FIBERS_DECL round_robin : public algorithm {
private:
    typedef scheduler::ready_queue_type rqueue_type;

    rqueue_type                 rqueue_{};
    std::mutex                  mtx_{};
    std::condition_variable     cnd_{};
    bool                        flag_{ false };

public:
    round_robin() = default;

    round_robin( round_robin const&) = delete;
    round_robin & operator=( round_robin const&) = delete;

    void awakened( context *) noexcept override;

    context * pick_next() noexcept override;

    bool has_ready_fibers() const noexcept override;

    void suspend_until( std::chrono::steady_clock::time_point const&) noexcept override;

    void notify() noexcept override;
};

}}}

#ifdef _MSC_VER
# pragma warning(pop)
#endif

#ifdef BOOST_HAS_ABI_HEADERS
#  include BOOST_ABI_SUFFIX
#endif

#endif // BOOST_FIBERS_ALGO_ROUND_ROBIN_H

/* round_robin.hpp
EOzQmLevIlm1QuvkBMh9F02etNGry0OtDdNCBfc/jj54htBUca5bMNJTepqOSALjbrNnsjxpZ/MyGQjsdll7xcbm91dFJrmYrNYvpN/Sn8BHtkPSaiYKYaeIbTUzbY7S90j2ExSZXda8vWEcsKMobvZZ49fW9gyvtjbgavAI0WcSEKmSDKxTiCeBEMJZZOnzNkfXH0qrJbTcCpDU+qR/l554YnL4wgaWZmgjQr4ql6y4pWpVK2kjBPoGK2yKgmCGN/SPoriDwoB68bGG4j0qEp7jv3lniWOiBTPhdVEeAQddE1WCuNOQuo4E39OmClqotOzhw1Y2Uce/vHpEkGjnl8JPj3gokKkMXUmbOzOfmbvgKzHB+LqYY+HWW1jSQllCARiTiQZ2CBoCQP+xsT6J5G2x2Iva1GX7KtB5mM4t9n5DOhvePIGlVlIisZNPn/Ba4fSJSYIZFCeSl6L8pMfo09fAfgAsldqcR2fEhPZ9flLVwhBHf/YTOe/sQV99g0c7SWQvphjiIJqrwCxccs7jWy+fKBe3lhR5vl8jSYn6oBzN5Ac5Bu5GiJ9U6Jx+N797m3zWSySqDN2Ns+D67GiC7WQ/Imu8l0du26d1uCp4uolT6n8JGfsjVDfZs2krBAK6uvyEcvhyC9fQbBKQTsGhYWoAjUIsUEwXSZ6YPWNwm9EdaLLjktN2nFtcyo4JnPsclz8utAQDWCgOM6Gzj7oeuVI/B+D6Mh1oHn2F4LtWACAGRpnYk89V+N4YwYKdR45jvGtDPf6WtYk9gHbS9sTm1zVejB9nsxA49jSCYFxwqsfBhoj734NOJC1ATqTPmu9e4/J3xJ+f4Z9U9nIb3GG276EznB/cn1CdSxybn+/3PT23dRYVNxAY0wm3iFURiGECQ95wA8zpWD0JXQSPMOh5gmZE1kyJNjvQcCaN8iyCahCr8V5qGRFT9vOi8jCoIH1Q0WqJmFVmBHc1zex0GHhjTMB5TjGA7YQLtKiG/SIwfnCt7+4JW3+S0PCriiRQYES/oL9AV6qdFfFCtxBhyaHsmdmDt5qNHpq7N0slA73dmjuryhrRR+KxsrjZVBC+/dBqgyGqkyG6rj9kTgtHreL3/UAEhw9xizlelp5+iKEkTspzWYgOQ5sm4knJ17rJ/aaqUC56bNpeD3pv20ZJPSx9Cm8EyasDBB4N0DYIPTsQ+kPDX7Mu8t3cRBhZrVIIpLrPFaNiJ5VHR2fhbfB55fZOWMYE4r4eh6DPoYcppnU7tUItRhNitObM5gQS4080p2CtBnibm3uh+0lpm0HRdYZ9zAw6mTlz832FxvLaE/EV9Ydci/kPDMHleD1Hn40vCBZqWuxpsnl4eXxe0rpS2RNsUrg0toyYd1GLFIkydi59UzGmNg7JrFF6bSq4BP8oRLAjEEK2iIE27YRDhXWtDkoLaLlKZtllJV1ohwaBCHo3CGz0wxYcMI1sTsay7VHdrfJ1fwdiRbBHZHsc+8FMlx0KVTH1dic3mEon1J6b3ToMOcNBYDtxOfY7TlQoef/kqruga8kUmhrolOoEQSxrkPXI+y3fxX7W64Nbr+qY6XGaEdS3T0P+1gQFVfdItmCEcWo5PAYVwo6K5pwJ2Y5MAfqxMChZeByMGTqAU66BdIjnHKawibYokxW7HP4kX1Y16gJrl5SxmkxptiPb4uKLRuIuNQDJDlqQNa+hhbBeEW3OhNVh+XQXd6djZ0uiQpGEzf6/9h/hI9kzJeRuEoAeInX3JW9jlr5GXQ5ImQ5hiEdaXOQ2gWFZUt7XnWl6JWwS3CeuGZdfPz8//pYAAAG/An8F/Qr+FfIr9FfYr/BfEb8if0X9iv4V8yv2V9yv+F8JvxJ/Jf1K/pXyK/VX2q/0Xxm/Mn9l/cr+lfMr91fer/xfBb8KfxX9Kv5V8qv0V9mv8l8Vvyp/Vf2q/lXzq/ZX3a/6Xw2/Gn81/Wr+1fKr9Vfbr/ZfHb86f3X96v7V86v3V9+v/l8DvwZ/Df0a/jXya/TX2K/xXxO/Jn9N/Zr+NfNr9tfcr/lfC78Wfy39Wv618mv119qv9V8bvzZ/bf3a/rXza/fX3q/9Xwe/Dn8d/Tr+dfLr9NfZr/NfF78uf139uv518+v2192v+18Pvx5/Pf16/vXy6/XX26/3Xx+/Pn99/fr+BWD1u/69+09BFPqJK/zYRxE3JezFpbA95ChSJDLF/iP8Hr3mRP5cheovf2GKic64zoJQ+mEntQH6fh4z+pThni8hwqFGEvIsWYJWiskupdz30397cOMHIwP7AaC81Vjc+lTOe/e1dA2rGp/YWbdAPoaHLwh1vWgkuY6HSiczFTyv5nmlF/9kxlVuFmrOo1Vu3h5FLOsu7t21QHhVcMtlcMu5vgBE6OhzYw8afcKpJyGJ+LkA0j9Fv7X5Vh2h4gLRCchFwPivYSHOQca7nyDJdTPhyDuRNDDllyUJhksGa4TRxFUKQm2nc7jBnVZ/LHzKkg4B1mjC0Uiuz1HOV9r/pO/Wv/6ltUFwup+RmW8n3k8MNknI7sJRz1KEPtZw9APW9c7Civc6KoKpHfbITWVDvvwuq/17Tpk4fa8UT3OqqmyEsIoGwKfPtkND4DaNju9nL29F/ZIrNprvJ0qHrHhGVJ1WHdL93HcDmnAuC+K4nLr65IuXYMxvvrguR+1zGM3Kn9VS0lVJrNLiX+Cv+hdhGJU3W1IoskMQlxTYDY/feSJPOYXdfUNnTG1CkId5SdvhDkSn3nquoBAW0XYdae/EjRixluemBMcd+m0DcY9KOT1pADUsxRwGu8ad5dPdiMWn+gpJcOdbs2f5SdeOMtaiCUoBEmZwsKfhCgXw5ju/KRNS2tBt3SAtBz81F0u7meZCGYMhLdRyFy2GdK0bpt0bYwoz81QS9RuJhD1KiY6+lyo4tkEVtKfuA5rnE/Q4XNj9/OjGPYQDS58wEuN0iUuftXwOgD0Po+CAiG8eylpPKWLKbn+nNCbU60xpsTgq4JFMQqHYuHbBZzNeM6T838Mo91Lj46AG5I2102XOfBKVnGVH9w65vemLVtbTjuPD2AsQERmOUSMzgei/1VCXHa7qjL6i8LUknzkVnRdYQh0jLfP6iEVX23vyVFsiD9pcBRYs1Ctu4WQONYshvVydTtRkiCe/5kc/itu5GlMjQMiYGPMi5vKvw9KGos6ktTYxxnYTgqdDz+2X8pNmbaYMvivur2KXZUYN0Ni91betJ0eIc6UopEUJhuYg073HUkTujgWoYkykOSdSusWv2eU0y9o/QQyzT2G3oCraoOcnQh1br+a8E/Ryx8NGJ+qFiqckQH8pk/y0gcxeKh+M3dVH4UidUTQkxUw7MXifQtNFSJpII3bMoqw0ZgL03fAsoWS7rXzWHgNynWNmvTpNMKxHQ6u3lYmfY2ri0fUr8/c9/dlatnW/Li/rxHLhQFKkEE7DE3OlZ4lOoU/PUTCcpiqSj5tfoJaevV7E6/CRvmvJLWz8b0mZwX88QdgGZi63GwwlnJ9N8Flg/vrEvGQDra+9dAS3ETVqv8qWsvU44MxHcUCodui6xqMZI7Zrpo7eupdeqxHU8jU/OAi72vqP4zdY/oUlqenwGDD0S81nIkR4M9t1u//ELPKO2OOyD0kTfIAu0ukFx4uxHbbz9pE9kbjxDXRbPokxydK5zQ2lTpilWu5msnjuOi4P7Tqlp5l1ssP1NGkA3Kd/L+R2mC4isEkOvAy0I8jD5sHtNDfBudMFyb2QXhVPArQtLvI3r+nz4PZozJzBiD7xrukpT3eYUUD1XukpQ8K/V//AFiAfio2YcBPViXHhETSXC9uBTfh4chMfQtTzK3r+C3ZfASR1bX3C6m4+64grNyoNHGCMIw7rKPNVerkr9cYVR7JyrTKCh77n72IP6/99f8Ky8O+Pj5YIc9x6EPt+O/c1By5ku+H81mZ6vCqF3XoVsp0zpxeDhRT4NDSbrEwbPMIiSeDqGpZCtIIqIZ1sRr5XkP/p0dZAFMF7TnWbweQYrTQYiwZyplAnBuiEzhruq3LhO4qhhNOIwkIz0FeEej1H+8N6gaNRzPzCcAHjQe5Ni4mjxN1xoEOWTiKlTq5qGYXzawguiBeq8DNSWijYnmMt3pqtIzBMW25A6tfEvwi29gUsagMpS3gMJUTEa+F7I/eud/CUYPGnTRTHdViVZ2OutQwmkn7pKbWbbk7PE+myjcgFmpY+HVHdnMW3SxpBwD1zHdTVa2LnXtkBgmHFPP8uXkxYOW8gZWIVFX4UP9MXEb+r907JboK5mxVHBYLHYdeVMu5o7n3n61yp7QrUfMfn4ZVKf4av7b8pgOuTy5eSlhoNRAcjOq+HKLQ+U2HzPEZ7tiHvka1nTMeTrJ3Ir9fG+EaplLYpDvIsNwyXUO3VrPYniowsm1dI7is8ls8yjsHBsZ7ugcrRaYdaJvG4F2Wu5dVAWRg+8HnKqYFJ+R4i1qjmkGsqj6ZZMUP/YBifB87YTfIE73hZJKHh78cJSrIozBU58HMFrohtIm2yirsKZOB+mlyOQCt33AXAzeP/yazd/vm2208oy2GY2+ypvJ06rfdZsjEQvzdDlh1ivldz5rTNKSK6s7LD0djL14Y52mIfIQk1vnEdlUXpxSL0Y0kxuELFvfgUlVAAcV+L6INIlUO+FbRu/xRO9FgsFbOx1EwZI8RIEGFkVsPXhyC0qwmwH3xaqZwwLeFSNPUMxp6iUoNFw6Bdb4p6KP0k/edRLrN0kzv5FnbbjuSgx760ZTF87AzaH1KXq+2pCrr2EpbEPL17sN2AdnmxdTtQYM2ZjN919wpQjfmuD0O2zCKQ3EKQ7UiStkCfbXDC5DytKjQH/M8D5cpBUHZlO3GyNoktI4xLzhzGDwbfB6GwL87GfbsSaWZzcYwYT0TFMsI3xf41S68b2q+QPvRRLAolLarEzetb+4a+Yu5by6/k8fm7Q4GeQD3GPmoDYmqkZ1Brj0zp0ZzIM+o2LhXZmaQHTX9zCwUmQ65fRVxRRWwOYkkHM5xw4AqwjjFpFa6ddO0h6sXz+0Ih75NAv7VZovMDlfb9gfmMcwPUbtPkaiBSZEKNWc94WW/U8wX464/Cwyjk+pRrVB+dXRaiZTGij2zpSu9TklOsGAybEvWYniYcrEkaBDSDPVuuhAFH16Bxsf6oP5XIg2UK60TMx1DnYhFEpsq9vLaaKwniMCcvZEg43DhTHpXZzA5dSlER5duCMW2XBric8jrx8fMmO82+UZ0jEnUgg/M3fJoIAtsBu3bD4D3YM0P2BMP7QczNC+uPYv5DX/vmreKhwRfmIJK09CKxyu4UahiQm86nckvXM79N9QYB/T1m/Rj5XdVdXViu/WI+9TampJDoLDPi41iwz4MUgdxAASmgWqUNm3c50eEfBsjoVZbuiGIF0d7dby6empcgprydPdivDY3IdJEs5DMPra3LeKBbwBhDJtNbHc1h6OrCp1fBj93KkYjsrDJzwVJsMtnJ9s7UVk2LmRPe9z6ljTXzHwXqp4YwSDa03Jxwe39D2c/DMVB4/TgqDg2E7BaCuUvrFJv2Y+m9cvcu5jZuLRETOyXQXh/m9sekd8glmxxuxU7rt0899l0SUIzwWTnCIOxZP27Feg/sS7mg3s9B36hyltnWPcJUIrQ9gB2KSA52T+9kptct8avu+3ysZ7YFVDXQSqIxBsD2VFofXyzmyJgLlftVMZCTI5eeu0N4+Q9OvM0eLEvydN+HHb2evWQcQwDRuSo26EFUNOZmksqye+qrXdBYugV4DigmygIpfQgxBvjyOXpHWAXGr2fhWrn7h9oISTxdWP+tPQBh/EsUT32imMr9nvBapZuk/eZ+w+2rHaNB2qsTiEY8beCrJJYsDJXwB0wx7Dc/jnNJiKTJDvkSLQz1rFO99wZjCV1nHQDpK5AM5bwtqeAewXqwsJD3IEuXl128Ognn/rxlkb5uxyzdKIwn7AJ2c1DHazQKAD/Xc+Kl0ceDvG0YSNcuN1dFWtwJo+E8Vl3wwIplieGV8qd5cHogAtT8Ec9d/jlObaNdk5l7d7BXaKQgRq7yb7cPqcJyqywL4AHDJOVAceQir7AhXfFAyPk5dJ7Xa/zdUm7KGj8AGzaUyPvjvxAueywtwtfhDVJ8wP04sFU7RHZOQ9MUlLS1KNEyj5In21wWZV/vAkmcJfaxdxPzxIcTn73ESQg0q2qvcqLVhjk8hA6t0qbuKIGrK/amb1jatmnOU0Ru5/ibZ3eXM0VV15g/ns+ayKeEao28YAGDJW9cRCRf3mQh5QJUzHa6v8fch2Iz66BiKyJllJu3h86oWxUxC2BPwgTI13+GJKSWoPgW1MTA4Leg36vAdb3jtGBWvx1rdV9iG9NFC3BJ5PdUcc6IKIi1wFKV8EWXRsw5IhP3r1P0ZqjHT+j+RRv7jeiJ1ZfZxLWXc/MBzMkrxqmHdCcDqivDRMC1G0dXem7RFqMMUkOeIt9zAEOB/o/phYNCS3V3M6oNn2gXgu0Irale0CtxRjU1KqdoLXZc+wuNcGy+kuisxz531gv1vDKoSbyDg2PHgEkE0ss7v7Yn3SU1BpR+3F7Sq5DJVBKk7d/iwImOFzY6OoOLadc/Q9S4W3LJ0ndfH9N2NzfxI5E6z0IjQIIYkmGKdUVYC25JYlD80DIZNIbyaS9eGSkvBMtAse3G3l4Z9N+Y5oNRmGOsL5LBbH/dTeHutykcXKNhrVwY/aD5Q1NqFt8pIPPQ6iOje0+4PD2ymRfTp52pO6vJjbcPgUtyDdQQERKWtYSmmmBfTg4WTdCGrBzz9E9wO65qpM9BsaLoF7fMegxXLk/SPpd8754usBi/ew6KgWO8vDb3pwqGwi98raZlJTJ2M7vBBB0p5ylcwhsWEhiXKBKMCQFnjkpWnIHNqH0HhfSFAQ4+v9fhZzDre11as93GcLzWOihomN6bG7p0OWWGM26gK+OZX2fapJM2E9FFscZ4riOd0AmWxpj0iTt/SOOEN/fn0D01TKKyElhlg/AEjorfm8PGsvjnvb43R2IFGBjTYXRVA7BvgH9DGc5WkKM96fKLIrjw4zW04NV2B07ttG0wobVDfG6F5uoQkXUmV1xDiPTlbVwd41ohdUxVCygZxz3OeBT8ekphOx7ClaY+ft42brMqSm4DbuoTBHAtOMELe99mIcBAOeLJIOuc+LIALqpHB7XdY4zFFmRHqkE2r3u7VEWQc2fG5zhBjJabTUv7kmi8i0bvbFSngleUgBntPkr4kGsvpPO8+uZMyEKEzASRvSCCQzNwPFXh7WGJpRrAGBGyJvQHJ0Asm/pfBNkGDx6Zi4/iz6NGY9aqt6l6GopWCbosEHp99uuNz/q38m9AEsktcXGS0k3o54lWbcwICnh7IDCkAseEIsdsxSb8SbFUWi3jnoStC2kp17uiZUAMmun9efoDX7v6XIvQVdvqwmMoHn0VdK8q0dwtwNjDkiCVVJ46OrcmxPgVelCle/CuxZLJOiyGEa629tmORiy+Xj0tmhGvaLrcLO1/g992ZDPgJmyJ39zXDiYM5+0Hcn+6Xi4GohJMt/DBVl5PEWeMIKBkKJfFhGuxjEWvu6tROAYisVd98cQVAK6thygAaIraHTMESEbvD9xzNGR6M2F8Xeph4fK1I6Al
*/