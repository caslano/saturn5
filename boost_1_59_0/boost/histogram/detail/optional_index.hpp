// Copyright 2019 Hans Dembinski
//
// Distributed under the Boost Software License, Version 1.0.
// (See accompanying file LICENSE_1_0.txt
// or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_HISTOGRAM_DETAIL_OPTIONAL_INDEX_HPP
#define BOOST_HISTOGRAM_DETAIL_OPTIONAL_INDEX_HPP

#include <cassert>
#include <cstdint>

namespace boost {
namespace histogram {
namespace detail {

constexpr auto invalid_index = ~static_cast<std::size_t>(0);

// integer with a persistent invalid state, similar to NaN
struct optional_index {
  std::size_t value;

  optional_index& operator=(std::size_t x) noexcept {
    value = x;
    return *this;
  }

  optional_index& operator+=(std::intptr_t x) noexcept {
    assert(x >= 0 || static_cast<std::size_t>(-x) <= value);
    if (value != invalid_index) { value += x; }
    return *this;
  }

  optional_index& operator+=(const optional_index& x) noexcept {
    if (value != invalid_index) return operator+=(x.value);
    value = invalid_index;
    return *this;
  }

  operator std::size_t() const noexcept { return value; }

  friend bool operator<=(std::size_t x, optional_index idx) noexcept {
    return x <= idx.value;
  }
};

constexpr inline bool is_valid(const std::size_t) noexcept { return true; }

inline bool is_valid(const optional_index x) noexcept { return x.value != invalid_index; }

} // namespace detail
} // namespace histogram
} // namespace boost

#endif

/* optional_index.hpp
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
*/