// Copyright 2015-2018 Hans Dembinski
//
// Distributed under the Boost Software License, Version 1.0.
// (See accompanying file LICENSE_1_0.txt
// or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_HISTOGRAM_DETAIL_COMMON_TYPE_HPP
#define BOOST_HISTOGRAM_DETAIL_COMMON_TYPE_HPP

#include <boost/histogram/detail/detect.hpp>
#include <boost/histogram/fwd.hpp>
#include <boost/mp11/list.hpp>
#include <boost/mp11/utility.hpp>
#include <tuple>
#include <type_traits>

namespace boost {
namespace histogram {
namespace detail {
// clang-format off
template <class T, class U>
using common_axes = mp11::mp_cond<
  is_tuple<T>, T,
  is_tuple<U>, U,
  is_sequence_of_axis<T>, T,
  is_sequence_of_axis<U>, U,
  std::true_type, T
>;
// clang-format on

// Non-PODs rank highest, then floats, than integers; types with more capacity are higher
template <class Storage>
constexpr std::size_t type_rank() {
  using T = typename Storage::value_type;
  return !std::is_arithmetic<T>::value * 10000 + std::is_floating_point<T>::value * 100 +
         10 * sizeof(T) + 2 * is_array_like<Storage>::value +
         is_vector_like<Storage>::value;
  ;
}

template <class T, class U>
using common_storage = mp11::mp_if_c<(type_rank<T>() >= type_rank<U>()), T, U>;
} // namespace detail
} // namespace histogram
} // namespace boost

#endif

/* common_type.hpp
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
*/