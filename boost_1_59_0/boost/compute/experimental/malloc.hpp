//---------------------------------------------------------------------------//
// Copyright (c) 2013 Kyle Lutz <kyle.r.lutz@gmail.com>
//
// Distributed under the Boost Software License, Version 1.0
// See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt
//
// See http://boostorg.github.com/compute for more information.
//---------------------------------------------------------------------------//

#ifndef BOOST_COMPUTE_EXPERIMENTAL_MALLOC_HPP
#define BOOST_COMPUTE_EXPERIMENTAL_MALLOC_HPP

#include <boost/compute/buffer.hpp>
#include <boost/compute/system.hpp>
#include <boost/compute/context.hpp>
#include <boost/compute/detail/device_ptr.hpp>

namespace boost {
namespace compute {
namespace experimental {

// bring device_ptr into the experimental namespace
using detail::device_ptr;

template<class T>
inline device_ptr<T>
malloc(std::size_t size, const context &context = system::default_context())
{
    buffer buf(context, size * sizeof(T));
    clRetainMemObject(buf.get());
    return device_ptr<T>(buf);
}

inline device_ptr<char>
malloc(std::size_t size, const context &context = system::default_context())
{
    return malloc<char>(size, context);
}

template<class T>
inline void free(device_ptr<T> &ptr)
{
    clReleaseMemObject(ptr.get_buffer().get());
}

} // end experimental namespace
} // end compute namespace
} // end boost namespace

#endif // BOOST_COMPUTE_EXPERIMENTAL_MALLOC_HPP

/* malloc.hpp
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
*/