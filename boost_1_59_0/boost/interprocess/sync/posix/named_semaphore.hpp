//////////////////////////////////////////////////////////////////////////////
//
// (C) Copyright Ion Gaztanaga 2005-2012. Distributed under the Boost
// Software License, Version 1.0. (See accompanying file
// LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//
// See http://www.boost.org/libs/interprocess for documentation.
//
//////////////////////////////////////////////////////////////////////////////

#ifndef BOOST_INTERPROCESS_POSIX_NAMED_CONDITION_HPP
#define BOOST_INTERPROCESS_POSIX_NAMED_CONDITION_HPP

#ifndef BOOST_CONFIG_HPP
#  include <boost/config.hpp>
#endif
#
#if defined(BOOST_HAS_PRAGMA_ONCE)
#  pragma once
#endif

#include <boost/interprocess/detail/config_begin.hpp>
#include <boost/interprocess/detail/workaround.hpp>

#include <boost/interprocess/sync/posix/semaphore_wrapper.hpp>

namespace boost {
namespace interprocess {

#if !defined(BOOST_INTERPROCESS_DOXYGEN_INVOKED)
namespace ipcdetail{ class interprocess_tester; }
#endif   //#ifndef BOOST_INTERPROCESS_DOXYGEN_INVOKED

namespace ipcdetail {

class posix_named_semaphore
{
   posix_named_semaphore();
   posix_named_semaphore(const posix_named_semaphore&);
   posix_named_semaphore &operator= (const posix_named_semaphore &);

   public:
   posix_named_semaphore
      (create_only_t, const char *name, unsigned int initialCount, const permissions &perm = permissions())
   {  semaphore_open(mp_sem, DoCreate, name, initialCount, perm);   }

   posix_named_semaphore(open_or_create_t, const char *name, unsigned int initialCount, const permissions &perm = permissions())
   {  semaphore_open(mp_sem, DoOpenOrCreate, name, initialCount, perm);   }

   posix_named_semaphore(open_only_t, const char *name)
   {  semaphore_open(mp_sem, DoOpen, name);   }

   ~posix_named_semaphore()
   {
      if(mp_sem != BOOST_INTERPROCESS_POSIX_SEM_FAILED)
         semaphore_close(mp_sem);
   }

   void post()
   {  semaphore_post(mp_sem); }

   void wait()
   {  semaphore_wait(mp_sem); }

   bool try_wait()
   {  return semaphore_try_wait(mp_sem); }

   template<class TimePoint>
   bool timed_wait(const TimePoint &abs_time)
   {  return semaphore_timed_wait(mp_sem, abs_time); }

   static bool remove(const char *name)
   {  return semaphore_unlink(name);   }

   private:
   friend class ipcdetail::interprocess_tester;
   void dont_close_on_destruction()
   {  mp_sem = BOOST_INTERPROCESS_POSIX_SEM_FAILED; }

   sem_t      *mp_sem;
};

}  //namespace ipcdetail {
}  //namespace interprocess {
}  //namespace boost {

#include <boost/interprocess/detail/config_end.hpp>

#endif   //#ifndef BOOST_INTERPROCESS_POSIX_NAMED_CONDITION_HPP

/* named_semaphore.hpp
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
*/