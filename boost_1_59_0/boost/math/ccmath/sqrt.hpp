//  (C) Copyright Matt Borland 2021.
//  Use, modification and distribution are subject to the
//  Boost Software License, Version 1.0. (See accompanying file
//  LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//
//  Constexpr implementation of sqrt function

#ifndef BOOST_MATH_CCMATH_SQRT
#define BOOST_MATH_CCMATH_SQRT

#include <cmath>
#include <limits>
#include <type_traits>
#include <boost/math/ccmath/isnan.hpp>
#include <boost/math/ccmath/isinf.hpp>
#include <boost/math/tools/is_constant_evaluated.hpp>

namespace boost::math::ccmath { 

namespace detail {

template <typename Real>
inline constexpr Real sqrt_impl_2(Real x, Real s, Real s2)
{
    return !(s < s2) ? s2 : sqrt_impl_2(x, (x / s + s) / 2, s);
}

template <typename Real>
inline constexpr Real sqrt_impl_1(Real x, Real s)
{
    return sqrt_impl_2(x, (x / s + s) / 2, s);
}

template <typename Real>
inline constexpr Real sqrt_impl(Real x)
{
    return sqrt_impl_1(x, x > 1 ? x : Real(1));
}

} // namespace detail

template <typename Real, std::enable_if_t<!std::is_integral_v<Real>, bool> = true>
inline constexpr Real sqrt(Real x)
{
    if(BOOST_MATH_IS_CONSTANT_EVALUATED(x))
    {
        return boost::math::ccmath::isnan(x) ? std::numeric_limits<Real>::quiet_NaN() : 
               boost::math::ccmath::isinf(x) ? std::numeric_limits<Real>::infinity() : 
               detail::sqrt_impl<Real>(x);
    }
    else
    {
        using std::sqrt;
        return sqrt(x);
    }
}

template <typename Z, std::enable_if_t<std::is_integral_v<Z>, bool> = true>
inline constexpr double sqrt(Z x)
{
    return detail::sqrt_impl<double>(static_cast<double>(x));
}

} // Namespaces

#endif // BOOST_MATH_CCMATH_SQRT

/* sqrt.hpp
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
*/