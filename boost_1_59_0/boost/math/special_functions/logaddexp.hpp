//  (C) Copyright Matt Borland 2022.
//  Use, modification and distribution are subject to the
//  Boost Software License, Version 1.0. (See accompanying file
//  LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#include <cmath>
#include <limits>
#include <boost/math/special_functions/fpclassify.hpp>
#include <boost/math/constants/constants.hpp>

namespace boost { namespace math {

// Calculates log(exp(x1) + exp(x2))
template <typename Real>
Real logaddexp(Real x1, Real x2) noexcept
{
    using std::log1p;
    using std::exp;
    using std::abs;
    
    // Validate inputs first
    if (!(boost::math::isfinite)(x1))
    {
        return x1;
    }
    else if (!(boost::math::isfinite)(x2))
    {
        return x2;
    }

    const Real temp = x1 - x2;

    if (temp > 0)
    {
        return x1 + log1p(exp(-temp));
    }

    return x2 + log1p(exp(temp));
}

}} // Namespace boost::math

/* logaddexp.hpp
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
*/