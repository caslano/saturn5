//  (C) Copyright Nick Thompson 2020.
//  Use, modification and distribution are subject to the
//  Boost Software License, Version 1.0. (See accompanying file
//  LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_MATH_TOOLS_AGM_HPP
#define BOOST_MATH_TOOLS_AGM_HPP
#include <limits>
#include <cmath>

namespace boost { namespace math { namespace tools {

template<typename Real>
Real agm(Real a, Real g)
{
    using std::sqrt;
    
    if (a < g)
    {
        // Mathematica, mpfr, and mpmath are all symmetric functions:
        return agm(g, a);
    }
    // Use: M(rx, ry) = rM(x,y)
    if (a <= 0 || g <= 0) {
        if (a < 0 || g < 0) {
            return std::numeric_limits<Real>::quiet_NaN();
        }
        return Real(0);
    }

    // The number of correct digits doubles on each iteration.
    // Divide by 512 for some leeway:
    const Real scale = sqrt(std::numeric_limits<Real>::epsilon())/512;
    while (a-g > scale*g)
    {
        Real anp1 = (a + g)/2;
        g = sqrt(a*g);
        a = anp1;
    }

    // Final cleanup iteration recovers down to ~2ULPs:
    return (a + g)/2;
}


}}}
#endif

/* agm.hpp
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
*/