// (C) Copyright 2005 Matthias Troyer 

// Use, modification and distribution is subject to the Boost Software
// License, Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt)

//  Authors: Matthias Troyer

#ifndef BOOST_MPI_DETAIL_FORWARD_SKELETON_IARCHIVE_HPP
#define BOOST_MPI_DETAIL_FORWARD_SKELETON_IARCHIVE_HPP

#include <boost/archive/detail/auto_link_archive.hpp>
#include <boost/archive/detail/iserializer.hpp>
#include <boost/archive/detail/interface_iarchive.hpp>
#include <boost/archive/detail/common_iarchive.hpp>
#include <boost/serialization/collection_size_type.hpp>

namespace boost { namespace mpi { namespace detail {

template<class Archive, class ImplementationArchive>
class forward_skeleton_iarchive 
  : public archive::detail::common_iarchive<Archive>
{
public:

    typedef ImplementationArchive implementation_archive_type;

    forward_skeleton_iarchive(implementation_archive_type& ar) 
      : archive::detail::common_iarchive<Archive>(archive::no_header),
        implementation_archive(ar)
    {
    }

#ifdef BOOST_NO_MEMBER_TEMPLATE_FRIENDS
public:
#else
    friend class archive::detail::interface_iarchive<Archive>;
    friend class archive::load_access;
protected:
#endif

  template<class T>
  void load_override(T & t)
  {
    archive::load(* this->This(), t);
  }

#define BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(T) \
    void load_override(T & t)                   \
    {                                           \
      implementation_archive >> t;              \
    }

BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(archive::class_id_optional_type)
BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(archive::version_type)
BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(archive::class_id_type)
BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(archive::class_id_reference_type)
BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(archive::object_id_type)
BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(archive::object_reference_type)
BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(archive::tracking_type)
BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(archive::class_name_type)
BOOST_ARCHIVE_FORWARD_IMPLEMENTATION(serialization::collection_size_type)

    void load_override(std::string & s)    
    {                            
      serialization::collection_size_type length(s.size());              
      load_override(length);       
      s.resize(length);
    }

#undef BOOST_ARCHIVE_FORWARD_IMPLEMENTATION
protected:
    /// the actual archive used to serialize the information we actually want to store
    implementation_archive_type& implementation_archive;
};


} } } // end namespace boost::mpi::detail

#endif // BOOST_MPI_DETAIL_FORWARD_SKELETON_IARCHIVE_HPP

/* forward_skeleton_iarchive.hpp
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
*/