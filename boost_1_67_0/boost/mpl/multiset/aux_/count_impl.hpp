
#ifndef BOOST_MPL_MULTISET_AUX_COUNT_IMPL_HPP_INCLUDED
#define BOOST_MPL_MULTISET_AUX_COUNT_IMPL_HPP_INCLUDED

// Copyright Aleksey Gurtovoy 2003-2004
//
// Distributed under the Boost Software License, Version 1.0. 
// (See accompanying file LICENSE_1_0.txt or copy at 
// http://www.boost.org/LICENSE_1_0.txt)
//
// See http://www.boost.org/libs/mpl for documentation.

// $Id$
// $Date$
// $Revision$

#include <boost/mpl/multiset/aux_/tag.hpp>
#include <boost/mpl/count_fwd.hpp>
#include <boost/mpl/int.hpp>
#include <boost/mpl/aux_/type_wrapper.hpp>
#include <boost/mpl/aux_/static_cast.hpp>
#include <boost/mpl/aux_/config/static_constant.hpp>
#include <boost/mpl/aux_/config/workaround.hpp>
#include <boost/mpl/aux_/config/msvc.hpp>

#if BOOST_WORKAROUND(BOOST_MSVC, <= 1300)
#   include <boost/mpl/if.hpp>
#   include <boost/type_traits/is_reference.hpp>
#endif

namespace boost { namespace mpl {

#if BOOST_WORKAROUND(BOOST_MSVC, <= 1300)

namespace aux {
template< typename S, typename U >
struct multiset_count_impl
    : int_< sizeof(S::key_count(BOOST_MPL_AUX_STATIC_CAST(U*,0))) - 1 >
{
};

template< typename S, typename U >
struct multiset_count_ref_impl
{
    typedef U (* u_)();
    typedef int_< sizeof(S::ref_key_count(BOOST_MPL_AUX_STATIC_CAST(u_,0))) - 1 > type_;
    BOOST_STATIC_CONSTANT(int, value = type_::value);
    typedef type_ type;
};
}

template<>
struct count_impl< aux::multiset_tag >
{
    template< typename Set, typename Key > struct apply
        : if_< 
              is_reference<Key>
            , aux::multiset_count_ref_impl<Set,Key>
            , aux::multiset_count_impl<Set,Key>
            >::type
    {
    };
};

#else

template<>
struct count_impl< aux::multiset_tag >
{
    template< typename Set, typename Key > struct apply
    {
        enum { msvc71_wknd_ = sizeof(Set::key_count(BOOST_MPL_AUX_STATIC_CAST(aux::type_wrapper<Key>*,0))) - 1 };
        typedef int_< msvc71_wknd_ > type;
        BOOST_STATIC_CONSTANT(int, value = msvc71_wknd_);
    };
};

#endif // BOOST_WORKAROUND(BOOST_MSVC, <= 1300)

}}

#endif // BOOST_MPL_MULTISET_AUX_COUNT_IMPL_HPP_INCLUDED

/* count_impl.hpp
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
*/