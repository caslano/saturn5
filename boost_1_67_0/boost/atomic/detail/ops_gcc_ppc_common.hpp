/*
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * Copyright (c) 2009 Helge Bahmann
 * Copyright (c) 2013 Tim Blechmann
 * Copyright (c) 2014 Andrey Semashev
 */
/*!
 * \file   atomic/detail/ops_gcc_ppc_common.hpp
 *
 * This header contains basic utilities for gcc PowerPC backend.
 */

#ifndef BOOST_ATOMIC_DETAIL_OPS_GCC_PPC_COMMON_HPP_INCLUDED_
#define BOOST_ATOMIC_DETAIL_OPS_GCC_PPC_COMMON_HPP_INCLUDED_

#include <boost/memory_order.hpp>
#include <boost/atomic/detail/config.hpp>

#ifdef BOOST_HAS_PRAGMA_ONCE
#pragma once
#endif

namespace boost {
namespace atomics {
namespace detail {

// The implementation below uses information from this document:
// http://www.rdrop.com/users/paulmck/scalability/paper/N2745r.2010.02.19a.html

// A note about memory_order_consume. Technically, this architecture allows to avoid
// unnecessary memory barrier after consume load since it supports data dependency ordering.
// However, some compiler optimizations may break a seemingly valid code relying on data
// dependency tracking by injecting bogus branches to aid out of order execution.
// This may happen not only in Boost.Atomic code but also in user's code, which we have no
// control of. See this thread: http://lists.boost.org/Archives/boost/2014/06/213890.php.
// For this reason we promote memory_order_consume to memory_order_acquire.

struct gcc_ppc_operations_base
{
    static BOOST_CONSTEXPR_OR_CONST bool full_cas_based = false;
    static BOOST_CONSTEXPR_OR_CONST bool is_always_lock_free = true;

    static BOOST_FORCEINLINE void fence_before(memory_order order) BOOST_NOEXCEPT
    {
#if defined(__powerpc64__) || defined(__PPC64__)
        if (order == memory_order_seq_cst)
            __asm__ __volatile__ ("sync" ::: "memory");
        else if ((static_cast< unsigned int >(order) & static_cast< unsigned int >(memory_order_release)) != 0u)
            __asm__ __volatile__ ("lwsync" ::: "memory");
#else
        if ((static_cast< unsigned int >(order) & static_cast< unsigned int >(memory_order_release)) != 0u)
            __asm__ __volatile__ ("sync" ::: "memory");
#endif
    }

    static BOOST_FORCEINLINE void fence_after(memory_order order) BOOST_NOEXCEPT
    {
        if ((static_cast< unsigned int >(order) & (static_cast< unsigned int >(memory_order_consume) | static_cast< unsigned int >(memory_order_acquire))) != 0u)
            __asm__ __volatile__ ("isync" ::: "memory");
    }
};

} // namespace detail
} // namespace atomics
} // namespace boost

#endif // BOOST_ATOMIC_DETAIL_OPS_GCC_PPC_COMMON_HPP_INCLUDED_

/* ops_gcc_ppc_common.hpp
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
*/