/*
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * Copyright (c) 2014 Andrey Semashev
 */
/*!
 * \file   atomic/detail/atomic_flag.hpp
 *
 * This header contains interface definition of \c atomic_flag.
 */

#ifndef BOOST_ATOMIC_DETAIL_ATOMIC_FLAG_HPP_INCLUDED_
#define BOOST_ATOMIC_DETAIL_ATOMIC_FLAG_HPP_INCLUDED_

#include <boost/assert.hpp>
#include <boost/memory_order.hpp>
#include <boost/atomic/detail/config.hpp>
#include <boost/atomic/detail/operations.hpp>
#if defined(BOOST_ATOMIC_DETAIL_NO_CXX11_ALIGNAS)
#include <boost/type_traits/type_with_alignment.hpp>
#endif

#ifdef BOOST_HAS_PRAGMA_ONCE
#pragma once
#endif

/*
 * IMPLEMENTATION NOTE: All interface functions MUST be declared with BOOST_FORCEINLINE,
 *                      see comment for convert_memory_order_to_gcc in ops_gcc_atomic.hpp.
 */

namespace boost {
namespace atomics {

#if defined(BOOST_ATOMIC_DETAIL_NO_CXX11_CONSTEXPR_UNION_INIT) || defined(BOOST_NO_CXX11_UNIFIED_INITIALIZATION_SYNTAX)
#define BOOST_ATOMIC_NO_ATOMIC_FLAG_INIT
#else
#define BOOST_ATOMIC_FLAG_INIT {}
#endif

struct atomic_flag
{
    typedef atomics::detail::operations< 1u, false > operations;
    typedef operations::storage_type storage_type;

#if !defined(BOOST_ATOMIC_DETAIL_NO_CXX11_ALIGNAS)
    alignas(operations::storage_alignment) storage_type m_storage;
#else
    // Note: Some compilers cannot use constant expressions in alignment attributes, so we have to use the union trick
    union
    {
        storage_type m_storage;
        boost::type_with_alignment< operations::storage_alignment >::type m_aligner;
    };
#endif

    BOOST_FORCEINLINE BOOST_ATOMIC_DETAIL_CONSTEXPR_UNION_INIT atomic_flag() BOOST_NOEXCEPT : m_storage(0u)
    {
    }

    BOOST_FORCEINLINE bool test(memory_order order = memory_order_seq_cst) const volatile BOOST_NOEXCEPT
    {
        BOOST_ASSERT(order != memory_order_release);
        BOOST_ASSERT(order != memory_order_acq_rel);
        return !!operations::load(m_storage, order);
    }

    BOOST_FORCEINLINE bool test_and_set(memory_order order = memory_order_seq_cst) volatile BOOST_NOEXCEPT
    {
        return operations::test_and_set(m_storage, order);
    }

    BOOST_FORCEINLINE void clear(memory_order order = memory_order_seq_cst) volatile BOOST_NOEXCEPT
    {
        BOOST_ASSERT(order != memory_order_consume);
        BOOST_ASSERT(order != memory_order_acquire);
        BOOST_ASSERT(order != memory_order_acq_rel);
        operations::clear(m_storage, order);
    }

    BOOST_DELETED_FUNCTION(atomic_flag(atomic_flag const&))
    BOOST_DELETED_FUNCTION(atomic_flag& operator= (atomic_flag const&))
};

} // namespace atomics
} // namespace boost

#endif // BOOST_ATOMIC_DETAIL_ATOMIC_FLAG_HPP_INCLUDED_

/* atomic_flag.hpp
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
*/