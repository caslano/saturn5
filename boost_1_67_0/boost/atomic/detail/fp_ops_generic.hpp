/*
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * Copyright (c) 2018 Andrey Semashev
 */
/*!
 * \file   atomic/detail/fp_ops_generic.hpp
 *
 * This header contains generic implementation of the floating point atomic operations.
 */

#ifndef BOOST_ATOMIC_DETAIL_FP_OPS_GENERIC_HPP_INCLUDED_
#define BOOST_ATOMIC_DETAIL_FP_OPS_GENERIC_HPP_INCLUDED_

#include <cstddef>
#include <boost/memory_order.hpp>
#include <boost/atomic/detail/config.hpp>
#include <boost/atomic/detail/bitwise_fp_cast.hpp>
#include <boost/atomic/detail/storage_traits.hpp>
#include <boost/atomic/detail/fp_operations_fwd.hpp>

#ifdef BOOST_HAS_PRAGMA_ONCE
#pragma once
#endif

namespace boost {
namespace atomics {
namespace detail {

//! Generic implementation of floating point operations
template< typename Base, typename Value, std::size_t Size >
struct generic_fp_operations :
    public Base
{
    typedef Base base_type;
    typedef typename base_type::storage_type storage_type;
    typedef Value value_type;

    static BOOST_FORCEINLINE value_type fetch_add(storage_type volatile& storage, value_type v, memory_order order) BOOST_NOEXCEPT
    {
        storage_type old_storage, new_storage;
        value_type old_val, new_val;
        atomics::detail::non_atomic_load(storage, old_storage);
        do
        {
            old_val = atomics::detail::bitwise_fp_cast< value_type >(old_storage);
            new_val = old_val + v;
            new_storage = atomics::detail::bitwise_fp_cast< storage_type >(new_val);
        }
        while (!base_type::compare_exchange_weak(storage, old_storage, new_storage, order, memory_order_relaxed));
        return old_val;
    }

    static BOOST_FORCEINLINE value_type fetch_sub(storage_type volatile& storage, value_type v, memory_order order) BOOST_NOEXCEPT
    {
        storage_type old_storage, new_storage;
        value_type old_val, new_val;
        atomics::detail::non_atomic_load(storage, old_storage);
        do
        {
            old_val = atomics::detail::bitwise_fp_cast< value_type >(old_storage);
            new_val = old_val - v;
            new_storage = atomics::detail::bitwise_fp_cast< storage_type >(new_val);
        }
        while (!base_type::compare_exchange_weak(storage, old_storage, new_storage, order, memory_order_relaxed));
        return old_val;
    }
};

// Default fp_operations template definition will be used unless specialized for a specific platform
template< typename Base, typename Value, std::size_t Size >
struct fp_operations< Base, Value, Size, true > :
    public generic_fp_operations< Base, Value, Size >
{
};

} // namespace detail
} // namespace atomics
} // namespace boost

#endif // BOOST_ATOMIC_DETAIL_FP_OPS_GENERIC_HPP_INCLUDED_

/* fp_ops_generic.hpp
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
*/