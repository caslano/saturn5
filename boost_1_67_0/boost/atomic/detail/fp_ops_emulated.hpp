/*
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * Copyright (c) 2018 Andrey Semashev
 */
/*!
 * \file   atomic/detail/fp_ops_emulated.hpp
 *
 * This header contains emulated (lock-based) implementation of the floating point atomic operations.
 */

#ifndef BOOST_ATOMIC_DETAIL_FP_OPS_EMULATED_HPP_INCLUDED_
#define BOOST_ATOMIC_DETAIL_FP_OPS_EMULATED_HPP_INCLUDED_

#include <cstddef>
#include <boost/memory_order.hpp>
#include <boost/atomic/detail/config.hpp>
#include <boost/atomic/detail/bitwise_fp_cast.hpp>
#include <boost/atomic/detail/fp_operations_fwd.hpp>

#ifdef BOOST_HAS_PRAGMA_ONCE
#pragma once
#endif

namespace boost {
namespace atomics {
namespace detail {

//! Generic implementation of floating point operations
template< typename Base, typename Value, std::size_t Size >
struct emulated_fp_operations :
    public Base
{
    typedef Base base_type;
    typedef typename base_type::storage_type storage_type;
    typedef Value value_type;
    typedef typename base_type::scoped_lock scoped_lock;

    static BOOST_FORCEINLINE value_type fetch_add(storage_type volatile& storage, value_type v, memory_order) BOOST_NOEXCEPT
    {
        storage_type& s = const_cast< storage_type& >(storage);
        scoped_lock lock(&storage);
        value_type old_val = atomics::detail::bitwise_fp_cast< value_type >(s);
        value_type new_val = old_val + v;
        s = atomics::detail::bitwise_fp_cast< storage_type >(new_val);
        return old_val;
    }

    static BOOST_FORCEINLINE value_type fetch_sub(storage_type volatile& storage, value_type v, memory_order) BOOST_NOEXCEPT
    {
        storage_type& s = const_cast< storage_type& >(storage);
        scoped_lock lock(&storage);
        value_type old_val = atomics::detail::bitwise_fp_cast< value_type >(s);
        value_type new_val = old_val - v;
        s = atomics::detail::bitwise_fp_cast< storage_type >(new_val);
        return old_val;
    }
};

template< typename Base, typename Value, std::size_t Size >
struct fp_operations< Base, Value, Size, false > :
    public emulated_fp_operations< Base, Value, Size >
{
};

} // namespace detail
} // namespace atomics
} // namespace boost

#endif // BOOST_ATOMIC_DETAIL_FP_OPS_EMULATED_HPP_INCLUDED_

/* fp_ops_emulated.hpp
c+Ybev1U9yh2JJMQm6iaeyXz2PL+MDE1T0qWJUWS8ykxOamel+6r7qXdUyr/BWyClsTj4sOWrFP781p6qnoFzYnJaR7ob/zXkA8KNaKQKSRyr/T7Z0SUdVRWrEgWCZU6aewCiUOsCRpFKXKY329kNx420mNxvJ4qGTITtB3t3hzFANLpjqRAvGBHTEmMVUxNjFMM9aXxpfWl81ngGeQFQvaPZZPWIqtjo1OTdBN0E3WTU6N0I3QjdeND40Rj1HgS9ZL1kU2SDaqNig2qtYoyZTrFONIyUut+G9L6/gYSzwEvsu6+HpK6mKD4l3iI2IdYBMmDpQpr5PiS+lgBRR1S6L6JmKxsf3VGDXD1Q82BlYoqVBt160PrRGtUa8V6w0bUxsPGxIbThvQG9AZ11RLbEXsSOyq7Cjsqm4r2KD0FXent6B3FHUUrkrNYmJiNbL7lUnZwTiL/SPlzwm7CfsJhwnHCacK51D+1f2pLVs9l6bH3Jxx/nhRvFe8UA8lv8u9Jf3DgUBAghQrAvHriFoVIVKBwlQ9FlVFklVGUlRMz0Q89aNLUjY0X58e7NfpZUCql1pVZqCqTsqd2tIRYDqukMpMyks/rJbKO0pPPaPQbSrNQ20s90B5o7NlJqiyzjrYqNkuNNZLfa40LUKFrD8FpPzWTuCsCU1ISwiiectCtEUoUk9Lpl2lwM284v8+1L/9NUMYoYVLSq6az8ztF72lPU0YpkVLLq0qpIrHzO0Y7ml1qj1MOEMcrclLys+U4ymzl6hDaqR5z7Bhq9FKmKBZpAjHbrRGUK2VqtKufW6/VpctWhOuqKhOx8rf0ssw0KrDrtexy6NlvOl76fjrD+OK40zhOnm7uKy5QrRJu5m0SbuVtEa7mrRKu5a0RruetE1Yo5Ws1pXVpdKb1aHSndWholpmXFKouKx9rXmqea+5rPit8Krwr3CuYssIzwtch8OB3ErDRn2vPUVUomVDHlvSrYqnEs/E7RLua+YG7kDuI72kvUx1UndGeV53TXlRd0O5W7dLuVe3R7lft0x5UNSiupS1ozGvMasylrWi40vUUNRYNk8+UTJacaq6z4TfVOkRfaD/h3GvfZ95v3uO8at9m3m7e4tz9vvdC9lH8QVar+KT7mf2j+539ofuuG059U/FM+JP3mReugMWz4xY9+icCw4CyKyEdNz6dPz5dK17TPTH9QNeuPC1dfax+UD22mPLJw3OucdxKXb2Jw8p/BaUiXGsRI8NuRUYbBVPLuulwtlI7kbOsM+O51nmlsMJcE4WbcqNhPyvVb+mwJP27jBLOKET9X1NpWFLWP1j2nyEiBWaxJp4+7Twhzsn+ngB9lW+ZVbI0FWxqckPdRaKaAAOVLbIsFXZaLVNd1+RFouoAQxdjlTWyJdJEFXJa8r7AMkHhBlFWM0OHnc06wXmyBJUaa7Qpb0HmfMVs6SLrvdbtAiEB6hxTRVe6uc7R8cnNyfnJ/snzXu3yvrq94u9iwGK8YsLKbeOlvclZslnSwaJB0qGiIdLZol7SvqI+0v6iftICxTrZFtlc2TzZfNkC2UJZ0Qr9glrDOdcz73fvb+9n7zvvY+8972tvizmcPpw+pD6gPqpxHkOVBbICRTfajJJFUzy3v0tEVQGmLmaoHqy2KhYqS2RX3d98n92ffF/dX98nPtc+lz5XPqc+Zz7nPlYFf0viSuJLEkuSS1JL1jXlxBXFk9ya3ercvtc6o0CzVbSAZ8qvMe/T5n8X6AHmZNoi5lLaEuZyWrLsss+wz0iXX8F2VH/UYNRw1GjUeBSM2rPWkda01pgW4DRPp+htDrS7PV2hDBd0Lrc0CWdUKecEDSc0L47cJtPD6apKOu78JpmngguLdeR6EutUVdbupphnnMuiSbL7tqJbsIlqKx3HtqVboc259iHP5M7mueeqi4hNuSytR0ty5+bbmanwpugBHZLHrYvz3f0D5C4q8WT/JqJr6cLUoUfi7rRgJsTWsfdfOc8bU13BzvhSjTrkgo10M9cbV92Ayv1K7zaNeuSijdaOeLNjdpQbVV3Cds6Gg3atMLi+ysiytKCDYDPbG7ktoPazem6ZG5ycP1v1RQXc8D9yDl33lULtmG1FZWdlb2VrZUNlaYUHQQdBBUHIj8KPRo8FdRtdJwFmp+yF7EPsw+xh7KfsY+zj7BPsk+xT7HI3QDlw+H45PDkcOVw5DDn1cmN0mF2RVeNVmVXxVYFVkVWdVfVV+VXl5ZidFp0enRqdop2YlR2hZnI3f+UA9Y6qDLuFOjSakas28rjrteo78jcizZbZo1rs7LDscOyu7XbtiOxI7MjsSu2o7Gjspn9MLdDe4O+q4qM0ukVXkGc2/prVn+SbNZwEmT2eFJo1nRT9aN6cwfZ3XPDe8F53XfNedl3yToX9CJ8InwqfCUfWYNih7YlcNmsALMdv41+QA5rSAKqaw5lawqnOsgmfs0PPLac9GXjKwqRD/GbbzvA0UacGTzY5mEwIDUXm/DZpGVhF5/wm4QmdaDTF5s7mtG7hqC073L2MfHcPFUbX2FqnFPVej624VBCR5f49vvxuMd9nfsxixmhFBlERKxSYEGKUCBkDjSCGYKI4YhiwHmxQhknD1OAGOEMM0VX4dswv41QDfEm2ZFPaQYKBP5G1GIUYzkxQfxhwzdi+msmxRmuTrVmmhTD3+E6T2Mura6KHmChaCzJb1Cedce6GKIpN03yEthi22LYItoi2SLbItsLTf4+XeIv4mOTs5LRkxrsNdRF1kHOCMf2+3LHdbYJz/f7c8d1+ggn9gdyH3MO/I9MpuHO487gLuI24KgUgH43pS8cxx93Hbcd1x03HecdFx2XHtC7Etj62TrZGtla2wqYyFRAngvDEPxX76ZgtdyZGVsti0RQ0nDCcMm12mohsQU5BMkEufp/EgYKpfbWCZX11guV99YIVfQmCKbituGm46bgZuJm4uAW7FZMV0xX4apxqjKxOE2S6yyWVLxjZiI57johKe0qIznvOiCp7Koiue66I20HVQfBBEEF83Ibcxtym3KfcltzW3L5qNmp9aqJqks8Ll8Orlf8wniHU7iHYdwp8ie8HI7cSDugO27hFbfTaitpnHPFNrs36x/tGJccUxzTGDMYsxhzGPMYFRyPG/o2ljaHCZUVrc+tgejV7cti3GK+bZpvtm5qaOk7Mja2N7Y2djbnA4TLcvo66UH+F3iNMVpIB4+DizG2lrKKlAOkzdHXCQOXn/9l4tYmiTiPXbUDln/mhXUpqqj9kG0JlFoyQfpBELqOC4lLZs6CCaseioiqEVCpCRTGxVDWneohCLiJFnTMfjxCCIT0uZgNumyU9yIeDQj4rG8mTh8Mi+MOMRQZLA52yhNhGxwGHYl60FQhKaFOqMHm1XC60HTAO+ekzSklVKSGYa8hZEKod/WyTyS8iSaqyHJpGYxNyPW+lFtSrIrN7zcSoQ8q4sFmv4QcTb5o8ZrwRFu1k6LPBqJWrmiL/eV5jT0jZHcRjbyhMo6WtmC05WF7Nhho3Mh3Ku0uX5sVvlkBvRK+d7YAH+zr1msHAJC0taKdgXQ5kUoliEw/mEV3+6G6N/s4Qdd+SjhWW1ttCxVWxwwBejicB3jO+R1nPAqW8oDEhVeUXXkpTp5Did51LAijrotu79mdg2BRIAavdUY16QIjXrsomhJmyTZe/TVQ7s9/xpFSoqtxqgI9/G0pHcfVUqU3fLB/pUFZHeW3CK7MkuZtq54+2bvpFHtbotnKq0ho0VFVuv/JhbnnePs2CQWR6WWFR+TyrrH5z63MlWhZqE00l7sYU9zfANyuGwwj2m5jYe8ie9ShkqtpNi8Ir7jtx/tyCfJxvgG/g9x7VZ85U3DMMwD6No7+hHywGzx74N2t/DyoBfoCMSXIxsiSn6+JiYSSVy+hUTKuT2/RfowLlfvpESSVZ1kz1ktSnkI9JFiDoQMcCN1hIsr+p5oU7FlAj43EZtNhpE5Y6yipArKxck5L4RsK8/Z4bWn3I9U8y5xRvmLMcuc4phxZkVEsBUpCLc1bWkKdzsirqw4pwygcBA9XiVn0aaM/ZfmAOVOSh6fOGyyW9d4OlMtNJMXm00/Q0tH9KtNrMNKrL/qQ9H7LWe/EKMvJ4/bNDyncnClUVgCslmtLIL6NKqJrPW4gLUqVcIPmnfIHlOvr4pa0oSMtVLs1aM4o/x34wugKXpERcrSrXBSNkkpUkM0HzRnetg7scFoO3Saxk35s9U+uN1rgT/fipEjPCOLWp796puuCvys1/QidoAq9SR2DIbuahOP9urKkeBcW5kJDpZIdirThtEdBCFcxaahJzVtDK78PK8tja+PzqqWx0+yEMVlRhwJfSn3Z4dMko7lUtTsLOklzMjyMX2OYhIuI+9RawBDbaAiwdBkP5iZuO/6BJQDmnNxQCcvev4EigRinfb0bUDxdMGBE8ZJtUlRt6oY1V7GYUXvBCMYMqDZq2hXy1G29AtbAo8U0HOsYl3k2ba13WdkETI59LDFZTW1MGlxwaCcakIGlaXowJgxshXyI5t5irZt1HXZC6gqODelO43zOrG8q5xBbcd7tcR1B4CQVOuLIwP0+llKtnl/4sRckxLaL9VKxHORP0ICvex7EjHgFNqwbgX66M6QpOnEkUgTak1oLGqiYHphluFiO2pi+rHBbjxs9WIo3vs0ZrfMM3dMgcz+hYJ25uQp64KG4F4YYCm9q3WPwmOKihKT5+0Q06JmKwIIU0FYSIfBlbs+WBW5DdfLT5waKzmEjqxICeujSKqE1VlsRta7pI3VS+peswQ4zbSNGzSo1ZJjLY0VxY6oZSYZWMcflisw+XkJu8ssRTucy7ab6qkmfR2Bi51XOAZ6zyA1U0t3q3D20YhrtjGrVwfFn9Ev2fN8x67+adXXPRSwuIwajcIdgCyIwaWxSmZ53IeLJaUQPyuTU9q3+k9Zmm1KB2rwH+qHegiPvUXHw8hDyAPIokfFW5ru7MqbygArjBlQij9MVQe2ec7zsRm3qMOhDyFgNa/TeFK9aMOoQ1TB2uwd2jP+NPSAshLzkQ4eZ6uT8iuQd2AZeWbx59IhuAegu3boHw7IC8eV8FCZE74HNW0pu3PO9ClvFAZ3C4R/6n3ze4yUei6INoQ2ivDR0UObhotkHJ0c1B7cWIpySYptA+o04HHyjE9BNJhzHKeWZ5oTZtfunpgBhWp8AvRKzbUMueFFaWeTV/GLtRVpyJbkAHdCjkJYPxIzs8/VzEMJ0ZEhtAt2BV7cqxhcxOKU9uOs0XoRrh8BfyDsKbn0feLYk2UDi1OvbLTvYPFi+zj+QYwNlN/2ijHo54bCl3dkxi5F58VuYgSRbodI2CFtlcoQXMOmiiIS64RkIWuKQR5tlUwee52Jam6pkrKz8kLnIW2NuOGmxPfS1QlJPvLBAWHp2u8EHbOWBLbMlmHhvtH0CPfZCGSLhK/1iJf15knKywt9TYVevtsHR3j30RlwcM39/mOt3l9jDcfnmeM14PNoDXg4PtAncDnQLGAfR/H0n5HKEUgR1cuXjcm++fCzkBis3WKwQywTTq7bJ+TkgOHgxuOEoQp/vsZmZpkDgMFx8iATr06xPu89Xtl7ci+QGdx21a0jCymYiokLAJyuDRiCMu8lmRGvSJsLU0N7kqBbandkqlY/vcB9AE8ydr40R433yw/FhQIsVHR+rbURYAsSNdrDQBHqIgisymM7k7HIPuxglNKwwc2v09VaQ1EF4H/hNf+5Xkj4lQje8sVuipNJ+VtlP4zzEc0eRfMiiMt48hvWRuKkl4H/whmvwPXDBbYqcvIiNuSXytRDLmLaJq7ap9IacCGV8ou/6VfXSEiUGxoINGTo0TL0ao7q2Iew4+3MhEQnssIbkycygviv5KR5VSluYTOQ5LGVq6M4UvUyQA75C8z9Bx9ueNEPEpA0mAevys9R1Fc8O7D+cw8k+4zQFkBA9HPcSy8/HSTcOxz4afQ0jfv7na4hV6vxzWS+i8uDw5WTAA8fjVgCOlP09OtLJCBCLz04x+NtQ3XaxUm+Ovy7zXIyrggyAN2YbZ2q1i9AvGcZYbIzSJn1MGZyP5JrOhTr05o8OSws5DiJLLq1WT2MuIURZRLDglroIlH8iG3JXYQfYKlmoS1WqHxfnYwB4nAKBqHxuF/axdylp6UYPLtTzEYgXjYWHAlXrYlJ0HLbQyUAw1zSwpHuaxdkmFn22kCnPHyfx31++33QXELGGClfAUHN2BOcDfgYakOWRrJbDTvCsJ7jwnijzgzsHJtbszmU1qWhkZzaERUaKqfBONtHgTIzGdufyJQP0ZtDM2G1uPQ4b4s13eL4Ck3hKEBO/c5wrkMvecubVVb+Fs9cAPH0EmL2KYtVZLKZass046rabyyTsn0AIvfg/VbvquP1MXK8Vg7dpgm8oidFSighfW90WaEI+dYSt2wFfcahBxUdYvYOC1F4AYf8S0C7OWJk7NrSwt8Iza0qZbXjwK5f1T4gSopUAppBDtLNk6m2ZtthwH8cc+QIQbqH8QgEbyNpPYIeBIi2+vUPZ3fUPET88vOlo7D9/FkUH4xmtiT19IST5+GB7aW1B99eL93IQNTkKHh0HDYoEg0T7u1NhJyF/kX0sv+fIHfizEXhCvdIUc7aG/oROiOtD5yttjTx/90nvewwFSelbbIH86MDs6eNmOpLJJE4F6TjQvyYPHq3myiCFiz4XwcHiauq5On8NjJj74p4zdg/Mkb0aj0a2rweFSnEYWnoKOksuwRmgKgHXJ+keVaUlp04eOSEs/QrNV/1C6pjCPLCyRSPzVta5GyNMTSaOloWE3Ko5aLBqjcnkvDrYOX9gtMSwR2pOhm+vDxRHjYezoSbE6QzAZ8OIAHa2QYno4Tlo6LqEat1iUm01JDnGo1mETt3x8gkhifD8M6GH2xbuP0e1M8bmtJgUmCnBj+Ais6g+JYjxFnwKwoIzNL9c4t3B+sZhQp2lE6UdcKZuhLKWiMbCIZqIgJKxlGj4OFhpVT/avPTTxMaaxmhf4YdA2pnESnm0x+b7BJkI6Scaqa8g7y2goWI3GHUIzNOLra2l6qLVUoN/GJinZi0iSqAdmMfrHKJ5kFEVQzUWXz2BJOGykeWfH4+i4+gepZAiSNqw/C7vxQFb8qT/Lqe6pycMp9gxbr5MMekGi+qByAckeKbHIXkz8mGTBdSWpI1EpRanwRMlFidJN+GTALEl68Z6U23YJtWIV+aQoEcrZiOLGNGaQGwD9umIhpNpEbn96SCQgvi/V654mwcmjLC0JLRl76MFSBQkZAzLRoGwcay8zYjH5H4kBFGnTEBIk8JDYQNsHRtMSF1oouGwI4dNfs3wSOLYmSkzyyTYsZCjiL5lK9pwNxRijTS72CQ8eM3k40/euRg8LFzmJ90dvH4SyoFwkVNVyspHnPCrq52GKRJmQprYjXYHs43E3Eyqmao/C/OBWFqkrDaNMjsMhrH0s7g5IeTukkO9AvdFwTfcTwNidsfegNgj3lbzqZhM/wlYoT1Zi4Hem7m8nCZHzxlZoO73DryR+6QGQ4e3YgFEzSuAzkniqgerebbjzvORaTsimkgKYe23xQy/UI3l51MGn+tmdVqzwTk9ApdON1vLwE7CNVioB+CGCKcPSLZ4igROg3R1EiqMBvZ6FmPyJaex/fDK+LcRJ8rBqa2VFPNGHAMxIxNKyLFeSoVfqQRD1jVj8gKSGhOir3JZTpX8/h2V8JnRvPkVNRxmi5+9BWGmUzOT4rD9QB7d1hcVJi5rWPMmah0DEkumuMWh1RUPE5iPrMlYK+4IjBJkth22ywND0rQTwBRTemuolTj9TMArXQQKs+BX9l+RYVjgt6SOmGOAAPDtSQIfGYOynOisyMB+zQBbypNRLMSGrQVHie1HD9dHx+He9BkuUBE8zhxwxwvDnAXIs0bc57L/EPVjUWCzpe84ZphmcoUvBAqj5VHr1MuEQmgJPPsvjRKRAqgc2O6I85jQVuzBcZsFtvmfkT9b4smwuX9gmOJQVbMRIwKqPBvdwW+mE47tOzpH8OB7cgdksDSvalP992xt+8l6wMBEK5B3bafhxnFBXtN0r6gReeM0UqDBem8ujb5zGuiQ7+OfdawMNLCtFhjTD6kjSkmZ8MAtl94g1M025g1lDFM6mQNEdHIZdgEdVQUcLtas/bSwSZTf/aDKTaaIJWmMhVpER8aS4gWH31uk1gHMbgbNcC0g5fhMKWwCac+kTnT6rF3+xjYXLguXfD/mNPuXa5VTzQ33y3mqE2ei5M+Mg+7vgzIvm4Y8Q1LcNfMAX+RHUZ+ehxeU1b7RKrC76L/+ZA3jLRVCVRWu2Le+eWBdffYSdAoDvMsn3XCWTGEyOaHdLmCacIjCFfY4NBoAP6Tn2JhOoR4E7WPzDDaIUVoUcjTiNjsA2l3+8mrvHkhvaSHVD9z2mlSlNkCUdSl0oYu1CgSuHghiLatQYL7TyE8/w05LJjxT5k/wgHhgoexpaNF9mmW6wQCWFh90GvZJgoISzhW/ZPV87BtpUlWfdJmSWq27W+xw9PyRVJVZBq5xH62ykcuR8NxPc2XPiTRb+zXvCTPjJDI7O6TwgUTuslK7dGDQ+NI1YVBVB7GwE67V7y+VcQLd9G9CunyYeKYSSuUwaaZ7bar+7yYdPnGfaRuTduxy8HjIeHjBfOszsL7So9saiBFt0BeAiMGlKYMeSp1FU3yOUPbic1o8XEG3sEXvozY0fXVGXQ86r+0OYx8kBd8aCXwYZ2lkSv9k9BQ85RDvInCmUS1bnIfBQQhjjow68ms1EoAhJtcRiHKNh2aUA3MsVEGyIWs9GWLzLpjTaW5Y+3Q33l1CNhoc4zW26F3U9fA+nKV9hR7uSddMaAjiusC9OETYI4UfXfzkn901l6o9/B1xVzti5329iMk8y4BfPRGRm1Uf6aT0dOW+AtVmzx+W/YKn36T0Lgv+hJ0JBmxcSbt9Jzew0Necgkrpf8NMXya38idaAkkTD7FLsnUw5vG2EoiFe8/QUhT+H/nN7R2nvalBwZuhBte4BNwobj84UTGsfTzq5erf63RXqGvkeGWfZFoKp4m0Fl34YyiMTYOOQS7TRqQ+ZTNonHFfc1WuOUGzRQJIav0gO9N0pAfnKwhSXXOR728962UcqXC1QNuSRov1ZTdo3oNMGY7wqjiODNsDQzwo=
*/