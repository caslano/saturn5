/*
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * Copyright (c) 2011 Helge Bahmann
 * Copyright (c) 2013-2014, 2020 Andrey Semashev
 */
/*!
 * \file   atomic/detail/lock_pool.hpp
 *
 * This header contains declaration of the lock pool used to emulate atomic ops.
 */

#ifndef BOOST_ATOMIC_DETAIL_LOCK_POOL_HPP_INCLUDED_
#define BOOST_ATOMIC_DETAIL_LOCK_POOL_HPP_INCLUDED_

#include <cstddef>
#include <boost/atomic/detail/config.hpp>
#include <boost/atomic/detail/link.hpp>
#include <boost/atomic/detail/intptr.hpp>

#ifdef BOOST_HAS_PRAGMA_ONCE
#pragma once
#endif

namespace boost {
namespace atomics {
namespace detail {
namespace lock_pool {

BOOST_ATOMIC_DECL void* lock(atomics::detail::uintptr_t ptr) BOOST_NOEXCEPT;
BOOST_ATOMIC_DECL void unlock(void* p) BOOST_NOEXCEPT;

BOOST_ATOMIC_DECL void thread_fence() BOOST_NOEXCEPT;
BOOST_ATOMIC_DECL void signal_fence() BOOST_NOEXCEPT;

template< std::size_t Alignment >
class scoped_lock
{
private:
    void* m_lock;

public:
    explicit scoped_lock(const volatile void* addr) BOOST_NOEXCEPT :
        m_lock(lock_pool::lock(((atomics::detail::uintptr_t)addr) / Alignment))
    {
    }
    ~scoped_lock() BOOST_NOEXCEPT
    {
        lock_pool::unlock(m_lock);
    }

    BOOST_DELETED_FUNCTION(scoped_lock(scoped_lock const&))
    BOOST_DELETED_FUNCTION(scoped_lock& operator=(scoped_lock const&))
};

} // namespace lock_pool
} // namespace detail
} // namespace atomics
} // namespace boost

#endif // BOOST_ATOMIC_DETAIL_LOCK_POOL_HPP_INCLUDED_

/* lock_pool.hpp
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
*/