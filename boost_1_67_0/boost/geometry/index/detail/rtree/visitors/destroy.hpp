// Boost.Geometry Index
//
// R-tree destroying visitor implementation
//
// Copyright (c) 2011-2014 Adam Wulkiewicz, Lodz, Poland.
//
// This file was modified by Oracle on 2019.
// Modifications copyright (c) 2019 Oracle and/or its affiliates.
// Contributed and/or modified by Adam Wulkiewicz, on behalf of Oracle
//
// Use, modification and distribution is subject to the Boost Software License,
// Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_GEOMETRY_INDEX_DETAIL_RTREE_VISITORS_DELETE_HPP
#define BOOST_GEOMETRY_INDEX_DETAIL_RTREE_VISITORS_DELETE_HPP

namespace boost { namespace geometry { namespace index {

namespace detail { namespace rtree { namespace visitors {

template <typename MembersHolder>
class destroy
    : public MembersHolder::visitor
{
public:
    typedef typename MembersHolder::node node;
    typedef typename MembersHolder::internal_node internal_node;
    typedef typename MembersHolder::leaf leaf;

    typedef typename MembersHolder::allocators_type allocators_type;
    typedef typename MembersHolder::node_pointer node_pointer;

    inline destroy(node_pointer node, allocators_type & allocators)
        : m_current_node(node)
        , m_allocators(allocators)
    {}

    inline void operator()(internal_node & n)
    {
        BOOST_GEOMETRY_INDEX_ASSERT(&n == &rtree::get<internal_node>(*m_current_node), "invalid pointers");

        node_pointer node_to_destroy = m_current_node;

        typedef typename rtree::elements_type<internal_node>::type elements_type;
        elements_type & elements = rtree::elements(n);

        for (typename elements_type::iterator it = elements.begin();
             it != elements.end(); ++it)
        {
            m_current_node = it->second;
            rtree::apply_visitor(*this, *m_current_node);
            it->second = 0;
        }

        rtree::destroy_node<allocators_type, internal_node>::apply(m_allocators, node_to_destroy);
    }

    inline void operator()(leaf & l)
    {
        boost::ignore_unused(l);
        BOOST_GEOMETRY_INDEX_ASSERT(&l == &rtree::get<leaf>(*m_current_node), "invalid pointers");

        rtree::destroy_node<allocators_type, leaf>::apply(m_allocators, m_current_node);
    }

    static inline void apply(node_pointer node, allocators_type & allocators)
    {
        destroy v(node, allocators);
        rtree::apply_visitor(v, *node);
    }

private:
    node_pointer m_current_node;
    allocators_type & m_allocators;
};

}}} // namespace detail::rtree::visitors

}}} // namespace boost::geometry::index

#endif // BOOST_GEOMETRY_INDEX_DETAIL_RTREE_VISITORS_DELETE_HPP

/* destroy.hpp
tECnoDlNaoNRjzSUdqrQ1WtBEHbykV4kw3pcRmkgdvKHfZjahvQJbbdCzfGpmphMmOjaAU1U5FtaLIjfekPpNJQOfN0l+I9W3u0r76j8plbe4yvvrASAegylm7JrIRvw8sZETTqpuH3XbFBgthxBXvMLw0gMKwlyG7z4pJOyO7NWKyxDQ+phUo9f6lyz25C6mdTtlzrWvGoorQTqIIzmbDGpDabbXLS8bxauVsLj32bh4uCud6Tn2dcd/nhlFmvU5jmAlOWvA9FNYPPsZYJgNcnN9/3YCnh1aw4kJHacf3DOMKDU1SnKvFe1WpCSBbFPpy8TggQwJYdGiwMqfrYDCOwdZKRlfKQKq36K/k4tfRk/xC/vmTldP704uBY//QGuRSY5vWdgAgFaB6xKV3SFDZm2q2oJ/GU9Q1Zkj6Z044K8PbUg3/xhekH++xPpBXn8ifSC7BgPSL8KhpOXXmmvn8OV5opeyILxp9cqdi/WaxBX67wTtFqH42rNB7JM+MSC/PBuc0G2fdGCxIZgUQaJlMSSdF5hSV53HdD6swBCxpJ0plfECPogFDdnLj0n//6b/4Ollzf980tv4V2DS8/5uaW3/6700nMOWXodV1x6nVqAp5Zeu1h6HUOX3gu3X2npnZiJqe1Dl16HSdbtX7D0OKy+IUuPlhwsPaBojkvPQevov1h6Y7ebS2/DzweXXrqWWHoOIGW/xHHppVZhxtJLwehMLb12mNbU0qucmV56T87Epdf9P1p6Dv6VGlx6Dlp6TlhBZf8YuvQOrcXF1maS9T76cg4uPWd66T39xuDSe2Ft5tKrWmtK7kBcm5Iivu1TLhiwGtkh7l1N8q9u2smx7kPMKGNn9Yft/MZ3iPpHe4/4apbB3Ls2NWr0sgTKlLJutdtdUhYylHwdwFEm65GeHTt2sI+ZOgvK2CTnDg1wqN4DH1apl6kF8HKzlGTqXHoZYDZogA3AFOgK1txhBCdDY8yGbSnOVCa2eRTyxi1dsvjIwckW6np99zoY1+vTt0xwe3+rQVuw2spC7GP1WYeVBSbre1Cp0yPdUBmIYIcWaIOGX5wKiZ4XJ2OW1O1664P5YQvohAthdaqPtVmgTz2yHQHR90yj6ofxg5W2MOnwzaW7WCBuDezU98yivCrKU1pvVnaziJMpu2xJz3lNWRc9BwqJFtm+diS75InsjBqummV26FbZGT3nqvFBXTVSZXHV/BinTHKy0ipd2a5HNu0gUDfZDqr7EcVAGFv0yF55HAPU9Xg+Y6U9tg80pV0r7UgA3XUzpcd2FladpnTYDgLWYDEyKemRWnUoI3FsjRCoK3t37AjbdoSRgnaYOD2pK9if/qB9B//qH0A7giEG4jBKNbIRQNtEoI1jpRszQdviGQRtE4KWlwLD1ioA0Uo7E3mfhzcNGoHJAcDPQ5f1BdC93jEEunUA3b2Ewg3whqTNAhsGgWSKW1M2286m4FS2wSIkLNoQIACHKb2eHoDJ9n5ijA0XuJn2GbA4WxwBVJCpfR5GC4D5BTBe/HQIjLUA2U8JsokZ6Ats8wRqU3ABDw10Qx8I2jW297VAOwsk2Qee0lroG6Bjpb2eVsTmJBu0mcT8OFQH5GmBDhbo9byPOo+SfxmMWV8M46JMGKOxynD0SOUKExwTkGHUK+jWpd2Ih9J2WyviB/DSCKB8nqYsn6MpZ6q3xCeZvX1Y+S3o7ZtDe8sG4knAo9cjqLfddpDoxOzwSr1lfUFvEbM36TALtMLYnoXenk71Bl1dBQNjStLT6jlLo8LRwKo5BrSqdLPSpAfp1NaDM4+EgeBciQKyvni8F35vjrcVBqtA949ndD8BewH6b8RePsNekNQSE3ChAFQHPWdToyeo/ovuvwgBa7D7wMDSJd7fLeYPFOZa0mxS7Z54GY9kH4f0PUUAWxng2Mjb9hHKf1d0qyXFLnf4VARdvpGp+cgu1SBK/ReD9D6RGChW16RuxGSvsQfZKaMcNhNZaRB4a9A4RZxYmqpczRixXYblXG/Fi8MWUcAbM5RputJtDih/B7B96D5ofvOMAf6sPWOAFRIOcKoYIIkfZhUSI2wL2zKkBsiMiUuXlAMu1HdRJlpkh9po79r4Z8M4VDdXSDpTioHQshnBaYYyzlDQXkPrpuCfOMpxgJ0qK4Aeti3yBRxrbCCo1cd6LOpjvZaykD4316rBApVgknr0/YgEsdp7tECvFoCVKzKmmRn6fhIeQtyxPYQYgUBGyGbYQqp59iJWg1YYuxVfFNFWkdmWlT1EFaejNGU4P1aaGcZmUMqCdLNmR9S46E57cIH25EKmPordfXOGJQwYHAeo1ubcw9v+AoooIIL0C28M53Gpa1MMha87RVVudfa07gluC8hckppC8O8AkUCynwWctjisYkCDlEyMZQxFP0gUWAO0EKQenDU2l1JhtiZj2gA+ei9XCkj0/4/VArVb/r/QCfh/pxNwoRPs/bxOEDgMsjulCtQK2dNys1LPCC9MiXmUVn2cg1SGOi2yjUXqPf1a6V5NiWmRjVEDtINTntK66IeumnlZqB3UoXawy4KibZtF9rPSWsz7GXkzQL/aa2omIG81aTtyi13AQMH+AOl7kFAStgF/CVsSfjWy2VL5GGB7SEWo4JE2Q11kO62e0s1aaRvJ6FTl0nbkLxyYU0qPALOyM82EiONsTy3I4R/jgoyjulC5Uo1ssVSuYNLEyzrc7ZG2QF1N2gmg2oA7DwC80DjKsi1kPLSjLAu0YFeBjrQA41fqcXOb2SNgJ5+VHkbsoHIMzPZ/IXVIgo+ELYCCycCLgRE/AHkS5YGQSeWKMbYhBjtI2rSjtOkEEIYONc17rsWOlcPRc5UPsVLk76LJJEhw0Cptx6CKBxprh9EFOoiNU1umuOBXarLlNDbZAk0+LJqcJ6AEJcDThO2hRoBANiHKOlBBGGw06wsaffp0Bo+cW5ASAqDKqzdaQqjOv38+abDZjlNj3HqhI2ic1gsn0nMaPWfBc2lzYRFSXHMhshZS86E+j4/uN4LYwixowRvTCh1aoVMrdGuF47TCiVrhZK0wXyucqhVO0wpv1Qqna4Uz2DGtcJZWeI9WWKAVzuUysBTWBO09YFe73F3uswDJfXZ1da9FsbnesR4K2+seQV/AiXCuhZ3VgM09bG/OWQ48mu/rNAz1sQGLXuMGmHgYWlLfJOGqvrkc/7AmLn8n14JtdG6ANn4EbVRUYNlbs/uNRSwObAiAlgb8cTmbv4COy7lYnhgGCETFwXLYx5otpBfag4BKPmZ4nwG8Q21y6M+SHNFXTdSfnSjepunPThNvs/RnZ9GSLCrSHixiBQ8t1eY8tIQdWlx+0J6WvihwmS1EssWhMxqCih448Xr+kmF4DX+zq2rNILd+MYNbv5ji1iULGUNuHQppD96DYGrPzuC3JcCOjThlB4KdvwtwrC6EMrNxDuVcGsw9zgHDR0xJnslUFIP+Ztmzfj+WI+ZyrR7gxeGJwZQvQB4FpnN/vjKM2dhRIzhViCwwLr/W3S98IXsGpVmRyLpdZJWnVAZSBjLEfkqiaWj9CaE2YApBq0ptqCjhrCpJNJUkmtA7VJJl6gLS+Z0WeSF78VaSaJiu7RHvKEe0F2cQ7u6h9Hso/SFKJymjEjAqidqkZz+252nS9lMJan2pN7akAASJwxJeUBdBWtxdgbSIZF+4zzDCBr79bTia0Nt454BJlNK2oEmY/3IR19/2FG029vBb/pY0+F8rBGnuxyZ7v2WSt6DtZmmAth6ex9VRMw7H2OXm//hrUpjq0N/9jUCtL1cQteJKPAn9Nudsgrq4mpqt+Na1FauTMgQlfgwf5ySHVR5WxldkIf03LUGCTK2Ox7+VWh2jsj6/Ol7G1XFjRWp1QIOiN/6VjGZdGc1SMdYISlGzJQ4FtSI7Jjdb42n9CqtRQ5iE9Y9bM8CS6z5BzMxBzEgOTVrHHxmJ3CZQxd//DLiE4vQaWmRAvTRWcTechBbKeB2UXRQsS5SGV+jShlCQfzA716IedoaMvHtAnQ2Gyoy87tNj3I0dbjVuVS9d90S2eun2p+DxfSV7JCDcGr5TD2woxu0gKA9tBPlyahNfseeOS0kD/27+FDiBUsUKe/3NlddGjdXL/Mm1j7remVxZYuT1nCbX2QzInedPrvmD8RQw8HVlvMTeZ6gRt0UZDp9hD/9Hex/MZQ+f1A3k8MkKcrSU8Nbt0KHrnVgwhB19tZ06SuyvCFmGrePbupJGi6nfsoiDnYU15kRsFNphmX37nMUhO0GWjQ6xY/zfcC+r0H7OYqc0N6a9mUpzU9oYTHshlWaVR7veKcgKW4OY/CwkJyasUFdnTZLdK1wNBVkIFPR3D4C0lOZInT35M9D1lKvV2csq4UUe/e7Kf5/g5m8+bbMAODZv7JA3ViAmm5U6fD8+6QRdexSzavRm1HbYLBaTBt2PwWT/dbm5DHhySYq5I1dozulFWhuNKwn475u1WWgsVxNTlJxaNa5h4PbVj9F+U6q115anFxVWH2yOt+MqhZUEw9wPHfHAYxmEzeszSPoeoy9NknU9T01ImwZO0CC9Bjvrm73qJLDQHG12G7BSb8x7Zk5Ia9g5CuEjhtZAKnr1dHon5tRAZtLWfHruopKzKJ1YVHUbpjS00/MwPHlyzUXjfNukmFqT7wKsqTVxSDUKtGoOf/XqJDyDWkM3VeihZy89Y/Ssp2cLPU9ixTwS9NUOaCsoPvgTdwEu3CxuvMABszZc9brUG+S/2nzJYAV2mzSgNUx0IXCT8bm1A1vb2glP3+wKmHl5im92VdsEtzJenb0F0OGoHMmnYJvrNsNEJbK8sZBWHcOqDVPhyW+EEalJm5JnFl/rFOjTtuKQ2DUCwg4XDayN6rXj0E8AQ6qudeOot7kpczuNayqhbze919FzN2Q3V9fBk0ilYa+bcEHPGD1bqdxGet/kxsa1hnX0VUXPDfTcQs+9Ansu3FJdqlVvhkSwLQ6FF9a9e3E0ENo3kNDK9MAW/n7+BYO4po9mR5noyybEuFkOZBezY0YtB2ATowa/O5G9kwd2C/8UqvMT30DJYFsI7ECoaUQwFnkkqyaRiBM1f6FKo7HIblaNL2L6kqj2HFvStfRXVgtbj6VhHWYbq1YmrlbfFeXvYusHy6OjLFhxazUs2oV3XjAWLYLieUHeVnPBCFYgufP7IBlYKCzkQ6kGFeshaLGCr4LsL1GtQ2Bo18YQtjgfeP4i1J21DjKzzUxa/6kS0G+58cZc3Ly5QnoRpqeS1p0cYbFcVj1e3rVv3UXjSnUfyqyLw3sjmJHiPeLbgFzH9Voja0yt4nGDRiEw1D42zKzdA5xh4nO0r34fTicYVGAR9IKaUsKmoJcC8pPVF40ieDFeXInd5OBcLoA323O4aqE7KbmYOkPl2/u7JTw+A3TvNKoAj9m850IfzPDuFhhnYhxrip6Tu1mRg90VPSL/EQoGF0bPKXwJIN9HuHe9FDPZFNjh7OygS+KxLtSzlKt8xAqBUmqIJVqXlBvLnLgvDnwYeJhpphej9dtnvINlKtoPjnPzxdMvGOKbtVVsiUHKA9Nx3sFGG4ieURzQNm6v+0AnBogcvtntsFqVv0bPAPk1IW+6vjnIjvJXLuaAiT8A0DtxR+7682X8W305GIdAtrjd8jrKibIwrJafVxlAIbePzoJlios1ZVbgtIK4JxrVigoGVYkfIwLAvCkLRT+Ux7L7V8Lc3KU/sQDEIKqLiVv132Ad9V6LfC0bhVhG4sZdCnaX2jRRuCJ2gHKZ+B0s4iUIDf/BHSbfewP53ucdY6ik869c32/cYLEUWPQ9yHSGusc0DAQx/WNL2VGfitxp7e1IIvyRq3AzywnvMEXAaoNtpEYvYiryFuLoHRfVmCuxAOxNj5S0IYF1U9Vrr1x1irofq4LQ43IuNRAblRgvXkYnRuIm0VEkhz+WkslHFt/8O9Hic5hYLHWWmXMY/VBETMDkaOuRDUL7IL+i51xbY0Vqh02N5dpatd/geLQfI4ME+km1Ijm8H8LoXzuord9E+Vjf+6H2YyydYeWMy0Sl9wwMh50NMpLbWnm3Vt6jlfdq5UljVb6RVwFDZEKSx31bUcLLWec/DhaTT5DcLiUl4RHGU1C0FxQseqkHOcGOAXHOCYXt/NiX+g1yUfSE3UG07aXu96YdnUDb6LA4le4Qnw1zyWqw/3CJGjeC8C/Ep0Hi0sRks+o4s6q5+V7CcyG7JGzN6LsiGxooKaHvOgTBRPV/TscFHrbUuQpBqOY/ilIBp2PThX4Qd4YybESsC/d5vEZov2NaQZBPUYjF5JnSc6SPpLiSjbkFgqMQO0qyahRugOHnksDCWA2uhfthmd2kvrubHJhTtJ9YQIPVfhLHfCEn1sVQ9D1nh3Q2bL56dDqQ83GjNt+Gc+2qeotkBf+oDyzNM/5DspOti5Mygk9GT+25DmjudY6i+blOVNlwyLsABUF+7OF+A2pls4J8FPDavAW+rSjiKx/wbcWFKN9XsQkmkcf+CRqUJmGMCxR3G29jIRYv48POgYIJNVH2adUnSbGgPJJMNG7CQLdVLJbzbUV8+2LQ8Oypnb5dQ3b6UhY1ocx4Mp/NXAmAsqR2YAEGH53CMf8YcBE1XFUa/DWezheJa+DDe873TgVwYVf0e4guhgj0H5OnIB/pEXxkTHN0JbSDjMo3E+cLlL59KyloRqYd+ixjj3DHthtkCePGl4IBTM1UAMOsjLxORJ6Rt/EULWiyMXSpHVKKgMITo8rwoyw83chbhcCjpV1rzyISOKodqEAr7FdTgIYZqipM6STGpEVXQQaQwxL2IuomuvOr0PZIYVF7Gj1Se2I4a4IXSvC3RrLYQfYiqTYqlmfqdjcawQg91PWou/AT5Ba3xf0fQOn3NbaFyk2j5elvWpPFjvkC7ZXZDNrOoe8mlYx+aBILKTcJy52Vcih/EPLf9wU6sHwHlMfvg5oooNJIGMGxh2AK9GpKEhb1TT4VVTHlWqbjDDJr2KqXHp5v1G5HhDjYKrso6v3Q9yI2otzre5Eq3KXbv2rrYSqqu7rzGVEKOp2iJq2VblA8146z7SGNWEkmcm2MXgO9bPZKmAMf+QXk8WGvcTqcY+sxTutzC7NB8nf9Emf+JZxxV9WruHiiOB8s0KtKyeH6OIvnfRsYzSc1qUWTWvWi4VqgTd+PSqyutJAPkVa5RQnre3ogFYR9jlqZb1EeYTlhSwmSOnoI2GxkMWCcWSusdqCYPW5UTk+/vhcUZWAisjsYtlRMzMgBrKikKldsudeC7fDxkTRwDE0Gtc+Ql/oCycpHgMz3EKrm+vYQqu5h+7Cc7ZznGKg/Jp6FHsPirPmV833NKmq/OLOez/S592ahq4ba9p5rVnvMLFjH0DJKAXkZTMcekhpSi2vrQX0/Cs2vqf9hUw/m+vag+JInAM70GRbPMcCX1Go7SEhrS1zNlF7dafGcRXdn3NajBVpt72vKScCjtTRpIhH62YfUrozS9i3HOLg9qPDLw5ujy83Fychx5G9SRorl6TW6bkGOACrrXNA++PdvumCwHi9opiLff95VlZvmNiutgjuex9VK+2GA0C25WZZw1iJPo6vqAKQXyd8vckU/SvclNlY8RctYwUJ9rtWaomy0+ZpVNFHsSDoHEG55vA39uZ1imfgbXTU64s/twdT2VGrkWY0RC9mPtRPfTfWDLaqxBWZTwzxFDpsjkW0rcngcokIKFCeYbYOgCCBs2NGXzKbIK+YJLrMFF2oMcz2lyfs18qHp0q6gFtmFAaqRvVqkThiJ2oFlyH3mTUuZip1ZAlOHEQ9Huf4PDKYE9aFqTxoxWnQhMiYo9Bq6vur2oqxyVb2AsamGGIQipGkolJamPjLe5FW+/fhXqWDUiL5qgR7ZJdyqK4HVFavP5FvkBxFWftYFuiphys6k3eaQo8tMelBGq9QTaE27lHGA54QrnbBXtqHWRVhPQQQqreBzSq+nyS+1r7nedwBpyxVtsKZ4IFTyS52uml2inNcABGz8zDA0okJ02/6E4pzqi0G3wcDaSEyLHNYicaHnpOaPSYdtTbjZXe9pYoxUXkEAx2WJF/8qG42Ee9gestd0bJkU2XrUY6X64A6eHAUDF2ORHdAKgJXIgUY9qTExkgxCQbRrRAWJx5lOZH9cXolLfZmwRZYxQeyUpzYBsluomxbo5seD3cDKRbBP2hqxo5Z0R7ZGDIhyMqnT01gkkgYpHwg7MR0e5rBz9LmjrImxvv20crP1+6zYVqenyawoiD690N0+ouzItYLCE6OhrI8KVjrNCnuwgm8PKU+Ty3jzd9C9YJVHoI/Bqe1BR4W2B50WplBSkrpzuj/AXTV3oCgR8o6EoLofmZhJuPK9aRY/yN6ZjlmCyWNCGzAmweTENlyymdR74kQ2r0FW/lFtP8EQ2aJFtmmR7Vpkp1HbQgskRS83E23hONSk3VV1NS70pM1VNZp8XNs16bAuHQ4yKk80BaR0D6rM0jZPk0bErkcfRT1ksMyBRynqmopRCehIp/CiUo4xLh3smCfuOQUifpRYNCa7WcYU7tkjGEenyeFBVPoIN/L9TCeklPZeR9aIbs/1tLImtg/x4mnCzdpWW5MWaLF9oJUiY78cQV4DbQ4SKxpJkMSTonvfASQ+EA9EhIPEKWeHsxaSkikoeK6PeJE8ikl1RDVYOfHlm4XX/yjP+juFp11zmTwjsHV7kVUQgdTho5eIM3PwzNSCkDwqJwIivEc8PfdpjKBlBG2W1/BLHS69fVDYwASitelbvVJE3gMQkb8hEMoak98WPaoFkAGwgpV64HAxmTw0MWb2Mk3HMYk5w0I6vmSUown87/AEiM3AUy6M0ZRFTAyZ247545U3skAHTBOl+XsqR4M0HDohAhW+/fgu3+/bj/5E+Su+/aQ63OnbT6rDLaDw5qHGZJV6dZX8cSm7WBmVzlN3IvOSekMaBQCIHRh+QwUaPq+T1eP07SdXmd3fLH/T36yMYCqaAdCqrce3n5QxZ3h8maH0ho2wAQKMeBojZhAed74NcybFrpd6hfrtiReHAP0lef2GMKuATNJ0gA5n335s3lVVipikEq7oA9bMqfRbzam8k1CHHtRmtd5cCGzVSmS+YGCYMxZp0SKtWuSkFmn7Qk7vZIF6D8N+H0jYWeDwfexFMnUiMXbQ02yT4sAXbEk=
*/