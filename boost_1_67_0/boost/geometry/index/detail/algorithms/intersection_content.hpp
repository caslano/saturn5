// Boost.Geometry Index
//
// boxes union/intersection area/volume
//
// Copyright (c) 2011-2018 Adam Wulkiewicz, Lodz, Poland.
//
// This file was modified by Oracle on 2019.
// Modifications copyright (c) 2019 Oracle and/or its affiliates.
// Contributed and/or modified by Adam Wulkiewicz, on behalf of Oracle
//
// Use, modification and distribution is subject to the Boost Software License,
// Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_GEOMETRY_INDEX_DETAIL_ALGORITHMS_INTERSECTION_CONTENT_HPP
#define BOOST_GEOMETRY_INDEX_DETAIL_ALGORITHMS_INTERSECTION_CONTENT_HPP

#include <boost/geometry/algorithms/detail/disjoint/box_box.hpp>
#include <boost/geometry/algorithms/detail/overlay/intersection_box_box.hpp>

#include <boost/geometry/index/detail/algorithms/content.hpp>

namespace boost { namespace geometry { namespace index { namespace detail {

// Util to distinguish between default and non-default index strategy
template <typename Box, typename Strategy>
inline bool disjoint_box_box(Box const& box1, Box const& box2, Strategy const&)
{
    return geometry::detail::disjoint::disjoint_box_box(box1, box2,
                typename Strategy::disjoint_box_box_strategy_type());
}

template <typename Box>
inline bool disjoint_box_box(Box const& box1, Box const& box2, default_strategy const& )
{
    typedef typename strategy::disjoint::services::default_strategy<Box, Box>::type strategy_type;
    return geometry::detail::disjoint::disjoint_box_box(box1, box2, strategy_type());
}

/**
 * \brief Compute the area, volume, ... of the intersection of b1 and b2
 */
template <typename Box, typename Strategy>
inline typename default_content_result<Box>::type intersection_content(Box const& box1, Box const& box2, Strategy const& strategy)
{
    bool const intersects = ! index::detail::disjoint_box_box(box1, box2, strategy);

    // NOTE: the code below may be inconsistent with the disjoint_box_box()
    // however intersection_box_box checks if the boxes intersect on the fly so it should be ok
    // but this also means that disjoint_box_box() is probably not needed

    if ( intersects )
    {
        Box box_intersection;
        bool const ok = geometry::detail::intersection::intersection_box_box
                            <
                                0, geometry::dimension<Box>::value
                            >::apply(box1, box2, 0, box_intersection, 0);
        if ( ok )
        {
            return index::detail::content(box_intersection);
        }
    }
    return 0;
}

template <typename Box>
inline typename default_content_result<Box>::type intersection_content(Box const& box1, Box const& box2)
{
    return intersection_content(box1, box2, default_strategy());
}

}}}} // namespace boost::geometry::index::detail

#endif // BOOST_GEOMETRY_INDEX_DETAIL_ALGORITHMS_INTERSECTION_CONTENT_HPP

/* intersection_content.hpp
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
*/