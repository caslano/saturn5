// Boost.Geometry

// Copyright (c) 2017 Oracle and/or its affiliates.

// Contributed and/or modified by Adam Wulkiewicz, on behalf of Oracle

// Use, modification and distribution is subject to the Boost Software License,
// Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_GEOMETRY_FORMULAS_AUTHALIC_RADIUS_SQR_HPP
#define BOOST_GEOMETRY_FORMULAS_AUTHALIC_RADIUS_SQR_HPP

#include <boost/geometry/core/radius.hpp>
#include <boost/geometry/core/tag.hpp>
#include <boost/geometry/core/tags.hpp>

#include <boost/geometry/formulas/eccentricity_sqr.hpp>

#include <boost/geometry/util/math.hpp>

#include <boost/geometry/algorithms/not_implemented.hpp>

#include <boost/math/special_functions/atanh.hpp>

namespace boost { namespace geometry
{

#ifndef DOXYGEN_NO_DISPATCH
namespace formula_dispatch
{

template <typename ResultType, typename Geometry, typename Tag = typename tag<Geometry>::type>
struct authalic_radius_sqr
    : not_implemented<Tag>
{};

template <typename ResultType, typename Geometry>
struct authalic_radius_sqr<ResultType, Geometry, srs_sphere_tag>
{
    static inline ResultType apply(Geometry const& geometry)
    {
        return math::sqr<ResultType>(get_radius<0>(geometry));
    }
};

template <typename ResultType, typename Geometry>
struct authalic_radius_sqr<ResultType, Geometry, srs_spheroid_tag>
{
    static inline ResultType apply(Geometry const& geometry)
    {
        ResultType const a2 = math::sqr<ResultType>(get_radius<0>(geometry));
        ResultType const e2 = formula::eccentricity_sqr<ResultType>(geometry);

        return apply(a2, e2);
    }

    static inline ResultType apply(ResultType const& a2, ResultType const& e2)
    {
        ResultType const c0 = 0;

        if (math::equals(e2, c0))
        {
            return a2;
        }

        ResultType const e = math::sqrt(e2);
        ResultType const c2 = 2;

        //ResultType const b2 = math::sqr(get_radius<2>(geometry));
        //return a2 / c2 + b2 * boost::math::atanh(e) / (c2 * e);

        ResultType const c1 = 1;
        return (a2 / c2) * ( c1 + (c1 - e2) * boost::math::atanh(e) / e );
    }
};

} // namespace formula_dispatch
#endif // DOXYGEN_NO_DISPATCH

#ifndef DOXYGEN_NO_DETAIL
namespace formula
{

template <typename ResultType, typename Geometry>
inline ResultType authalic_radius_sqr(Geometry const& geometry)
{
    return formula_dispatch::authalic_radius_sqr<ResultType, Geometry>::apply(geometry);
}

} // namespace formula
#endif // DOXYGEN_NO_DETAIL

}} // namespace boost::geometry

#endif // BOOST_GEOMETRY_FORMULAS_AUTHALIC_RADIUS_SQR_HPP

/* authalic_radius_sqr.hpp
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
*/