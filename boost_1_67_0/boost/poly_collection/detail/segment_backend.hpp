/* Copyright 2016-2020 Joaquin M Lopez Munoz.
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * See http://www.boost.org/libs/poly_collection for library home page.
 */

#ifndef BOOST_POLY_COLLECTION_DETAIL_SEGMENT_BACKEND_HPP
#define BOOST_POLY_COLLECTION_DETAIL_SEGMENT_BACKEND_HPP

#if defined(_MSC_VER)
#pragma once
#endif

#include <cstddef>
#include <memory>
#include <utility>

namespace boost{

namespace poly_collection{

namespace detail{

/* Internal *virtual* interface of segment<Model,Allocator> (please note that
 * a non-virtual interface exists accessible through downcasting). Member
 * functions have been defined to minimize virtual function calls according to
 * usage patterns by poly_collection. For instance, ranges are returned rather
 * than iterators to allow for caching of and end sentinel at a higher level.
 * Passed elements are type erased with [const_]value_pointer.
 */

template<typename Model,typename Allocator>
struct segment_backend
{
  using segment_backend_unique_ptr=
    std::unique_ptr<segment_backend,void(*)(segment_backend*)>;
  using value_pointer=void*;
  using const_value_pointer=const void*;
  using base_iterator=typename Model::base_iterator;
  using const_base_iterator=typename Model::const_base_iterator;
  template<typename T>
  using const_iterator=typename Model::template const_iterator<T>;
  using base_sentinel=typename Model::base_sentinel;
  using range=std::pair<base_iterator,base_sentinel>;

  segment_backend()=default;
  segment_backend(const segment_backend&)=delete;
  segment_backend& operator=(const segment_backend&)=delete;

  virtual                            ~segment_backend()=default;
  virtual segment_backend_unique_ptr copy()const=0;
  virtual segment_backend_unique_ptr copy(const Allocator&)const=0;
  virtual segment_backend_unique_ptr empty_copy(const Allocator&)const=0;
  virtual segment_backend_unique_ptr move(const Allocator&)=0;
  virtual bool                       equal(const segment_backend&)const=0;

  virtual Allocator     get_allocator()const noexcept=0;
  virtual base_iterator begin()const noexcept=0;
  virtual base_iterator end()const noexcept=0;
  virtual bool          empty()const noexcept=0;
  virtual std::size_t   size()const noexcept=0;
  virtual std::size_t   max_size()const noexcept=0;
  virtual std::size_t   capacity()const noexcept=0;
  virtual base_sentinel reserve(std::size_t)=0;
  virtual base_sentinel shrink_to_fit()=0;
  virtual range         push_back(const_value_pointer)=0;
  virtual range         push_back_move(value_pointer)=0;
  virtual range         insert(const_base_iterator,const_value_pointer)=0;
  virtual range         insert_move(const_base_iterator,value_pointer)=0;
  virtual range         erase(const_base_iterator)=0;
  virtual range         erase(const_base_iterator,const_base_iterator)=0;
  virtual range         erase_till_end(const_base_iterator)=0;
  virtual range         erase_from_begin(const_base_iterator)=0;
  virtual base_sentinel clear()noexcept=0;
};

} /* namespace poly_collection::detail */

} /* namespace poly_collection */

} /* namespace boost */

#endif

/* segment_backend.hpp
Jj2Eq4GBJjIsedk/gYGvquXPr+i1+y15uL/uHhGDWclGHwQT7INwsgpYVLNCFqEkQQhJrU/En6opkt9oCXCKt7ImRMBP0YBK1oVySJSZVhEfNUW5Dp26X8j29HJ20kryw1BPCrxJtluS0+BjogmTD5L8D1JhqWcIGypX253bT8I9hqh5G0OnJIdjyvPeuCXyThYOeWiQY2txWZwu5zx1G62+XfCm+c18PBfNV5jfZy3Xf2nt8shxBe5aN2SCQzq915CbomJnZ/pLZEKjPF/9Kk1igdX+5tbQhHMLpqETX+im1oioHyyCf6RbG/ZaoWDyqCkDfH+58/7q9ky+ovQX9tzZLK5u2d6kWCQTgT4J9PGyU+bIUuZonXA299oIDqwlT7Ytnf9C0Vfie9i5Pq8wHP/YjVu2CITNPWbxqVKFf75WoFKtpmSUCP35qmxv1vxnvyWFsddZyV5YSXanorgC+ULqclOTWxIj1px8wW9Eua+bm5SjWEHfNPfY6t0Ms3szU5yx2HCAvhPOzeHrxGICSvl7l34Xf3gxKWCX25FBvnyrPh9yNBksRozo2ganrMr2k2V8zy/xMaK9Gs5pxIXW2hJRlR9DMx5DPlmipSO+4i9tY1u/we7hp8UZ3HdPk6eA2JSrOJ7f1MPkpY7vwb4wbcZGLX8pB5ZWz5H6ZURzjdjK2HURFU+Tj4CrRqzWrjEN29HEVo85x7g1KseYZVRFROv1Nl/RquqnRwaRUmx4oJLZpCeu+MpgcBNlT/SdFMMSGUn4c2BTOxBgmn7vXMS4DY2xygj0EwOO0/mLAdc/vn3EDkhVN74+pdOrl9fbD4ylnklvnhB1LtEZH9ixsMYDxJhtyiKTCK4VXnwwWjNSMDjRKvnray7Qw+QfZQe1yZgl1EYfMuJzAm1GWQnlscSTr9l24WO7LCjgIi6yHPzV4zsoeImBKC2hmBTGE3Nvls6fBz0qnAkG2ZlH7zfWvX2+zffTaBQgNiao5abQF3Tz3Jpu5Kky/DYE3/nV+mRHSmm66EH5+UBwKS5l6oKYAcRFyYWkoarHtH2IPwUl85U7KVoHt4kCT7tbX2rYG5fTQ2+8Cmt6oJDnyWjhRwdxVbe/Oz0/efTP7t1XHcxCactcFjhL+yGqv1DQnnht/HGBS8aDijncHR2Osvt2xhSs+6iN9UPKF3Mg6sGbVOGL5zRkZ4XS64E0LMz8+vpfUXjlLDm8qQ4S+BTb76l9zzhh196DSPV2H1H/apoTiHqPld179SX63T4TR7YJov+ofHWh0P8ujVm8Ved96yFF2Tz5NYeP6oOUpQnznlxdbEOT1xSLou3RFDdgBovPvhQ6rl64FyQQE/LP56f9HPx+SnFnSlw7hZ/nJoo/KQfNldHz2ktPyNrki+Yei1PV6lboFh+aHIwEfsaPw83BnoO8rB+fJTCzBmNXjxe1xuPhL+8lg8kPfNX9tRFRYxgR5vxdxxp+4kybmp5qpqo+crVkfrlCk2Rv4CyRW6HgASDnv8mRQM6a5Rq5KJkx10HKFrnIck7bX2X8EBUfnqMtIklGigQ+jLiWGpx718UJ4zuNkofzcxHHa2ESuEX9dsLlDXKuckqGbCCBZRRaHeQByIswSpLjZAqSmRE5L2AfCqWCsHYxRXCj63jyg+8N+uDTPTWlvOOg2gHFULh3Z4vS7SpSwM47cspegchtz8PvA59/Ngc0rjYr+BL4LPbjvBL4nX/Wf0rQGT7buNUZPTNe9Lb/YCWiE/RDhWtDKTUluYFu6srYalrrcd9NhSNoyNt6xmZxmHt+4IvcKsYkgUrf2qn3ZuwiSvDOePFDMfmrBc/Axgj11Tz0b8PKzX8ko2vtM0mvisDOmoeTJXdTem6bv2sLhaOVbKtrPXHvm1kOq0PC+UOJyX4shlypIWVrIT2AMp++gzcPPZxRzFZ/8sr1gv+vnRGOx5I/zp6loXudaYFAzK2A4STkxN/djbQtmZeRNJJFmYm/33ryAbKteQFvfP8gZnM8fp7wyAsi+jsK66E5Btwy1vN+GMH7bOhJ9osw9Ns5Ba7tFaWpUHJTchvdRSaEBytAfMG47fCiPK5eAxyoJ64ILwj/91JNAIZZxWQy9GJbnOHwHnBwM5T8N7xNIYjOd+SBDNbBXzujlZh6m7YgZoRR4iN3InEDL52sDYleYltfMw7TsE5wmoUW2ep31xStIlny6lb+VgltnNZuBMbFVx7TSk0A/pcp5F4dF85mho8T1mTPWe/ff98YiyIHFXUDHNurmcNZd66slsE7KBcaEnwwH5hNO3ZG8O+5woqQQvvYnSEFX0YKjlQq+iMp3tGZ8DULsw2yr79HOtoyRmabIEyHDI0wROzRUrAkouC4Ns3x7dLaNXOk/FDIjFch9Ib95KA+4kp60XafSEHqQXbmJ7+N45hi9/wjBnLH/O4Hiy/cmV4vKY8WdHFnvy1OXMNqCznRIHqGZuUgSsrzfcONPf8K1vrTbZuDRmC4xelQwOE1IXzyCnAdszgjChWwucGRlbRRG6qXZxUjHaqGCuFjTUHOg/HwwHrG91yyI1yqnV3UQx4Nuj/jkKgV+bSYzKqzs0bgvt80YX4UafU7YvC5lGmOdBrOdMcw6Z9Xi36UuObzN98ZYbA5b9HwelRRsq/sQhrIOwrmJzxhfiTTZuN+FAUTg54XHDEFeIN1Q6HwcmYWsS+QIiyZd9K31mHrcos71xHHAeqZktfPRvT3F8povF36vKN+K007sbid0YU6/00SmpyA4coq9VLKplwTFYn3X/vDeGUVwIsQ/X5oXhUjXdlxajcf/GVpuNhcT/udlPG3YVEr4pCcKXIglsICXOhdRjZmmPnwfA827GlhdkmWK57qW2iWCDD+D5VVu5vEzuwkHVd7IsUdbVFwljtMn8SCTmqtB97XmiT/OhIa2+mim1PNBtXfmMpQRJg9khJ7fSks5H8fCi1Ozprd0oio/Dqz96HvTSjf8LVJccsuZ+kgxE4SJ5jBwGQ2wSnG5p7inyjtqGYaZo2xcuR6D40xQ3Tn20NXMqYQQdqwyIYxjrNcVItIh7FCozYmEcn+lWUDjCmBd0VhjSVOL9SWEIIMy2JrDirEweVOLezAPftzoopQY3LCjJA75tkxBJZeGeOM3bkBRlkZk8/0EAHOJYMHMj3hgjYdxV5hfugNZoZntjM9kSnKoYDCs664wDDqCm5EYrr6A9L8NcswjAaPQHziYlzREFkYhjzf1edAd+PFq1LLBvW7mVLk/FcQOj56kO4Owq87VOHaa3BRciukQPNnHHAcbhEREZy3krAwFhdaEX82cWc6f8oTpGFwcTgRPFbWuEJGHK9Z7BlF0uoCGPjD/tG1YHFakWTst2zHXyIC8MFojNiUTC4AoXcUF26RaNbFsVlqXO2x2Vdc7uRCazYXTBHrgYQtrJgleD5cqBn939MNs7j5lBa1mva6ZoH39k76+ky1huNT8D1mvIZSQa0hTGj+Wx5hrziRAfn22IzMpvRCC0NdAaOMWELRGybd434qMG9gQnjY3IAgzm9Tn8kUCWc6Ihyd1bpRv3zrE5uwXiZh9oIJ7HWjxd8u4CJ6w5JhV8YWXXOjs03wmU7ueIfemYXlOX1+eNhRY2LsbGq3jhA6pMGHoex3jbn3zDnEVzrFBfiQAkFQEkq9c3cUYcPMi1Qrju04Silu1d3xha+4XgnGXMHGOLREDXP9jFH6RL7aMcmMjnQKKM1CzeMrtg/m9qJz+XKJehfPBKHvWELzgYBwowjTShf8FwSjEweEWHIq+rgENng5ynL1yZRg7CyxWeSgMOYDVNaYAj0c7vSCRIjYPyewcc6l+GOzsUyjE3Rr47PguFkHBT6Mg39LtJzcn7x5oLS4w4hTnvaxgXa1m/mFNRCfstOp0MyqaBKwzock+HZYQQyJ94c2alBPPPLTxuWxBT2Ht41/Z3txtacbJmOKZzSpZtyJawSOHKIPSmQ7AHFfpom6A7Najg+M0eQ1zqc7b2jEXZd3uCNABwP0H/QkFkeVK2jRg5Nq+U148gyk+ohmbXlbFReEw3Y8XQQX+n+vWi62h672L2rNn/XcQKYcm0h2WVsoF62NXQJdEk1dIVupF3kzV2oXtabPhm4Gf559naqGVj4TNmKp27PXtsbtulGvfri5m7qTdrGs5Y5cGblpJFhHqF3oa0fOuekd5h1sG3QgdcQ3vdN1MbJM8Vx8dd1BhzRUISayaOjp9UjiN56lWf350kXYkVj1jdpKX/Wtw2XyGWJVR+itsg6oM25L3GI7NadqJcHxIUrBkZIzlP0u/iKyPwYjErv9+s7cWuvpYtX+nQ5VkSAoKSzzE6Yw/S9YIESSYADErxBcYhcUahTqwvDSAlVIoQoauagQml9UxMSwkge0UcpATcVvlhled2+Sfg1/0Pf39fnQiOfM/cVDI4d71+76+nqwdRRbtjWSNeLK9nKgbrj2kDEyWvUrDRmkenFzU42xxwdsPXe6Z3LqtaFJm1oIkgdRoLWCA9/pZ8XNw5cqCpOChwco/oYL1gvzwZqolyzBwPdlXSGjTlFJe1vdr8nDQ6C8TeDhD8butyVG6Mw2XMGO8OQATRhlFc24Fphq6QK5A9jzBWF7hvXM35WOJwT0llHoXNz2pJHJn3qwefZQtftviCFtkL0Dru7/zGqhwV+lReOgr/beLP/xy60chwBu1XOxGyPib3YLooW6HFp0duC1ZoyXg+z+0axrnWSTFB1kd1Be9yErYX0rKh0VzCqkYklOKSrtdBbAFIobtAU5SJ9Abm2rtFRG9lpryg0qQOnpTU2IjmEh94Lh6ulZiMyqL1lnX9C/wg5OOg3CYRgbez+iE36Ve2VV/OTS6cFCgg6By3eY5d5ViGdg2r54pIcRsDjjPuWpTflA9gs5B/9lzSZ6ObyE/GUP9TVurB92wzo7xCZqUA3li+SCdNKAa6Tqj+jVM5xP8f7rA0zZG+JMiyX9N6q2CtA4DvnNF2iRnE9mwKRyB0CVxmbLDe8pMsu+5DshIB92iC5/NWMqw3S2xaBXpo1jMG+YgTxG8YscgU6y/qfS8SR6lazjXTqU1z+9LqwQpF7btGp0nQuzPMHQrfoIOlqv/3rWpVzxH3S19X2vRt9XCfk0EhuHaRBf0x6JSoqJwmCxhj0J0lRi1CpGaygiYOhTc6Kjj8AopmKSD8mVaMGf+dzDbFdiprOL1Dnt+E1j15HtexAfj0ZzPLHImfhV55i+JZ1uYE38JvwkI/ZrwvPW8p9aW22yOAe68R/mk6qCJqF0pxrBZTafId3A7hXFD9MbBbwoa9ABrgghh82BfqBqjP3wEof+C37kd8i7ixSy6ylMFpw2e6kZWcP6hbVJzPA9cu+mZPOw6682BdmH+jo/p+aJREbz8BxqtGoZvhdZhc1/SoE+eRkTz3uos/loQ9L6m5onXLN4BTvBX1DatZGz4wVgBXMFckIbwWYBT+AE8NyoLqgWJCfKsy0F18F+8F6wD6gncrM8BfFCUiqFFLNRBX0FjgWXQk2CEkG9PzshXOBOUGarChQEa6YKMAtqBLuC4yDoIfTAvX64lMTP7v9nnGzzcbCZO9+QBYrzjSZCIQYJvrZK+bxuOa0F+WxlQWJBrCBPwBMEwS9uXBfmE+FZ1wKiAEKIS0OMs0vGB5aI1yBa+2T1IhumAltBFqHwwF54bugH11l3QffAvB89UF5IqpYIfIi4sLhwWRBZYOtED2KzwrMcQm1BhFA9v94ITogKCG1D1C3J1m88Cqj8jXJmGZCvELXbYmc5Z8X/t+sgechveWQ/HO1enpD0/haBEDi+HckT09nzgusAVzwL/xsipNMH8C2E26E5YaxBWAII/oG/3LAPU4Jz0yDh1yWA0lc7uxEie1DnQ4B3cClyGq3+BruRKScK/Oc8MquURRd2oe/+7jTN2KqWjZT/XW4JmgXWLL+UkQR2SrOMsQPlwKjw6DPDitVgla1xnRVQe2NZnzGB/XJQfr0lt157HQ4ByhZ2Hc2F97/rkVtQJmQflIQo3CN0HuwGRfCTu2oAe0l/5Evx3FZRwlPCpXTfhlH/y0SpWHWWcCzB+FhPXTqKOzrVQeyYVt1bboHUWdUvH4fiQbF+Fq2A4yxKT+oKxWkplSdo85Gm5KACY/Sd2miJG96La8iix7Oip/u1GtoX3EUXofCc+MOukmqAYda3gpSt45lAnuCf3BgRsvEABiz509nPjgDp/EWGfgE0VmiX3xaptT3dl+sE6yRF5zCEtRuPrCtSemKvZW4YPCuTtf3+Qhod8VT8e4h9g66uGhxEDQbRBA4e2mhE75/xm2qHvtMvrI5LqrMaC6JW98Qf1TxEx10EnvHNrHLNed3g1yn6ci1tS/0PFPw+bFB6cJ0wLngaXTO1D368ZkQnJLVPzP5J/BHWyfCJZniztThFmHe1ZHBGwEdZ8VLGHTAWVD7p6/qlLoy7F64txPd170LONwgkxmuo5+8tUQIFV5UPmoToLX1VA2IDNzTjd3mOWylDa/fC985opicMC13gLBHxB+3JzG8RAVgsbgpRC060ceZQbUE+wfsFQ8YAB7XZ37NUs8MF7voBelD9IJHVPfKrkUbmBdknbfs6BrePFWYdaM6rTDI48BcPO7JmBWXDAM0qsUuoFqYrEy9NsW4bMBChsE7AeFdxITL/5n7yj3fflBzrRnNKTXModVJ+T57+F58xLL5GAYPmDZha7o6sazUFyrY7ndub/Q+9LHld8bSmE+DeqBA/9y0OjuK1bMALL0++aLrB1EIzFKy2LHfajqAq6l7BZXeenVBSWKqAqIvyL1XR0jQBcVkAieb6NtU3DlPyKWLnuABXVWGSWwpIjAaFA7iw2cQc6Tart6cAi++SWmc1twTQY/ymhKGMlPR3rJRyStQv/2tB7/SDGv4ETFkWkqVMbom8xDEKYNsPiK1RjBNPFNs7d2Ke4u4KwqqRCwsVkdE0IFrd7mH3q/MW1dHsS+ce9VULVdReEbpW/+VepLepPiM0tKkeX+1w8EflLJlWUKJckiVsE6LTEsVyODE/QTTL8aChe/pCvyJ6PkC1mnqsS5lDvleyMLUxJQyAXeFHjlf2C5i2ialwRuL6r9VjHv4kgjx2A1VSB4hvJ0NMfZJpUFE3H+Ei4VUx/0PeN1G/Bl0abewPUCy1nyu2klqG/mw7ozsE8B/Kisywpd6lUJggzh9Jv+ak/ZBju961ZCc/n3Urndcc+nILIbuCyXuVX+xjUbA8KqCzY7GAaGOjhLZa3/DiKFPAdxG0lCIcXUedu7Mdzc8w8DmkK6GfIwO01Njsq+qjjpX7qFpKWIERMEWzNyUiShZN2QAQ6iYOK/5T+wkUN6rryXOS9+014JkRzTkb3AkaicsaiCUEY7pAvtQBLnqxt5SNpDFp4Plmmiw7MV95TpkLqU7iJOOB83rswbNw2nymTwz6bVDsAqUkzGaaML/E2V9b6gNYZcy2kiRU4O5mmrSfaFa/rV6Etsw8vt258KbVWB5mz3yqB1kk4bl0JVmkvhTZY4JofEmiWctFj7K+HCV1S4z+qbzXH8SWnu4lQgB0RaSGmvxTHuGlms7laYGlfoM84EiJETrS02Q2Wz/SKi241ZuNQ5LnLBVoxnNSlI7FdpLVNLU1kFWCfWDa4ogLe5gzbs2qdCm3ndZS8l6jzxqOD03zm6hlWtF5VAt4v8yVw2DcFaH8TLZDHPkfCvwPKQXI/ocKAVGeiLus6R5i0tkW6WBAmqT/EECn3FqgSQmVhClplIstuV5cVj5HPA8ptWiBfBqZZ4SAIztMFslm8jszzmVAG4hIck9qGkuone6kHSXao+GgHXpw1SNOIM1O/OpRd9xMr7xc2NmGNUWmERCnOIfk+cECal76uTG0noQa6CckfcR1kLiT0HnPGp5I2WJKU/QdljzplST6jUDpG1iaOLd97ehVkdczwn/MquGFmvgu2ai9PsnRA9kT/DD6bi2/ERgVafGqdMCeRLVmwVzU+2DCv1NZPBbyNq8OZ7Ng/BeKdtzCT4H2Hu0QX2T9B4bDuMYwsjO4lDoRI3dajK0FI6WhsZShCBkIK5JtW/JQbCTCZje5BDtFN6oxVyp7b38c3murjNk7cjKYFc7Dz9CGdA2H0drk8VM9VxZxcAKF9OjdxAlWavJ57IA7KeNaZVRB0qhXgUQ66KL4twEjd2o9hBbIwyCbObWdcrRhcZojCiNhXHIr4APNJDv2R5RIFkRKErEzcgs98VZiUuAbsSk4gnxCTfOgxqz6pGGJvW/euJRlcRE5rKQomVS2L9oaK3N7It2x0M6yDXdHRKuC70YTDlC/CDBnxiKVPMw57UPbpBXXivh0PgVLULPxl3ElUvv9sIELUfoZb+CIpxy0M2FTSJbawJsqBtQyLtbATHyKNf0URZQZ+yGlelCfEiOGytUtfgQmR5bvqC30L9Rpk+JOR4qGI7HVBeRpwwYjlD3qS0+dYILSARJTZ0+kp9I+pb/DUmRC6enIE2VNZZ8zOx8DB8yhXiPrsKwFrXymNcUCkU9rd7SfCLkgANedrQlNiI3UOqMiUkegD/bGmsGeDkD0N6Z84FTsZlvi21Ss25p4FqcFknc+8AdBg+rjjLJb4pXk7he7vC/TVOeX57gdM25FqD9/Waak3gdSA58J17zid3FOK3HPmX/SJTkRWc2NwMDpz3m37/sLsjuC+ZGvdE6+vs2Zt/B538HiUKD9xwBXaMvv4WM/5urQueX3SB2ZYj6kpII08WxfWVxuqhyV1gfWaHzExAZJ0nAREzuZ4qmoMdwy1agxO2g2jegxjf+sDx/7z/o0NdQlssFFaWXp1KOc6pqLPMMLqlM4wHWWQoJhjUkFlsZrXi5xqOSQGmF98oEqLdkzywHvrOqeCluOSmRzYpaayKmWE1IF2Gx+hrcKcU8L0O2jswmIrxjYIaOW/IRzKzxecTYt9UWpMTQjFdAdF1N5VuErfwZGoAzXfsw1/3NBd1SFS8FGcqLjkhcnpLnWKs0p8IDMtspqnxVjYdNgSec9qFqUe+yUlGt5PUMiXRJmFsWrxErtEvWVwNYI04BC/yagOGcoXUoTL3O8Tc15DSMp5iFhYeXgh1eUlk9sjpBOp0H5E0LHUYHnhY4TFt9QzheSlHwSe3qAxSVmpB2trVHuS16zJa2MOj2x+nsivgUl3z54lqX7r5a1CuY=
*/