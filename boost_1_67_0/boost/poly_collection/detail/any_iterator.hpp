/* Copyright 2016 Joaquin M Lopez Munoz.
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * See http://www.boost.org/libs/poly_collection for library home page.
 */

#ifndef BOOST_POLY_COLLECTION_DETAIL_ANY_ITERATOR_HPP
#define BOOST_POLY_COLLECTION_DETAIL_ANY_ITERATOR_HPP

#if defined(_MSC_VER)
#pragma once
#endif

#include <boost/iterator/iterator_adaptor.hpp>
#include <boost/type_erasure/any_cast.hpp>
#include <type_traits>
#include <utility>

namespace boost{

namespace poly_collection{

namespace detail{

/* type_erasure::any<Concept>* adaptor convertible to pointer to wrapped
 * entity.
 */

template<typename Any>
class any_iterator:public boost::iterator_adaptor<any_iterator<Any>,Any*>
{
public:
  any_iterator()=default;
  explicit any_iterator(Any* p)noexcept:any_iterator::iterator_adaptor_{p}{}
  any_iterator(const any_iterator&)=default;
  any_iterator& operator=(const any_iterator&)=default;

  template<
    typename NonConstAny,
    typename std::enable_if<
      std::is_same<Any,const NonConstAny>::value>::type* =nullptr
  >
  any_iterator(const any_iterator<NonConstAny>& x)noexcept:
    any_iterator::iterator_adaptor_{x.base()}{}

  template<
    typename NonConstAny,
    typename std::enable_if<
      std::is_same<Any,const NonConstAny>::value>::type* =nullptr
  >
  any_iterator& operator=(const any_iterator<NonConstAny>& x)noexcept
  {
    this->base_reference()=x.base();
    return *this;
  }

  /* interoperability with Any* */

  any_iterator& operator=(Any* p)noexcept
    {this->base_reference()=p;return *this;}
  operator Any*()const noexcept{return this->base();}

  /* interoperability with Concrete* */

  template<
    typename Concrete,
    typename std::enable_if<
      /* can't compile-time check concept compliance */
      !std::is_const<Any>::value||std::is_const<Concrete>::value
    >::type* =nullptr
  >
  explicit operator Concrete*()const noexcept
  {
    return const_cast<Concrete*>(
      static_cast<typename std::remove_const<Concrete>::type*>(
        type_erasure::any_cast<void*>(this->base())));
  }

private:
  template<typename>
  friend class any_iterator;
};

} /* namespace poly_collection::detail */

} /* namespace poly_collection */

} /* namespace boost */

#endif

/* any_iterator.hpp
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
*/