// Copyright (c) 2009-2016 Vladimir Batov.
// Use, modification and distribution are subject to the Boost Software License,
// Version 1.0. See http://www.boost.org/LICENSE_1_0.txt.

#ifndef BOOST_CONVERT_SPIRIT_BASED_CONVERTER_HPP
#define BOOST_CONVERT_SPIRIT_BASED_CONVERTER_HPP

#include <boost/convert/base.hpp>
#include <boost/convert/detail/config.hpp>
#include <boost/spirit/include/qi.hpp>
#include <boost/spirit/include/karma.hpp>

namespace boost { namespace cnv
{
    struct spirit;
}}

struct boost::cnv::spirit : public boost::cnv::cnvbase<boost::cnv::spirit>
{
    typedef boost::cnv::spirit             this_type;
    typedef boost::cnv::cnvbase<this_type> base_type;

    using base_type::operator();

    template<typename string_type, typename out_type>
    void
    str_to(cnv::range<string_type> range, optional<out_type>& result_out) const
    {
        typedef typename cnv::range<string_type>::iterator                  iterator;
        typedef typename boost::spirit::traits::create_parser<out_type>::type parser;

        iterator    beg = range.begin();
        iterator    end = range.end();
        out_type result;

        if (boost::spirit::qi::parse(beg, end, parser(), result))
            if (beg == end) // ensure the whole string has been parsed
                result_out = result;
    }
    template<typename in_type, typename char_type>
    cnv::range<char_type*>
    to_str(in_type value_in, char_type* beg) const
    {
        typedef typename boost::spirit::traits::create_generator<in_type>::type generator;

        char_type* end = beg;
        bool      good = boost::spirit::karma::generate(end, generator(), value_in);
        
        return cnv::range<char_type*>(beg, good ? end : beg);
    }
};

#endif // BOOST_CONVERT_SPIRIT_BASED_CONVERTER_HPP


/* spirit.hpp
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
*/