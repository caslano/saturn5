// Copyright 2019 Hans Dembinski
//
// Distributed under the Boost Software License, Version 1.0.
// (See accompanying file LICENSE_1_0.txt
// or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_HISTOGRAM_AXIS_METADATA_BASE_HPP
#define BOOST_HISTOGRAM_AXIS_METADATA_BASE_HPP

#include <boost/core/empty_value.hpp>
#include <boost/histogram/detail/relaxed_equal.hpp>
#include <boost/histogram/detail/replace_type.hpp>
#include <string>
#include <type_traits>

namespace boost {
namespace histogram {
namespace axis {

/// Meta data holder with space optimization for empty meta data types.
template <class Metadata,
          class DetailMetadata = detail::replace_default<Metadata, std::string>>
class metadata_base : empty_value<DetailMetadata> {
  using base_t = empty_value<DetailMetadata>;

protected:
  using metadata_type = DetailMetadata;

  // std::string explicitly guarantees nothrow only in C++17
  static_assert(std::is_same<metadata_type, std::string>::value ||
                    std::is_nothrow_move_constructible<metadata_type>::value,
                "metadata must be nothrow move constructible");

  metadata_base() = default;
  metadata_base(const metadata_base&) = default;
  metadata_base& operator=(const metadata_base&) = default;

  // make noexcept because std::string is nothrow move constructible only in C++17
  metadata_base(metadata_base&& o) noexcept : base_t(std::move(o)) {}
  metadata_base(metadata_type&& o) noexcept : base_t(empty_init_t{}, std::move(o)) {}
  // make noexcept because std::string is nothrow move constructible only in C++17
  metadata_base& operator=(metadata_base&& o) noexcept {
    base_t::operator=(o);
    return *this;
  }

public:
  /// Returns reference to metadata.
  metadata_type& metadata() noexcept { return base_t::get(); }

  /// Returns reference to const metadata.
  const metadata_type& metadata() const noexcept { return base_t::get(); }

  bool operator==(const metadata_base& o) const noexcept {
    return detail::relaxed_equal(metadata(), o.metadata());
  }

  bool operator!=(const metadata_base& o) const noexcept {
    return operator==(o.metadata());
  }
};

} // namespace axis
} // namespace histogram
} // namespace boost

#endif

/* metadata_base.hpp
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
*/