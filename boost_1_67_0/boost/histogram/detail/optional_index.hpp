// Copyright 2019 Hans Dembinski
//
// Distributed under the Boost Software License, Version 1.0.
// (See accompanying file LICENSE_1_0.txt
// or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_HISTOGRAM_DETAIL_OPTIONAL_INDEX_HPP
#define BOOST_HISTOGRAM_DETAIL_OPTIONAL_INDEX_HPP

#include <boost/assert.hpp>
#include <cstdint>

namespace boost {
namespace histogram {
namespace detail {

constexpr auto invalid_index = ~static_cast<std::size_t>(0);

// integer with a persistent invalid state, similar to NaN
struct optional_index {
  std::size_t value;

  optional_index& operator=(std::size_t x) noexcept {
    value = x;
    return *this;
  }

  optional_index& operator+=(std::intptr_t x) noexcept {
    BOOST_ASSERT(x >= 0 || static_cast<std::size_t>(-x) <= value);
    if (value != invalid_index) { value += x; }
    return *this;
  }

  optional_index& operator+=(const optional_index& x) noexcept {
    if (value != invalid_index) return operator+=(x.value);
    value = invalid_index;
    return *this;
  }

  operator std::size_t() const noexcept { return value; }

  friend bool operator<=(std::size_t x, optional_index idx) noexcept {
    return x <= idx.value;
  }
};

constexpr inline bool is_valid(const std::size_t) noexcept { return true; }

inline bool is_valid(const optional_index x) noexcept { return x.value != invalid_index; }

} // namespace detail
} // namespace histogram
} // namespace boost

#endif

/* optional_index.hpp
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
*/