// Copyright 2019 Hans Dembinski
//
// Distributed under the Boost Software License, Version 1.0.
// (See accompanying file LICENSE_1_0.txt
// or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_HISTOGRAM_DETAIL_TRY_CAST_HPP
#define BOOST_HISTOGRAM_DETAIL_TRY_CAST_HPP

#include <boost/config.hpp>
#include <boost/core/demangle.hpp>
#include <boost/histogram/detail/type_name.hpp>
#include <boost/mp11/integral.hpp>
#include <boost/throw_exception.hpp>
#include <stdexcept>
#include <string>
#include <type_traits>

namespace boost {
namespace histogram {
namespace detail {
template <class T, class E, class U>
BOOST_NORETURN T try_cast_impl(mp11::mp_int<0>, U&&) {
  BOOST_THROW_EXCEPTION(E("cannot cast " + type_name<T>() + " to " + type_name<U>()));
}

template <class T, class E, class U>
T try_cast_impl(mp11::mp_int<1>, U&& u) noexcept {
  return static_cast<T>(u);
}

template <class T, class E, class U>
decltype(auto) try_cast_impl(mp11::mp_int<2>, U&& u) noexcept {
  return std::forward<U>(u);
}

// cast fails at runtime with exception E instead of compile-time, T must be a value
template <class T, class E, class U>
decltype(auto) try_cast(U&& u) noexcept(std::is_convertible<U, T>::value) {
  return try_cast_impl<T, E>(mp11::mp_int<(std::is_convertible<U, T>::value +
                                           std::is_same<T, std::decay_t<U>>::value)>{},
                             std::forward<U>(u));
}

} // namespace detail
} // namespace histogram
} // namespace boost

#endif

/* try_cast.hpp
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
*/