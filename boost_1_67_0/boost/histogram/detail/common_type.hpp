// Copyright 2015-2018 Hans Dembinski
//
// Distributed under the Boost Software License, Version 1.0.
// (See accompanying file LICENSE_1_0.txt
// or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_HISTOGRAM_DETAIL_COMMON_TYPE_HPP
#define BOOST_HISTOGRAM_DETAIL_COMMON_TYPE_HPP

#include <boost/histogram/detail/detect.hpp>
#include <boost/histogram/fwd.hpp>
#include <boost/mp11/list.hpp>
#include <boost/mp11/utility.hpp>
#include <tuple>
#include <type_traits>

namespace boost {
namespace histogram {
namespace detail {
// clang-format off
template <class T, class U>
using common_axes = mp11::mp_cond<
  is_tuple<T>, T,
  is_tuple<U>, U,
  is_sequence_of_axis<T>, T,
  is_sequence_of_axis<U>, U,
  std::true_type, T
>;
// clang-format on

// Non-PODs rank highest, then floats, than integers; types with more capacity are higher
template <class Storage>
static constexpr std::size_t type_rank() {
  using T = typename Storage::value_type;
  return !std::is_pod<T>::value * 10000 + std::is_floating_point<T>::value * 100 +
         10 * sizeof(T) + 2 * is_array_like<Storage>::value +
         is_vector_like<Storage>::value;
  ;
}

template <class T, class U>
using common_storage = mp11::mp_if_c<(type_rank<T>() >= type_rank<U>()), T, U>;
} // namespace detail
} // namespace histogram
} // namespace boost

#endif

/* common_type.hpp
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
*/