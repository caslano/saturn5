// Copyright 2015-2018 Hans Dembinski
//
// Distributed under the Boost Software License, Version 1.0.
// (See accompanying file LICENSE_1_0.txt
// or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_HISTOGRAM_DETAIL_AT_HPP
#define BOOST_HISTOGRAM_DETAIL_AT_HPP

#include <boost/histogram/axis/option.hpp>
#include <boost/histogram/axis/traits.hpp>
#include <boost/histogram/detail/axes.hpp>
#include <boost/histogram/detail/linearize.hpp>
#include <boost/histogram/fwd.hpp>
#include <boost/mp11/algorithm.hpp>
#include <tuple>

namespace boost {
namespace histogram {
namespace detail {

template <class A, class... Us>
optional_index at(const A& axes, const std::tuple<Us...>& args) noexcept {
  optional_index idx{0}; // offset not used by linearize_index
  mp11::mp_for_each<mp11::mp_iota_c<sizeof...(Us)>>(
      [&, stride = static_cast<std::size_t>(1)](auto i) mutable {
        stride *= linearize_index(idx, stride, axis_get<i>(axes),
                                  static_cast<axis::index_type>(std::get<i>(args)));
      });
  return idx;
}

template <class A, class U>
optional_index at(const A& axes, const U& args) noexcept {
  optional_index idx{0};
  using std::begin;
  for_each_axis(axes, [&, it = begin(args),
                       stride = static_cast<std::size_t>(1)](const auto& a) mutable {
    stride *= linearize_index(idx, stride, a, static_cast<axis::index_type>(*it++));
  });
  return idx;
}

} // namespace detail
} // namespace histogram
} // namespace boost

#endif

/* at.hpp
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
*/