// Copyright 2018 Hans Dembinski
//
// Distributed under the Boost Software License, Version 1.0.
// (See accompanying file LICENSE_1_0.txt
// or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_HISTOGRAM_ALGORITHM_SUM_HPP
#define BOOST_HISTOGRAM_ALGORITHM_SUM_HPP

#include <boost/histogram/accumulators/sum.hpp>
#include <boost/histogram/fwd.hpp>
#include <boost/histogram/indexed.hpp>
#include <boost/mp11/utility.hpp>
#include <type_traits>

namespace boost {
namespace histogram {
namespace algorithm {

/** Compute the sum over all histogram cells (underflow/overflow included by default).

  The implementation favors accuracy and protection against overflow over speed. If the
  value type of the histogram is an integral or floating point type,
  accumulators::sum<double> is used to compute the sum, else the original value type is
  used. Compilation fails, if the value type does not support operator+=. The return type
  is double if the value type of the histogram is integral or floating point, and the
  original value type otherwise.

  If you need a different trade-off, you can write your own loop or use `std::accumulate`:
  ```
  // iterate over all bins
  auto sum_all = std::accumulate(hist.begin(), hist.end(), 0.0);

  // skip underflow/overflow bins
  double sum = 0;
  for (auto&& x : indexed(hist))
    sum += *x; // dereference accessor

  // or:
  // auto ind = boost::histogram::indexed(hist);
  // auto sum = std::accumulate(ind.begin(), ind.end(), 0.0);
  ```

  @returns accumulator type or double

  @param hist Const reference to the histogram.
  @param cov  Iterate over all or only inner bins (optional, default: all).
*/
template <class A, class S>
auto sum(const histogram<A, S>& hist, const coverage cov = coverage::all) {
  using T = typename histogram<A, S>::value_type;
  using sum_type = mp11::mp_if<std::is_arithmetic<T>, accumulators::sum<double>, T>;
  sum_type sum;
  if (cov == coverage::all)
    for (auto&& x : hist) sum += x;
  else
    // sum += x also works if sum_type::operator+=(const sum_type&) exists
    for (auto&& x : indexed(hist)) sum += *x;
  using R = mp11::mp_if<std::is_arithmetic<T>, double, T>;
  return static_cast<R>(sum);
}

} // namespace algorithm
} // namespace histogram
} // namespace boost

#endif

/* sum.hpp
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
*/