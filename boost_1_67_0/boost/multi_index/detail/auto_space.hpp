/* Copyright 2003-2020 Joaquin M Lopez Munoz.
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * See http://www.boost.org/libs/multi_index for library home page.
 */

#ifndef BOOST_MULTI_INDEX_DETAIL_AUTO_SPACE_HPP
#define BOOST_MULTI_INDEX_DETAIL_AUTO_SPACE_HPP

#if defined(_MSC_VER)
#pragma once
#endif

#include <boost/config.hpp> /* keep it first to prevent nasty warns in MSVC */
#include <algorithm>
#include <boost/multi_index/detail/adl_swap.hpp>
#include <boost/multi_index/detail/allocator_traits.hpp>
#include <boost/noncopyable.hpp>
#include <boost/type_traits/integral_constant.hpp>
#include <memory>

namespace boost{

namespace multi_index{

namespace detail{

/* auto_space provides uninitialized space suitably to store
 * a given number of elements of a given type.
 */

/* NB: it is not clear whether using an allocator to handle
 * zero-sized arrays of elements is conformant or not. GCC 3.3.1
 * and prior fail here, other stdlibs handle the issue gracefully.
 * To be on the safe side, the case n==0 is given special treatment.
 * References:
 *   GCC Bugzilla, "standard allocator crashes when deallocating segment
 *    "of zero length", http://gcc.gnu.org/bugzilla/show_bug.cgi?id=14176
 *   C++ Standard Library Defect Report List (Revision 28), issue 199
 *     "What does allocate(0) return?",
 *     http://www.open-std.org/jtc1/sc22/wg21/docs/lwg-defects.html#199
 */

template<typename T,typename Allocator=std::allocator<T> >
struct auto_space:private noncopyable
{
  typedef typename rebind_alloc_for<
    Allocator,T>
  ::type                                   allocator;
  typedef allocator_traits<allocator>      alloc_traits;
  typedef typename alloc_traits::pointer   pointer;
  typedef typename alloc_traits::size_type size_type;

  explicit auto_space(const Allocator& al=Allocator(),size_type n=1):
  al_(al),n_(n),data_(n_?alloc_traits::allocate(al_,n_):pointer(0))
  {}

  ~auto_space(){if(n_)alloc_traits::deallocate(al_,data_,n_);}

  Allocator get_allocator()const{return al_;}

  pointer data()const{return data_;}

  void swap(auto_space& x)
  {
    swap(
      x,
      boost::integral_constant<
        bool,alloc_traits::propagate_on_container_swap::value>());
  }

  void swap(auto_space& x,boost::true_type /* swap_allocators */)
  {
    adl_swap(al_,x.al_);
    std::swap(n_,x.n_);
    std::swap(data_,x.data_);
  }
    
  void swap(auto_space& x,boost::false_type /* swap_allocators */)
  {
    std::swap(n_,x.n_);
    std::swap(data_,x.data_);
  }

private:
  allocator al_;
  size_type n_;
  pointer   data_;
};

template<typename T,typename Allocator>
void swap(auto_space<T,Allocator>& x,auto_space<T,Allocator>& y)
{
  x.swap(y);
}

} /* namespace multi_index::detail */

} /* namespace multi_index */

} /* namespace boost */

#endif

/* auto_space.hpp
+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
*/