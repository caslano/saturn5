/* Copyright 2006-2015 Joaquin M Lopez Munoz.
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * See http://www.boost.org/libs/flyweight for library home page.
 */

#ifndef BOOST_FLYWEIGHT_ASSOC_CONTAINER_FACTORY_HPP
#define BOOST_FLYWEIGHT_ASSOC_CONTAINER_FACTORY_HPP

#if defined(_MSC_VER)
#pragma once
#endif

#include <boost/config.hpp> /* keep it first to prevent nasty warns in MSVC */
#include <boost/flyweight/assoc_container_factory_fwd.hpp>
#include <boost/flyweight/detail/is_placeholder_expr.hpp>
#include <boost/flyweight/detail/nested_xxx_if_not_ph.hpp>
#include <boost/flyweight/factory_tag.hpp>
#include <boost/mpl/apply.hpp>
#include <boost/mpl/aux_/lambda_support.hpp>
#include <boost/mpl/if.hpp>

#if !defined(BOOST_NO_CXX11_RVALUE_REFERENCES)
#include <utility>
#endif

namespace boost{namespace flyweights{namespace detail{
BOOST_FLYWEIGHT_NESTED_XXX_IF_NOT_PLACEHOLDER_EXPRESSION_DEF(iterator)
BOOST_FLYWEIGHT_NESTED_XXX_IF_NOT_PLACEHOLDER_EXPRESSION_DEF(value_type)
}}} /* namespace boost::flyweights::detail */

/* Factory class using a given associative container.
 */

namespace boost{

namespace flyweights{

template<typename Container>
class assoc_container_factory_class:public factory_marker
{
public:
  /* When assoc_container_factory_class<Container> is an MPL placeholder
   * expression, referring to Container::iterator and Container::value_type
   * force the MPL placeholder expression Container to be instantiated, which
   * is wasteful and can fail in concept-checked STL implementations.
   * We protect ourselves against this circumstance.
   */

  typedef typename detail::nested_iterator_if_not_placeholder_expression<
    Container
  >::type                                handle_type;
  typedef typename detail::nested_value_type_if_not_placeholder_expression<
    Container
  >::type                                entry_type;
  
  handle_type insert(const entry_type& x)
  {
    return cont.insert(x).first;
  }

#if !defined(BOOST_NO_CXX11_RVALUE_REFERENCES)
  handle_type insert(entry_type&& x)
  {
    return cont.insert(std::move(x)).first;
  }
#endif

  void erase(handle_type h)
  {
    cont.erase(h);
  }

  static const entry_type& entry(handle_type h){return *h;}

private:
  /* As above, avoid instantiating Container if it is an
   * MPL placeholder expression.
   */

  typedef typename mpl::if_<
    detail::is_placeholder_expression<Container>,
    int,
    Container
  >::type container_type;
  container_type cont;

public:
  typedef assoc_container_factory_class type;
  BOOST_MPL_AUX_LAMBDA_SUPPORT(1,assoc_container_factory_class,(Container))
};

/* assoc_container_factory_class specifier */

template<
  typename ContainerSpecifier
  BOOST_FLYWEIGHT_NOT_A_PLACEHOLDER_EXPRESSION_DEF
>
struct assoc_container_factory:factory_marker
{
  template<typename Entry,typename Key>
  struct apply
  {
    typedef assoc_container_factory_class<
      typename mpl::apply2<ContainerSpecifier,Entry,Key>::type
    > type;
  };
};

}  /* namespace flyweights */

} /* namespace boost */

#endif

/* assoc_container_factory.hpp
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
*/