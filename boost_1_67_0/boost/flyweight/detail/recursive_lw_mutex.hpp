/* Copyright 2006-2013 Joaquin M Lopez Munoz.
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * See http://www.boost.org/libs/flyweight for library home page.
 */

#ifndef BOOST_FLYWEIGHT_DETAIL_RECURSIVE_LW_MUTEX_HPP
#define BOOST_FLYWEIGHT_DETAIL_RECURSIVE_LW_MUTEX_HPP

#if defined(_MSC_VER)
#pragma once
#endif

/* Recursive lightweight mutex. Relies entirely on
 * boost::detail::lightweight_mutex, except in Pthreads, where we
 * explicitly use the PTHREAD_MUTEX_RECURSIVE attribute
 * (lightweight_mutex uses the default mutex type instead).
 */

#include <boost/config.hpp>

#if !defined(BOOST_HAS_PTHREADS)
#include <boost/detail/lightweight_mutex.hpp>
namespace boost{

namespace flyweights{

namespace detail{

typedef boost::detail::lightweight_mutex recursive_lightweight_mutex;

} /* namespace flyweights::detail */

} /* namespace flyweights */

} /* namespace boost */
#else
/* code shamelessly ripped from <boost/detail/lwm_pthreads.hpp> */

#include <boost/assert.hpp>
#include <boost/noncopyable.hpp>
#include <pthread.h>

namespace boost{

namespace flyweights{

namespace detail{

struct recursive_lightweight_mutex:noncopyable
{
  recursive_lightweight_mutex()
  {
    pthread_mutexattr_t attr;
    BOOST_VERIFY(pthread_mutexattr_init(&attr)==0);
    BOOST_VERIFY(pthread_mutexattr_settype(&attr,PTHREAD_MUTEX_RECURSIVE)==0);
    BOOST_VERIFY(pthread_mutex_init(&m_,&attr)==0);
    BOOST_VERIFY(pthread_mutexattr_destroy(&attr)==0);
  }

  ~recursive_lightweight_mutex(){pthread_mutex_destroy(&m_);}

  struct scoped_lock;
  friend struct scoped_lock;
  struct scoped_lock:noncopyable
  {
  public:
    scoped_lock(recursive_lightweight_mutex& m):m_(m.m_)
    {
      BOOST_VERIFY(pthread_mutex_lock(&m_)==0);
    }

    ~scoped_lock(){BOOST_VERIFY(pthread_mutex_unlock(&m_)==0);}

  private:
    pthread_mutex_t& m_;
  };

private:
  pthread_mutex_t m_;
};

} /* namespace flyweights::detail */

} /* namespace flyweights */

} /* namespace boost */
#endif

#endif

/* recursive_lw_mutex.hpp
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
*/