/* Copyright 2006-2014 Joaquin M Lopez Munoz.
 * Distributed under the Boost Software License, Version 1.0.
 * (See accompanying file LICENSE_1_0.txt or copy at
 * http://www.boost.org/LICENSE_1_0.txt)
 *
 * See http://www.boost.org/libs/flyweight for library home page.
 */

#ifndef BOOST_FLYWEIGHT_DETAIL_ARCHIVE_CONSTRUCTED_HPP
#define BOOST_FLYWEIGHT_DETAIL_ARCHIVE_CONSTRUCTED_HPP

#if defined(_MSC_VER)&&(_MSC_VER>=1200)
#pragma once
#endif

#include <boost/config.hpp> /* keep it first to prevent nasty warns in MSVC */
#include <boost/detail/no_exceptions_support.hpp>
#include <boost/noncopyable.hpp>
#include <boost/serialization/serialization.hpp>
#include <boost/type_traits/aligned_storage.hpp>
#include <boost/type_traits/alignment_of.hpp> 

namespace boost{

namespace flyweights{

namespace detail{

/* constructs a stack-based object from a serialization archive */

template<typename T>
struct archive_constructed:private noncopyable
{
  template<class Archive>
  archive_constructed(Archive& ar,const unsigned int version)
  {
    serialization::load_construct_data_adl(ar,&get(),version);
    BOOST_TRY{
      ar>>get();
    }
    BOOST_CATCH(...){
      (&get())->~T();
      BOOST_RETHROW;
    }
    BOOST_CATCH_END
  }

  template<class Archive>
  archive_constructed(const char* name,Archive& ar,const unsigned int version)
  {
    serialization::load_construct_data_adl(ar,&get(),version);
    BOOST_TRY{
      ar>>serialization::make_nvp(name,get());
    }
    BOOST_CATCH(...){
      (&get())->~T();
      BOOST_RETHROW;
    }
    BOOST_CATCH_END
  }

  ~archive_constructed()
  {
    (&get())->~T();
  }

  T& get(){return *static_cast<T*>(static_cast<void*>(&space));}

private:
  typename aligned_storage<sizeof(T),alignment_of<T>::value>::type space;
};

} /* namespace flyweights::detail */

} /* namespace flyweights */

} /* namespace boost */

#endif

/* archive_constructed.hpp
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
*/