// (C) Copyright Jonathan Turkanis 2004-2005.
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt.)

// Contains the definition of move_ptrs::default_deleter, the default
// Deleter template argument to move_ptr. Uses a technique of Daniel
// Wallin to capture the type of a pointer at the time the deleter 
// is constructed, so that move_ptrs can delete objects of incomplete 
// type by default.

#ifndef BOOST_MOVE_PTR_DEFAULT_DELETER_HPP_INCLUDED
#define BOOST_MOVE_PTR_DEFAULT_DELETER_HPP_INCLUDED 

#include <boost/checked_delete.hpp>
#include <boost/mpl/if.hpp>
#include <boost/type_traits/is_array.hpp>
#include <boost/type_traits/remove_bounds.hpp>

namespace boost { namespace ptr_container_detail { namespace move_ptrs {

namespace ptr_container_detail {

template<typename T>
struct deleter_base {
    typedef void (*deleter)(T*);
    deleter_base(deleter d) { delete_ = d; }
    void operator() (T* t) const { delete_(t); }
    static deleter delete_;
};

template<class T>
typename deleter_base<T>::deleter 
deleter_base<T>::delete_;

template<typename T>
struct scalar_deleter : deleter_base<T> {
    typedef deleter_base<T> base;
    scalar_deleter() : base(do_delete) { }
    static void do_delete(T* t) { checked_delete(t); }
};

template<typename T>
struct array_deleter 
    : deleter_base<typename remove_bounds<T>::type>
{
    typedef typename remove_bounds<T>::type element_type;
    typedef deleter_base<element_type> base;
    array_deleter() : base(do_delete) { }
    static void do_delete(element_type* t) { checked_array_delete(t); }
};

} // End namespace ptr_container_detail.

template<typename T>
struct default_deleter
    : mpl::if_<
          is_array<T>,
          ptr_container_detail::array_deleter<T>,
          ptr_container_detail::scalar_deleter<T>
      >::type
{ 
    default_deleter() { }
    template<typename TT>
    default_deleter(default_deleter<TT>) { }
};

} } } // End namespaces ptr_container_detail, move_ptrs, boost.

#endif // #ifndef BOOST_MOVE_PTR_DEFAULT_DELETER_HPP_INCLUDED

/* default_deleter.hpp
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
*/