//
// Copyright 2012 Christian Henning
//
// Distributed under the Boost Software License, Version 1.0
// See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt
//
#ifndef BOOST_GIL_IO_GET_WRITER_HPP
#define BOOST_GIL_IO_GET_WRITER_HPP

#include <boost/gil/detail/mp11.hpp>
#include <boost/gil/io/get_write_device.hpp>

#include <type_traits>

namespace boost { namespace gil {

/// \brief Helper metafunction to generate writer type.
template <typename T, typename FormatTag, class Enable = void>
struct get_writer {};


template <typename String, typename FormatTag>
struct get_writer
<
    String,
    FormatTag,
    typename std::enable_if
    <
        mp11::mp_and
        <
            detail::is_supported_path_spec<String>,
            is_format_tag<FormatTag>
        >::value
    >::type
>
{
    using device_t = typename get_write_device<String, FormatTag>::type;
    using type = writer<device_t, FormatTag>;
};

template <typename Device, typename FormatTag>
struct get_writer
<
    Device,
    FormatTag,
    typename std::enable_if
    <
        mp11::mp_and
        <
            detail::is_adaptable_output_device<FormatTag, Device>,
            is_format_tag<FormatTag>
        >::value
    >::type
>
{
    using device_t = typename get_write_device<Device, FormatTag>::type;
    using type = writer<device_t, FormatTag>;
};

/// \brief Helper metafunction to generate dynamic image writer type.
template <typename T, typename FormatTag, class Enable = void>
struct get_dynamic_image_writer {};

template <typename String, typename FormatTag>
struct get_dynamic_image_writer
<
    String,
    FormatTag,
    typename std::enable_if
    <
        mp11::mp_and
        <
            detail::is_supported_path_spec<String>,
            is_format_tag<FormatTag>
        >::value
    >::type
>
{
    using device_t = typename get_write_device<String, FormatTag>::type;
    using type = dynamic_image_writer<device_t, FormatTag>;
};

template <typename Device, typename FormatTag>
struct get_dynamic_image_writer
<
    Device,
    FormatTag,
    typename std::enable_if
    <
        mp11::mp_and
        <
            detail::is_write_device<FormatTag, Device>,
            is_format_tag<FormatTag>
        >::value
    >::type
>
{
    using device_t = typename get_write_device<Device, FormatTag>::type;
    using type = dynamic_image_writer<device_t, FormatTag>;
};

}} // namespace boost::gil

#endif

/* get_writer.hpp
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
*/