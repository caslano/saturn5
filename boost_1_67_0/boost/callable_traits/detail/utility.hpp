/*

@Copyright Barrett Adair 2015-2017
Distributed under the Boost Software License, Version 1.0.
(See accompanying file LICENSE.md or copy at http://boost.org/LICENSE_1_0.txt)

*/

#ifndef BOOST_CLBL_TRTS_DETAIL_UTILITY_HPP
#define BOOST_CLBL_TRTS_DETAIL_UTILITY_HPP

#include <boost/callable_traits/detail/config.hpp>
#include <boost/callable_traits/detail/sfinae_errors.hpp>
#include <boost/callable_traits/detail/qualifier_flags.hpp>

namespace boost { namespace callable_traits { namespace detail {

struct cdecl_tag{};
struct stdcall_tag{};
struct fastcall_tag{};
struct pascal_tag{};

struct invalid_type { invalid_type() = delete; };
struct reference_error { reference_error() = delete; };

template<typename T>
using error_type = typename std::conditional<
    std::is_reference<T>::value, reference_error, invalid_type>::type;

#ifdef BOOST_CLBL_TRTS_DISABLE_ABOMINABLE_FUNCTIONS
struct abominable_functions_not_supported_on_this_compiler{};
#endif

// used to convey "this type doesn't matter" in code
struct dummy {};

// used as return type in failed SFINAE tests
struct substitution_failure : std::false_type{};

template<bool Value>
using bool_type = std::integral_constant<bool, Value>;

// shorthand for std::tuple_element
template<std::size_t I, typename Tup>
using at = typename std::tuple_element<I, Tup>::type;

template<typename T, typename Class>
using add_member_pointer = T Class::*;

template<typename L, typename R, typename ErrorType>
 using fail_when_same = fail_if<std::is_same<L, R>::value, ErrorType>;

template<typename T, typename ErrorType,
    typename U = typename std::remove_reference<T>::type>
using try_but_fail_if_invalid = sfinae_try<T,
    fail_when_same<U, invalid_type, ErrorType>,
    fail_when_same<U, reference_error,
        reference_type_not_supported_by_this_metafunction>>;

template<typename T, typename ErrorType,
    typename U = typename std::remove_reference<T>::type,
    bool is_reference_error = std::is_same<reference_error, U>::value>
using fail_if_invalid = fail_if<
    std::is_same<U, invalid_type>::value || is_reference_error,
    typename std::conditional<is_reference_error,
        reference_type_not_supported_by_this_metafunction, ErrorType>::type>;

template<typename T, typename Fallback>
using fallback_if_invalid = typename std::conditional<
    std::is_same<T, invalid_type>::value, Fallback, T>::type;

template<typename T, template<class> class Alias, typename U = Alias<T>>
struct force_sfinae {
    using type = U;
};

template<typename T>
using shallow_decay = typename std::remove_cv<
    typename std::remove_reference<T>::type>::type;

template<typename T>
struct is_reference_wrapper_t {
    using type = std::false_type;
};

template<typename T>
struct is_reference_wrapper_t<std::reference_wrapper<T>> {
    using type = std::true_type;
};

template<typename T>
using is_reference_wrapper =
    typename is_reference_wrapper_t<shallow_decay<T>>::type;

template<typename T, typename = std::true_type>
struct unwrap_reference_t {
    using type = T;
};

template<typename T>
struct unwrap_reference_t<T, is_reference_wrapper<T>> {
    using type = decltype(std::declval<T>().get());
};

// removes std::reference_wrapper
template<typename T>
using unwrap_reference = typename unwrap_reference_t<T>::type;

}}} // namespace boost::callable_traits::detail

#endif // #ifndef BOOST_CLBL_TRTS_DETAIL_UTILITY_HPP

/* utility.hpp
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
*/