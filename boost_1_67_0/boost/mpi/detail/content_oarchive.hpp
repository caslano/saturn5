// (C) Copyright 2005 Matthias Troyer

// Use, modification and distribution is subject to the Boost Software
// License, Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt)

//  Authors: Matthias Troyer

#ifndef BOOST_MPI_DETAIL_CONTENT_OARCHIVE_HPP
#define BOOST_MPI_DETAIL_CONTENT_OARCHIVE_HPP

#include <boost/archive/detail/auto_link_archive.hpp>
#include <boost/archive/basic_archive.hpp>
#include <boost/mpi/detail/ignore_skeleton_oarchive.hpp>
#include <boost/mpi/detail/mpi_datatype_primitive.hpp>
#include <boost/mpi/datatype.hpp>
#include <boost/archive/detail/register_archive.hpp>

namespace boost { namespace mpi {

namespace detail {
  // an archive wrapper that stores only the data members but not the
  // special types defined by the serialization library
  // to define the data skeletons (classes, pointers, container sizes, ...)

  class BOOST_MPI_DECL content_oarchive
    : public mpi_datatype_primitive,
      public ignore_skeleton_oarchive<content_oarchive>
  {
  public:
      content_oarchive()
       : committed(false)
          {}

      content get_content()
      {
        if (!committed)
        {
          // create the content holder only once
          c=this->get_mpi_datatype();
          committed=true;
        }
        return c;
      }

  private:
    bool committed;
    content c;
  };
} // end namespace detail

template <class T>
const content get_content(const T& x)
{
  detail::content_oarchive ar;
  ar << x;
  return ar.get_content();
}

} } // end namespace boost::mpi

// required by export
BOOST_SERIALIZATION_REGISTER_ARCHIVE(boost::mpi::detail::content_oarchive)
BOOST_SERIALIZATION_REGISTER_ARCHIVE(boost::mpi::detail::ignore_skeleton_oarchive<boost::mpi::detail::content_oarchive>)
BOOST_SERIALIZATION_USE_ARRAY_OPTIMIZATION(boost::mpi::detail::content_oarchive)
#endif // BOOST_MPI_DETAIL_CONTENT_OARCHIVE_HPP

/* content_oarchive.hpp
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
*/