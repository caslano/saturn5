//          Copyright Alain Miniussi 2014.
// Distributed under the Boost Software License, Version 1.0.
//    (See accompanying file LICENSE_1_0.txt or copy at
//          http://www.boost.org/LICENSE_1_0.txt)

// Authors: Alain Miniussi

#ifndef BOOST_MPI_OFFSETS_HPP
#define BOOST_MPI_OFFSETS_HPP

#include <vector>
#include <boost/mpi/config.hpp>
#include <boost/mpi/communicator.hpp>

namespace boost { namespace mpi {
namespace detail {

// Convert a sequence of sizes [S0..Sn] to a sequence displacement 
// [O0..On] where O[0] = 0 and O[k+1] = O[k]+S[k].
void BOOST_MPI_DECL sizes2offsets(int const* sizes, int* offsets, int n);

// Same as size2offset(sizes.data(), offsets.data(), sizes.size())
void BOOST_MPI_DECL sizes2offsets(std::vector<int> const& sizes, std::vector<int>& offsets);

// Given a sequence of sizes (typically the number of records dispatched
// to each process in a scater) and a sequence of displacements (typically the
// slot index at with those record starts), convert the later to a number 
// of skipped slots.
void offsets2skipped(int const* sizes, int const* offsets, int* skipped, int n);

// Reconstruct offsets from sizes assuming no padding.
// Only takes place if on the root process and if 
// displs are not already provided.
// If memory was allocated, returns a pointer to it
// otherwise null.
int* make_offsets(communicator const& comm, int const* sizes, int const* displs, int root = -1);

// Reconstruct skip slots from sizes and offsets.
// Only takes place if on the root process and if 
// displs are provided.
// If memory was allocated, returns a pointer to it
// otherwise null.
int* make_skipped_slots(communicator const& comm, int const* sizes, int const* displs, int root = -1);

}
}}// end namespace boost::mpi

#endif // BOOST_MPI_OFFSETS_HPP

/* offsets.hpp
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
*/