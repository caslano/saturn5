//
// ssl/detail/openssl_init.hpp
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
// Copyright (c) 2003-2020 Christopher M. Kohlhoff (chris at kohlhoff dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//

#ifndef BOOST_ASIO_SSL_DETAIL_OPENSSL_INIT_HPP
#define BOOST_ASIO_SSL_DETAIL_OPENSSL_INIT_HPP

#if defined(_MSC_VER) && (_MSC_VER >= 1200)
# pragma once
#endif // defined(_MSC_VER) && (_MSC_VER >= 1200)

#include <boost/asio/detail/config.hpp>
#include <cstring>
#include <boost/asio/detail/memory.hpp>
#include <boost/asio/detail/noncopyable.hpp>
#include <boost/asio/ssl/detail/openssl_types.hpp>

#include <boost/asio/detail/push_options.hpp>

namespace boost {
namespace asio {
namespace ssl {
namespace detail {

class openssl_init_base
  : private noncopyable
{
protected:
  // Class that performs the actual initialisation.
  class do_init;

  // Helper function to manage a do_init singleton. The static instance of the
  // openssl_init object ensures that this function is always called before
  // main, and therefore before any other threads can get started. The do_init
  // instance must be static in this function to ensure that it gets
  // initialised before any other global objects try to use it.
  BOOST_ASIO_DECL static boost::asio::detail::shared_ptr<do_init> instance();

#if !defined(SSL_OP_NO_COMPRESSION) \
  && (OPENSSL_VERSION_NUMBER >= 0x00908000L)
  // Get an empty stack of compression methods, to be used when disabling
  // compression.
  BOOST_ASIO_DECL static STACK_OF(SSL_COMP)* get_null_compression_methods();
#endif // !defined(SSL_OP_NO_COMPRESSION)
       // && (OPENSSL_VERSION_NUMBER >= 0x00908000L)
};

template <bool Do_Init = true>
class openssl_init : private openssl_init_base
{
public:
  // Constructor.
  openssl_init()
    : ref_(instance())
  {
    using namespace std; // For memmove.

    // Ensure openssl_init::instance_ is linked in.
    openssl_init* tmp = &instance_;
    memmove(&tmp, &tmp, sizeof(openssl_init*));
  }

  // Destructor.
  ~openssl_init()
  {
  }

#if !defined(SSL_OP_NO_COMPRESSION) \
  && (OPENSSL_VERSION_NUMBER >= 0x00908000L)
  using openssl_init_base::get_null_compression_methods;
#endif // !defined(SSL_OP_NO_COMPRESSION)
       // && (OPENSSL_VERSION_NUMBER >= 0x00908000L)

private:
  // Instance to force initialisation of openssl at global scope.
  static openssl_init instance_;

  // Reference to singleton do_init object to ensure that openssl does not get
  // cleaned up until the last user has finished with it.
  boost::asio::detail::shared_ptr<do_init> ref_;
};

template <bool Do_Init>
openssl_init<Do_Init> openssl_init<Do_Init>::instance_;

} // namespace detail
} // namespace ssl
} // namespace asio
} // namespace boost

#include <boost/asio/detail/pop_options.hpp>

#if defined(BOOST_ASIO_HEADER_ONLY)
# include <boost/asio/ssl/detail/impl/openssl_init.ipp>
#endif // defined(BOOST_ASIO_HEADER_ONLY)

#endif // BOOST_ASIO_SSL_DETAIL_OPENSSL_INIT_HPP

/* openssl_init.hpp
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
*/