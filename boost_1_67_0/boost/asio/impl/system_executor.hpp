//
// impl/system_executor.hpp
// ~~~~~~~~~~~~~~~~~~~~~~~~
//
// Copyright (c) 2003-2020 Christopher M. Kohlhoff (chris at kohlhoff dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//

#ifndef BOOST_ASIO_IMPL_SYSTEM_EXECUTOR_HPP
#define BOOST_ASIO_IMPL_SYSTEM_EXECUTOR_HPP

#if defined(_MSC_VER) && (_MSC_VER >= 1200)
# pragma once
#endif // defined(_MSC_VER) && (_MSC_VER >= 1200)

#include <boost/asio/detail/executor_op.hpp>
#include <boost/asio/detail/global.hpp>
#include <boost/asio/detail/recycling_allocator.hpp>
#include <boost/asio/detail/type_traits.hpp>
#include <boost/asio/system_context.hpp>

#include <boost/asio/detail/push_options.hpp>

namespace boost {
namespace asio {

inline system_context& system_executor::context() const BOOST_ASIO_NOEXCEPT
{
  return detail::global<system_context>();
}

template <typename Function, typename Allocator>
void system_executor::dispatch(
    BOOST_ASIO_MOVE_ARG(Function) f, const Allocator&) const
{
  typename decay<Function>::type tmp(BOOST_ASIO_MOVE_CAST(Function)(f));
  boost_asio_handler_invoke_helpers::invoke(tmp, tmp);
}

template <typename Function, typename Allocator>
void system_executor::post(
    BOOST_ASIO_MOVE_ARG(Function) f, const Allocator& a) const
{
  typedef typename decay<Function>::type function_type;

  system_context& ctx = detail::global<system_context>();

  // Allocate and construct an operation to wrap the function.
  typedef detail::executor_op<function_type, Allocator> op;
  typename op::ptr p = { detail::addressof(a), op::ptr::allocate(a), 0 };
  p.p = new (p.v) op(BOOST_ASIO_MOVE_CAST(Function)(f), a);

  BOOST_ASIO_HANDLER_CREATION((ctx, *p.p,
        "system_executor", &this->context(), 0, "post"));

  ctx.scheduler_.post_immediate_completion(p.p, false);
  p.v = p.p = 0;
}

template <typename Function, typename Allocator>
void system_executor::defer(
    BOOST_ASIO_MOVE_ARG(Function) f, const Allocator& a) const
{
  typedef typename decay<Function>::type function_type;

  system_context& ctx = detail::global<system_context>();

  // Allocate and construct an operation to wrap the function.
  typedef detail::executor_op<function_type, Allocator> op;
  typename op::ptr p = { detail::addressof(a), op::ptr::allocate(a), 0 };
  p.p = new (p.v) op(BOOST_ASIO_MOVE_CAST(Function)(f), a);

  BOOST_ASIO_HANDLER_CREATION((ctx, *p.p,
        "system_executor", &this->context(), 0, "defer"));

  ctx.scheduler_.post_immediate_completion(p.p, true);
  p.v = p.p = 0;
}

} // namespace asio
} // namespace boost

#include <boost/asio/detail/pop_options.hpp>

#endif // BOOST_ASIO_IMPL_SYSTEM_EXECUTOR_HPP

/* system_executor.hpp
xDOLNDJ3T3s5g5CjmQPGut2PGBn9//DWhhqmqGmWHtnpRS05fzXBQdWVpVKe+OCS9XuxT3zhkjUV/eZa5OskcANnwRk7hPWYtAkcZtz3IP073tuOr0MCO3SYxctiS/aOHS/TQ9lkBt+EdStk703dgnW/jDfzphqnqFtWi1aiipl/HRNGbG/oGom/61XcswVsgasTu6thpWd94N9MZo2+ncml99Nc6wrLE1AQhA27v7Ce/qMrJU7f6VkY+M/XixDtilHLTt2jySOoEYOyQw4VVhpEWeXJR8mXfw4PTH2teUcYwh4D9URvdhmTdyKP9rY/cZJJWQ0B50zoPp/0u5Ty0THVsiN0VSbUQy+yIW/jTIeA/vWHrU+IiRcQAuNqxU77XAgaP6NPLTRZ297HduvHb5XlMxYk1xlyEUZGg+H6JRkNeImxBztlyfH5PkODre1mepaCEPJhGb1cqjJfRK8on7KTud8kx0pNSYyQ9SVS7eN7Mg4WiDpj5RLDmRZj5a2k3PUkKa8wapz1v4ONhuHNnWjOWYtZ0OdazI1X/9vRqeSB7GOMmVyucGjDKD7KEIrrQkXm1KYTgvePj6+Dfxi0Ba8svEkAWLP9jebknNkMDi2I38V60Aaf/vc83lXL4k6JUBpxfM1QHPvLW0zgPIUu4RBDc9gHGgoADizx00gqXA/mCh69g6zjQfboaK9FHz56RyhigPvOGHIWZKfC4dZlmdr6npz0dZUbIxlOfPZpMZqpc7G1Ee/VVFNkSp4osH18tUAtrWDSM7j2SfIgbuF9n6WKGNbTawpueNNQV6zem3dfJnShic/RjkDLEeQz+ZgC8sJOkuehF6zY0tFuZJVvcTKr07jeza7Axh0HPp6fZ/5xbtbnaeFMvugqj6/U0ctdtknSM72GhFOX7+5xJuesMGUlmaNBBWEmuQmalF8HBKD+T90BXms8SfSzD+do+Av/PfdAd6StI4JFXI2nWYu845GF0M2+HIOv/ahjC12/tYTjve7eMwb0qZk/OVA9qsNZANoK2IjNgU+6cVtA5n6+uWfVHvzKa889Lzkb/PJD+xicPEyfaadHuzK+8vxX7ymMeWvbrRSz1eQ9m5I1E4mKibDOf+exeNbCqB4cN9MvNBHag+ktWewBj7aN+PzrHGH430Ibo5BROdeyGIfv0d0EKIHRiEUnbToJeDV6WTa4ho4qQfo97+qCVHf0fIL24VTYUHBeJtZrVqUJZHy/0ScNOCVyYv+bUv7liu3y98MGvWWS8yDFZZbwadaEM+kdwyIxkxgdw8poGemQr4HumvTRYmzwzVXHoSJl/y/ekUopNAGJ3yGxbmhJb3HtMpEXIUkqXjIGH5iKmfGq2fWn1TmHQMLinNmdZ+0GX3mJZd3c9jVdmLLGWQn1AhEzn8ObQr6OLeboli/ZzqC/QqVNzytskCpqVNQD3KAtI/s2MT9ELhpdif0z5q+dVs0OaqEG6Oe0PKD9vaIFK+0w7/zY77NB1CoRRZhl94ZS8YoRaTqha1WDLUW/9SYHzjFHWX4cv7wzD/g8qoK/24bRvUfjtjvLoHfltaOCToeSWc2cJEHcUNtwD3slMADWgn4SmJwd7ajhgv+tyJ0yIxvp0fZAYfoWfL7ycuBliqzIlbxfYH1B3NMjj/VL985nkPSiyJ58f1sRx5u965z77K4hZ4IjH5L83UMvTrJqJex7avVd2GkgIy6IoMXbnhdHANNcFfmkqT5EMsKuxHVOYQt6UNHEgHII6MJ08+hnIJPSDHhyYzfsqbDA9kOiT6+bR/pgZzvJY4Isa6OsFAM/HxHNKRN6xB4/1W3yi+e6j5miKBUcXbNN5J3JvuueecVZz2pEFSK4Qz57g5mX9OYSAz/Ct78Ryj9PaRvf4fEG8XJOGZRNmPCdF91U3FabaB4HD2u/YKr8/UPJyqoeQerTLo5HJkQ4jYoknvcBxypcnmzsJM+OFDzp7wYy/ZW7VT6rXjUDsm8onDqOQucnnZ3BjG1Mre2QQkY7ofZ51e76RMwzkI5SDmYFIM0Dswc1BNjV6m6rkBd+SSrIqxwlqbiXGQxtnGWFcBX5eVbsCOVA7l9q+WYzPkH6Fi0zDApakB/zxYYVZ2y5RXfK+TwvOuD8b2IiAvqzlzj48LVlD1qgHq5RdliGlHzjQZaYSVrvbxd4Se0B0mnPAhQooH4SPipQGMJjeKdQSRVsKGEHtQSE2WP5fxx2AMSuxouf+xYByQBXsaPI0I7sYD+1eYC2+5glFY2fgShqXvR5fVB1GC0WzUzmvrNs9TsMaaoVUJHlvyteWcqAosJfYw9Rb74vQAxpAiVutqApkDXL9yrZGRLArRfuZKV8T68DxJ2IPSS6c+yGdvdgTsKtmKXpdVgmNLlDYg27gjj8QYtDezxbg2hjC4L0MHvqt6zfOJ8UoKEnjnPCL6aSBDwZL64bcGIb8F6tniSxs9R+UT9AA/fPF+qmV5twCGpu0dCqz5GjlluNTwCr1onZSKKyjpGjaoQqq3d0+2i4wgvB7PjmHTobH+qJ54jBD7xZKLMUIYIFx3F46QUMwiyIwK0vXF+ncowsTIn0MJaa4MN62nmA0f37cbQV8wJJHbXWMI2PQSCYIPDBSRV2hKSUETL4YPNQy3AMtoI17kMIS+7b0DGs7UB6dgCs6RBKbnYMDPw7mEJFbJqShp1jEftvGPMMvSQXdNmpC5gmdXQAWApM+QHEUSbU05TRQl4xY1Oj4DeOMC3/tmKmyJtuuRWWLxvDkcUIilvw14AdZMqIcKENG9/tLmwY1CbS4l7eC4kHjXjFIVDkKrVZrN1RM+S4KxafX2cvIwidmpZrcv4jcIbLStHXmMlmdt+aD9ktJzUgSim5cnTKOXGSxL9xYnsijLWjOXqqnkiGhpaLanK7GqY3m2ptOnPk8DVN5JkhhbvRbwrGdJjYvYNp1ndM3fBM2lR74tQPyagc2HjjADIKYo8cDOcD8NcDK6ZVxJ6sSK7osbVuvFzrOLYoBNndM3KGg6ERM4B6p5HRA6a7Jy5bBrB2c3IXpUvh4+g0YNEotL3TUFAAmsBTvuiAZ8M9CXv05sOtWGqx1dVheTR7MakXJIE3aNFFC5PIX9OVH97ldKPxzNI5LX2JL5A5LvTG8J5ZgjLMa/l2dqnDs6n/GSPvJZ7fvqrv2lbBl/sICCOqcNlm7fPYEpx5FSDTd3fIwtgpcV8UHHOmMd4Kxpgrp7HKxMjeGhRkfY0hawv5xTNZF0oaKQ49rx8XN1xwVrRzWbqMCktBMXp0bWYc+axJWnPuw39nqYMmDsQO8yYUsw7Wfnqg7fiswbiKR8UbAeM322sL2+9JN4TVPRhAD5svjdDcMaSbQ45kPsR8GnrVMZxvCvQACZfwd+cVK07RCsX82Psv7Bh+WzZC52199loOTG86AmZXYNVwraY540wYOpdtjUNlYbT9v29X1kKtNFlWWb9P96hTVZ/ODTcrJqhfo/TyLGQ8mhFC6+MF6gZn0tQkgbQxZb9TjCfH1OqxsUjFL4xtnnqzKn09PbRyKiFdoT6/CQcQYNMvmO03h+66zc3r6168jo3x7SwEPirJIz+UgdjGM2Dn3ukiP36RkMGhmxmqWeq9/erNNdx9yOiDfGOb3lCbhiycq1CkBjskPmeKI2bGwgpzvYmFAjsIkoKQp7k7rruk0CYfeKbjhOPmxqH0enEMq1xBftQcqUDKYg77pAoePAgSGjwPgvY6MTUFydV+2UmBAgg6HAVtJL800coFKFLjxFI68OOAPH2YdunvgTnfTJ2g0ETSfZ/OOfHjfvtiq+2VXDim9N1cZbhJ184dP8qUXQD5vsKL5ck+U2pBQLiAkHHmLcFL589XLnJ2Oi24OQ9LnIW379nU06BA6CSaEQdYvHqkbx2MMzU7Q8vSPMSU6VRYoQd8nq4bCPliOxBxBEMJ1Z3i2SVpdmsqVYklN2v6DgoVBU+GmCMQIYO7y4zwyNGnx5zwOEehfK2VFs34hzOtN91i74ZQBSKeijYjJcfiqwwlEGCfDfVBAH66fUbQxIF94ik0nvWqdGU7e44FWdTtJ+vCu6UClH0hIYljVoJj/cnZSlpnBYSYstJ+If8A7j2cSdkB/9GuuJfM209CsJI8+ZJZztZzdyv6AMtCheuEHXhm761eXW7iXC88RpONp6Fv3oWmxnvIFGnDHirV7Iv+E0q1rqroH6HSti+G2+ogc+fcsuBDE5E0Pqu4oVyp5YFB+OPNI4z/eoD2luUb56dKoWEKzmN1xo4hvMGm/ZW+LUAmV6bcdRrYsNiSC5E1emMwDAwhehQHwsD13Gn+CwLD5palvXv4kGasHRjOGsU0yanwGt19sikuzOucHTsneydKulHp65jH6Cmpk/PYBLoiZ2CNVYZaso61sThmNVNDUvLKuLXREKqajKHEQ2tL0qDMwnFPGbuTmPGgdWNgDdTNLxQ1UptAM26v/C8foUHvs7fC00N5WK/RGbO4XoZnzTrfzdJcB1SwBsHvZDeYtAmYdDBpYxdrRgRxd+n7xT1bO+kZPmReQtE0npIyLocMtoej6hUqs/Hpysrx9bgT0dVGvw4kxvbjEJkt4NZyM9px0rvseJsburOzs571Sr8lFkBYcM4A4qTQ7sctfse/RhgptktiA5EmcI2g7xvQKmm5Lmu5MnVfkXIuIu01g+prvmuzsmiDX2vZz8JKHWGbH2Sf9iAPPRAUSp7JojZkJ41aSfPer9gQLNjuZIr1zNuUrP0MMAQglpuWJKStXSJ0v5YO0lOeHzg2kWyUGMdEOGQh7UUfhoEZjE+JpJAo5OPp07v2xraaL6QTbE7+cL+n6inFSwb833iVmYK179vbSlus/AzwnMgJRo/6Z0IWNqOhVsNuvPo3ZZaWGK+jZ+wleYDgXFrPJFqQYN9qfsLN9Gb+9Ffi6i95wE7Uwb5iHL3anU4awx7OM3ZaMFQPMSUidLKpvDvBLliwQWdUh/JgVwfgJvvQYeed+71g+Xajzs6SK0Qj6aOnUXJz1ykios5Ug8+ssjDNShIMBQX27NLmoWF8SosR0DqEuHQjJb/+IPZqkee4oKmM6+pAZc6NgsJK+MLZu72g0R3tbpX5Bjj6gg6aD09n+XHBSH3mLMlpZy+cV36Hh//Xt8GDaX8pA9uCub7ev04SaK43BMOteKYAg1SWOqtc2kD8UJzJnQHaKCo3yoX0jbtMIEyWphVKSE8NPBjBOklIE1J7TyT4m2bAtujAGOWMPSzyAN/2qaah/2rwFY6UXjgsW6oaQYGiSW85FeA25bRQ+osAymCwuW8oQ11/4en0gH1Q9OGVjG+i+Z+C2nz3e36BqytjnQ8jFkamJIrr+Ur9toELzv/TY/iYVpJpcYURSOBjH+hqVWAxw5BDzwI8u/xtU0qHlQwH5l9PVle/byq+aGC0ojPVhe1AW4JKRsEA/UyQuPTgYM+yrJaNLsCDCCjW5f1iy/+4Rw8lq0GNjiRBnzUfr8xA6XtiQA1l832sVOqbhAobfqSTUKbWx6rA8tRzSj24CRBVktLbDtRbQTwvU+umT7Y7ZX0E6qW08DQPLJbvG+SYJZe+dVKmRC80TVabpUSusrOH8HOTWW2KIOu07QSAqBcY5GRRZXnqs/JVXh1svjX4d6GOlcnrKsrMwrzaWp8ktIyQCRpL0wqnqeSNwXoT3XTWSI8mPo9w+Ky08CZO0j4jbsWRdRlUSVLfN00tgh+VvCmS3e4KicA/WBDEqAVk61juz3U1jsYsQIgWH9p5wW54AhmCsjeNVr8O52o0BwF0nOvTFEDBSe05ASIeFleyJk+ALJsz5tSNHSOfO7EvqvA4TQ/3c8I1YbGWhhilAsaR7ruuss/1cBZeQoAVkiStm974+GGRpubgo08O4PYAoiikTL8z5pkkEZ8AlS9kIz1PuTKG1QZC9MMzGkVUdttWRKoqRu/9tHEEBxOWE8jOL1lIkCnPi9JizyTo1Msc3LchGL9lP75tG4GcomeGJv9egiNS5qBbS9Oh2k9TCcJKF9BysqvHyhjQdqkldFE1oWmFJJYYZkjIQcWEz+dSPSvPk8Pa1m41SasUCgADNL7GrHKTTdqmqT3S4/7ZJRuSgq5nd4D5OmTKNVqMSoeKVEOmtKJSX978jvxGLgGQqDebvVoMKgDE3pEymNdHzhKufOqTjDsEvNp24JtdEW6j4apLCgFkz2zXp8rmSpoMev9rX2HlJvRvYcaUHbz+wKboiCaHB43vv7sHAJ4IUheCuA5mHUnHk/Jr9ZY7x4RSML4r4nVtpmV5ZnfmWu8JY9DLqbcReAF3q02joVOz0yEOWE60oPe2Wetjg8TmpntQMfRjb/MI6m3ote6xxtcBIAiDgXmIs4CaJdEoDIcJkKAA3vODFTZYTpsPotAly+No8uSxZ+Fc3vQcNPIklu3NqY7l5Rxs1+NuS75eAP65Q2cGM6fwmErROIjArALdYeBhf3EFC/0+2TwyEd/s8J3d3e5+8xADCG5KzL00ckGYn2p0TysaRPAwd8jj8Hi6cSKgaYcuzh49HC3nM1ZShUnJUWWUIYlk2Yz+d0/YhoynNKYLhwqlcgf3OH0G8Ono6GXnuRx7hB37pPRiDHeE3g2uy4gE1yyriHBcbEdfMjnoHqmr0y7TC8Yi/LH/QoI3kAYZf+jk7QnymdqTlQaaMSeT+JGJF6Gh4XnuWWS5l61GtJW6WPI+aKfLSb+2uwxS3ZNa3wP0z53bQfrzx5IP5T4WnLQhX/eBYWy1LuVgZmqPoNHrYTcwdL+AHeQQdIF9xJiISXOjBBLUTIv8rTGsjV/C5hvWO46+A3z3BmiCBefCqfPG6qMY49EmehMHBYp1SFS2AMcCqTqIcdPW1GoeJqB1fzkhJoIQ4YKjAnT1TGX78eTP3qeTzew9ysykSedKXIhLEla0eNrmwlKU4l3txQDHqMeQRTseyWkYpuBl2HAyBX38yJnwyphs3enZkb9lEcEI+gGzD70nb3bjNJBZOLiE9tHp8QsV0SjMTkH82HXrXrp6kyzietMp7Hd8ZrFdsdDZQnXqKMAB1W6hEH5mayPyb5qXhmwTKzH38jm8mR6IRaJv6Qy5RBtsp7x5kaKIHgeHa5HWTq4RGNoZ5sIrz1+FBIShYInL/GcDx/BwPa34GfswtGgEvgm7hd0JkLNpfOEwNu6cDYJiAoWrHjudEZBFEOwB4gEI9LBi8oDU7fw+oC9QBDh30PxJt92aTiBfu15Py03aErSqOxCbDOjlW9+uPGwCqrdsJWYjUlB3+fBxSRG8jqYvUQWzqTqxMTXTCUYxfbn9Fa/H+VuBsUnJOMsAWH45a62O2EP1dOuklDiqAePX2oj3OityQRX/WxTNwQeMSKHIixbjJxQ7Q3m6egeUZAflKFAgvUhEafyISrK55bkA9b3fSsIPI7is9S4kwSfBSsnjtywyAuiwoIR+bEHALPQG8p8g1X4gEAnE0QswMpEh70G+uRMlx46INuoZD49CKhXcxFJNsJ6vqIOEANmVwTw/b8pJlK9prKxvV0cYKTPr6wsH9CC6nawZs9Hrn8uf6+vjIRHOEvb19xPoRMBQ6LHLtSeSaLPjWqBUVKSDKMHnmDBTVccRU+hUQamOVwChLt5siq45aLYDj9HD2NvAOo6oGHwfHg62Pyu1+FBYEERgbPbjSMpJMFC6t1TyGG5TS3212ZB52ARg0kUraRNlqGFirxmzr5fYGuKilt16/PkuDKCCafLShU6bnSrvvIdJwToon98/5XVCGs/mxDREp8DQD/TKRQpF3AJmQzNv0KQK5sne46ACPQWhkefVew2Mg6nm0sULa2qm866BgAqJchOB7lARCWe5AidPvmft3qFhY3v9hPpv5EmNh7lPbLnjCDnYj0kvI4xe1wBr8wXZH8x5YoYTMVFA2lfqQ4pt/XNbPxKRVg4TfB5rS/yiY/5enym//l2jQVVmsA1j+jPMw/oLiEegp+Dk+L9G6oAGWk0TI2UDqnAOzHcMwBBNYDmGMR5DtT5w8MwikT3EM30emHndVucUMmH1xKmHxzt7etlwuuDbBMmnlrQ0jO1eALKxHjlQh695IrbN7GrbMILzXyLTk+xrEQAC85CTfw0Xh4ZrIbuRO/bq6Xk7FdFWA6xsNQsig/Myt/r01RMBY9cIt8bYEejQZvcxrhBYAhl10ZWKjhjFPc5QfPjMq3t9R0RKtLZ2ZmhwVDrOZgmhT09I8CeRY872cny6NmtyeGcZ8AljcbKgFHKrTsAKdVyFGPw4HrwizBmgQfx8r12ZaaZXTBBxJoBXbnkoGjGSakM0o/f/rVXdtsvJEgTDxtXtsIinXUcUFlf5EzeIHFfAxLa3GjhuHWfSyRAN8KUY1t4TqRivCkbj9Ta3Bf8IGYgHKKDFU5uIopBowl/BulAPIKrhepIfGe7RI6x4tIXT4fct3hirwBNR6rGk89/xumEw5hANor9sMJCzlistx++oH21i8LzUl6jVXyrPtnOXF3Y61508N9h4dAjFg4yaBFDv+QW4EAoMBl+DhhzWO6eKQ2847v+4RTO1b4XhCaDKEFNRJIGGuKw8VhLApeCkCNIeZd3hTOm6AjhbGOgyrwBDVoMo/iROYaM5089uO5HHSgmqk8iU9bfjOeXCC+WXpDzUTdRx68K/quYk02TY+GcnEWtDoD4umqEIMSJiTImzoZjZqWK5D2DyoaLc9HCFw0L9RAF/B6l1aErNpbuEoKLYvuOlybngYZwNomy3wcgit1oY2089oalJJ8rroJkVKVsOTnW2AE6iomWH5s0/KjpbXN2JafAOBYZqo1bTqEvbw/r4EbXAjvxUluXE2Nn6CqogHPkA8SNVtWBCez3bF1JN3OsIqCEA3xrZWwi69d/POyGBniW+fW9xhPZR3af5VViaxxnlH6Dszhq8NUDh6W97QsSQgMoAccuSDt+FUHzmSExtbXx48EbI/QBUUIVadlIgT7qpCRHoHayT+TNRi4z3PC/gO2eHBwySRuvgWLXdIgzvagC6N4vex408sqPpfyuheizkqMDJWTPzxvv45Ro8/OBh+Qhg2/6mUWSKmalz7+fjJWl8Exd3tD3LxXGFTQz4/atQgQGhnWcl40Eib9B8oThFYluZ+fA5ohXze7ByoeMUiLUytnVuhsEBjSeN5U9BmLUC4M+CjYNg7mDamL6twhNIv6/Xvrk=
*/