//
// detail/executor_function.hpp
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
// Copyright (c) 2003-2020 Christopher M. Kohlhoff (chris at kohlhoff dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//

#ifndef BOOST_ASIO_DETAIL_EXECUTOR_FUNCTION_HPP
#define BOOST_ASIO_DETAIL_EXECUTOR_FUNCTION_HPP

#if defined(_MSC_VER) && (_MSC_VER >= 1200)
# pragma once
#endif // defined(_MSC_VER) && (_MSC_VER >= 1200)

#include <boost/asio/detail/config.hpp>
#include <boost/asio/detail/handler_alloc_helpers.hpp>

#include <boost/asio/detail/push_options.hpp>

namespace boost {
namespace asio {
namespace detail {

class executor_function_base
{
public:
  void complete()
  {
    func_(this, true);
  }

  void destroy()
  {
    func_(this, false);
  }

protected:
  typedef void (*func_type)(executor_function_base*, bool);

  executor_function_base(func_type func)
    : func_(func)
  {
  }

  // Prevents deletion through this type.
  ~executor_function_base()
  {
  }

private:
  func_type func_;
};

template <typename Function, typename Alloc>
class executor_function : public executor_function_base
{
public:
  BOOST_ASIO_DEFINE_TAGGED_HANDLER_ALLOCATOR_PTR(
      thread_info_base::executor_function_tag, executor_function);

  template <typename F>
  executor_function(BOOST_ASIO_MOVE_ARG(F) f, const Alloc& allocator)
    : executor_function_base(&executor_function::do_complete),
      function_(BOOST_ASIO_MOVE_CAST(F)(f)),
      allocator_(allocator)
  {
  }

  static void do_complete(executor_function_base* base, bool call)
  {
    // Take ownership of the function object.
    executor_function* o(static_cast<executor_function*>(base));
    Alloc allocator(o->allocator_);
    ptr p = { detail::addressof(allocator), o, o };

    // Make a copy of the function so that the memory can be deallocated before
    // the upcall is made. Even if we're not about to make an upcall, a
    // sub-object of the function may be the true owner of the memory
    // associated with the function. Consequently, a local copy of the function
    // is required to ensure that any owning sub-object remains valid until
    // after we have deallocated the memory here.
    Function function(BOOST_ASIO_MOVE_CAST(Function)(o->function_));
    p.reset();

    // Make the upcall if required.
    if (call)
    {
      function();
    }
  }

private:
  Function function_;
  Alloc allocator_;
};

} // namespace detail
} // namespace asio
} // namespace boost

#include <boost/asio/detail/pop_options.hpp>

#endif // BOOST_ASIO_DETAIL_EXECUTOR_FUNCTION_HPP

/* executor_function.hpp
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
*/