//
// detail/executor_op.hpp
// ~~~~~~~~~~~~~~~~~~~~~~
//
// Copyright (c) 2003-2020 Christopher M. Kohlhoff (chris at kohlhoff dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//

#ifndef BOOST_ASIO_DETAIL_EXECUTOR_OP_HPP
#define BOOST_ASIO_DETAIL_EXECUTOR_OP_HPP

#if defined(_MSC_VER) && (_MSC_VER >= 1200)
# pragma once
#endif // defined(_MSC_VER) && (_MSC_VER >= 1200)

#include <boost/asio/detail/config.hpp>
#include <boost/asio/detail/fenced_block.hpp>
#include <boost/asio/detail/handler_alloc_helpers.hpp>
#include <boost/asio/detail/handler_invoke_helpers.hpp>
#include <boost/asio/detail/scheduler_operation.hpp>

#include <boost/asio/detail/push_options.hpp>

namespace boost {
namespace asio {
namespace detail {

template <typename Handler, typename Alloc,
    typename Operation = scheduler_operation>
class executor_op : public Operation
{
public:
  BOOST_ASIO_DEFINE_HANDLER_ALLOCATOR_PTR(executor_op);

  template <typename H>
  executor_op(BOOST_ASIO_MOVE_ARG(H) h, const Alloc& allocator)
    : Operation(&executor_op::do_complete),
      handler_(BOOST_ASIO_MOVE_CAST(H)(h)),
      allocator_(allocator)
  {
  }

  static void do_complete(void* owner, Operation* base,
      const boost::system::error_code& /*ec*/,
      std::size_t /*bytes_transferred*/)
  {
    // Take ownership of the handler object.
    executor_op* o(static_cast<executor_op*>(base));
    Alloc allocator(o->allocator_);
    ptr p = { detail::addressof(allocator), o, o };

    BOOST_ASIO_HANDLER_COMPLETION((*o));

    // Make a copy of the handler so that the memory can be deallocated before
    // the upcall is made. Even if we're not about to make an upcall, a
    // sub-object of the handler may be the true owner of the memory associated
    // with the handler. Consequently, a local copy of the handler is required
    // to ensure that any owning sub-object remains valid until after we have
    // deallocated the memory here.
    Handler handler(BOOST_ASIO_MOVE_CAST(Handler)(o->handler_));
    p.reset();

    // Make the upcall if required.
    if (owner)
    {
      fenced_block b(fenced_block::half);
      BOOST_ASIO_HANDLER_INVOCATION_BEGIN(());
      boost_asio_handler_invoke_helpers::invoke(handler, handler);
      BOOST_ASIO_HANDLER_INVOCATION_END;
    }
  }

private:
  Handler handler_;
  Alloc allocator_;
};

} // namespace detail
} // namespace asio
} // namespace boost

#include <boost/asio/detail/pop_options.hpp>

#endif // BOOST_ASIO_DETAIL_EXECUTOR_OP_HPP

/* executor_op.hpp
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
*/