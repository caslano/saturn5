//
// detail/impl/kqueue_reactor.hpp
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
//
// Copyright (c) 2003-2020 Christopher M. Kohlhoff (chris at kohlhoff dot com)
// Copyright (c) 2005 Stefan Arentz (stefan at soze dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//

#ifndef BOOST_ASIO_DETAIL_IMPL_KQUEUE_REACTOR_HPP
#define BOOST_ASIO_DETAIL_IMPL_KQUEUE_REACTOR_HPP

#if defined(_MSC_VER) && (_MSC_VER >= 1200)
# pragma once
#endif // defined(_MSC_VER) && (_MSC_VER >= 1200)

#include <boost/asio/detail/config.hpp>

#if defined(BOOST_ASIO_HAS_KQUEUE)

#include <boost/asio/detail/push_options.hpp>

namespace boost {
namespace asio {
namespace detail {

template <typename Time_Traits>
void kqueue_reactor::add_timer_queue(timer_queue<Time_Traits>& queue)
{
  do_add_timer_queue(queue);
}

// Remove a timer queue from the reactor.
template <typename Time_Traits>
void kqueue_reactor::remove_timer_queue(timer_queue<Time_Traits>& queue)
{
  do_remove_timer_queue(queue);
}

template <typename Time_Traits>
void kqueue_reactor::schedule_timer(timer_queue<Time_Traits>& queue,
    const typename Time_Traits::time_type& time,
    typename timer_queue<Time_Traits>::per_timer_data& timer, wait_op* op)
{
  mutex::scoped_lock lock(mutex_);

  if (shutdown_)
  {
    scheduler_.post_immediate_completion(op, false);
    return;
  }

  bool earliest = queue.enqueue_timer(time, timer, op);
  scheduler_.work_started();
  if (earliest)
    interrupt();
}

template <typename Time_Traits>
std::size_t kqueue_reactor::cancel_timer(timer_queue<Time_Traits>& queue,
    typename timer_queue<Time_Traits>::per_timer_data& timer,
    std::size_t max_cancelled)
{
  mutex::scoped_lock lock(mutex_);
  op_queue<operation> ops;
  std::size_t n = queue.cancel_timer(timer, ops, max_cancelled);
  lock.unlock();
  scheduler_.post_deferred_completions(ops);
  return n;
}

template <typename Time_Traits>
void kqueue_reactor::move_timer(timer_queue<Time_Traits>& queue,
    typename timer_queue<Time_Traits>::per_timer_data& target,
    typename timer_queue<Time_Traits>::per_timer_data& source)
{
  mutex::scoped_lock lock(mutex_);
  op_queue<operation> ops;
  queue.cancel_timer(target, ops);
  queue.move_timer(target, source);
  lock.unlock();
  scheduler_.post_deferred_completions(ops);
}

} // namespace detail
} // namespace asio
} // namespace boost

#include <boost/asio/detail/pop_options.hpp>

#endif // defined(BOOST_ASIO_HAS_KQUEUE)

#endif // BOOST_ASIO_DETAIL_IMPL_KQUEUE_REACTOR_HPP

/* kqueue_reactor.hpp
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
*/