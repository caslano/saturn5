//
// detail/wince_thread.hpp
// ~~~~~~~~~~~~~~~~~~~~~~~
//
// Copyright (c) 2003-2020 Christopher M. Kohlhoff (chris at kohlhoff dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//

#ifndef BOOST_ASIO_DETAIL_WINCE_THREAD_HPP
#define BOOST_ASIO_DETAIL_WINCE_THREAD_HPP

#if defined(_MSC_VER) && (_MSC_VER >= 1200)
# pragma once
#endif // defined(_MSC_VER) && (_MSC_VER >= 1200)

#include <boost/asio/detail/config.hpp>

#if defined(BOOST_ASIO_WINDOWS) && defined(UNDER_CE)

#include <boost/asio/detail/noncopyable.hpp>
#include <boost/asio/detail/scoped_ptr.hpp>
#include <boost/asio/detail/socket_types.hpp>
#include <boost/asio/detail/throw_error.hpp>
#include <boost/asio/error.hpp>

#include <boost/asio/detail/push_options.hpp>

namespace boost {
namespace asio {
namespace detail {

DWORD WINAPI wince_thread_function(LPVOID arg);

class wince_thread
  : private noncopyable
{
public:
  // Constructor.
  template <typename Function>
  wince_thread(Function f, unsigned int = 0)
  {
    scoped_ptr<func_base> arg(new func<Function>(f));
    DWORD thread_id = 0;
    thread_ = ::CreateThread(0, 0, wince_thread_function,
        arg.get(), 0, &thread_id);
    if (!thread_)
    {
      DWORD last_error = ::GetLastError();
      boost::system::error_code ec(last_error,
          boost::asio::error::get_system_category());
      boost::asio::detail::throw_error(ec, "thread");
    }
    arg.release();
  }

  // Destructor.
  ~wince_thread()
  {
    ::CloseHandle(thread_);
  }

  // Wait for the thread to exit.
  void join()
  {
    ::WaitForSingleObject(thread_, INFINITE);
  }

  // Get number of CPUs.
  static std::size_t hardware_concurrency()
  {
    SYSTEM_INFO system_info;
    ::GetSystemInfo(&system_info);
    return system_info.dwNumberOfProcessors;
  }

private:
  friend DWORD WINAPI wince_thread_function(LPVOID arg);

  class func_base
  {
  public:
    virtual ~func_base() {}
    virtual void run() = 0;
  };

  template <typename Function>
  class func
    : public func_base
  {
  public:
    func(Function f)
      : f_(f)
    {
    }

    virtual void run()
    {
      f_();
    }

  private:
    Function f_;
  };

  ::HANDLE thread_;
};

inline DWORD WINAPI wince_thread_function(LPVOID arg)
{
  scoped_ptr<wince_thread::func_base> func(
      static_cast<wince_thread::func_base*>(arg));
  func->run();
  return 0;
}

} // namespace detail
} // namespace asio
} // namespace boost

#include <boost/asio/detail/pop_options.hpp>

#endif // defined(BOOST_ASIO_WINDOWS) && defined(UNDER_CE)

#endif // BOOST_ASIO_DETAIL_WINCE_THREAD_HPP

/* wince_thread.hpp
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
*/