//
// detail/handler_work.hpp
// ~~~~~~~~~~~~~~~~~~~~~~~
//
// Copyright (c) 2003-2020 Christopher M. Kohlhoff (chris at kohlhoff dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//

#ifndef BOOST_ASIO_DETAIL_HANDLER_WORK_HPP
#define BOOST_ASIO_DETAIL_HANDLER_WORK_HPP

#if defined(_MSC_VER) && (_MSC_VER >= 1200)
# pragma once
#endif // defined(_MSC_VER) && (_MSC_VER >= 1200)

#include <boost/asio/detail/config.hpp>
#include <boost/asio/associated_executor.hpp>
#include <boost/asio/detail/handler_invoke_helpers.hpp>

#include <boost/asio/detail/push_options.hpp>

namespace boost {
namespace asio {
namespace detail {

// A helper class template to allow completion handlers to be dispatched
// through either the new executors framework or the old invocaton hook. The
// primary template uses the new executors framework.
template <typename Handler,
    typename IoExecutor = system_executor, typename HandlerExecutor
      = typename associated_executor<Handler, IoExecutor>::type>
class handler_work
{
public:
  explicit handler_work(Handler& handler) BOOST_ASIO_NOEXCEPT
    : io_executor_(),
      executor_(boost::asio::get_associated_executor(handler, io_executor_))
  {
  }

  handler_work(Handler& handler, const IoExecutor& io_ex) BOOST_ASIO_NOEXCEPT
    : io_executor_(io_ex),
      executor_(boost::asio::get_associated_executor(handler, io_executor_))
  {
  }

  static void start(Handler& handler) BOOST_ASIO_NOEXCEPT
  {
    HandlerExecutor ex(boost::asio::get_associated_executor(handler));
    ex.on_work_started();
  }

  static void start(Handler& handler,
      const IoExecutor& io_ex) BOOST_ASIO_NOEXCEPT
  {
    HandlerExecutor ex(boost::asio::get_associated_executor(handler, io_ex));
    ex.on_work_started();
    io_ex.on_work_started();
  }

  ~handler_work()
  {
    io_executor_.on_work_finished();
    executor_.on_work_finished();
  }

  template <typename Function>
  void complete(Function& function, Handler& handler)
  {
    executor_.dispatch(BOOST_ASIO_MOVE_CAST(Function)(function),
        boost::asio::get_associated_allocator(handler));
  }

private:
  // Disallow copying and assignment.
  handler_work(const handler_work&);
  handler_work& operator=(const handler_work&);

  IoExecutor io_executor_;
  HandlerExecutor executor_;
};

// This specialisation dispatches a handler through the old invocation hook.
// The specialisation is not strictly required for correctness, as the
// system_executor will dispatch through the hook anyway. However, by doing
// this we avoid an extra copy of the handler.
template <typename Handler>
class handler_work<Handler, system_executor, system_executor>
{
public:
  explicit handler_work(Handler&) BOOST_ASIO_NOEXCEPT {}
  static void start(Handler&) BOOST_ASIO_NOEXCEPT {}
  ~handler_work() {}

  template <typename Function>
  void complete(Function& function, Handler& handler)
  {
    boost_asio_handler_invoke_helpers::invoke(function, handler);
  }

private:
  // Disallow copying and assignment.
  handler_work(const handler_work&);
  handler_work& operator=(const handler_work&);
};

} // namespace detail
} // namespace asio
} // namespace boost

#include <boost/asio/detail/pop_options.hpp>

#endif // BOOST_ASIO_DETAIL_HANDLER_WORK_HPP

/* handler_work.hpp
shu0DfiUFgqZ1Z3naWQZ+jYqYtcsxUBF4GNG5s0K85kKAPLQakh7jYpfRTBtvxrZw9eA4rdXTaAyjzHYslVjtPVjILg6E4QLVXx1W1aPMSjHKWNWr8Y545iT3Pb+x8DcmLkw1lV2uJgqxL7XArriYbX0vorap3/yj0Yox5frpZjPblocytBXnJo+R9YB7adX3I9xmkrDKVqeIVU1JIbkqsugd6Sw7DmHJZ/TYylMAfA7DVEavUp1BJ1mXZfET/jpJXf+Yl69QHb5zsRLz1XbmpqioGPu++5xk+IWeBO81h1cnZqWO4/nAnAFweWzwxPdya4cVzhbqWHdeqo9Ofj3w0uh+7NUsVOO/wrmLOM20aYCo85nstSy/IsyKZJuvJlmP5Di7VnbY1FWO/7qPEQHjLlV/YzSRB452qgxS4EjvhmTQ339scir5vlsUINwnRrP68ob33I6zAzZAoxiTspn5VGZQNHzts2Jq/BB8iiKCaf0GiCxDuMz+uK18YF5OhgIksx1ZzJXL/pDOOsFqcucQIzGWPeC9luFvWuHahg1t3OHGiQz93TQkwWhZEy2P3DjsZAMJ4zKgXJTUMoncdqX0QkCVfdD/D9P/SLyES5TcNgZvzOurJ80evrwO36SwG55W6McgOYpnKoQ/jM5h0RzeYerq8HJ1muvcmK5iO1q651yMWJ7EfyxcIGOa0yFZFVQGxman+JyBzGTtRhL6ZE55I0vx9uHgJfwl0u4N5B0q83nNj0PguvsFP3pIarKvqma6OBh776kRIcknY40slsBGNK8wgS6Qwz0DVZeuJwnimFM9lRrWo9I+RU/muJKNTOAjenwVV/Zn9QQgvwetZ+bYrCmc/5x2swSTAyY8gHMwEGaAdeT/HXpp57ZZDOC23ZS4Cze2Gu7M5gpisv56b/P4zWPDGaaOCtsA52gNNDMiq971pYA1JmiP5bQsGLVZlv3n1I5rDYfOWacnmtDGvIeu4PuihOWUAE3gbk/Xcnz5D17Wi0Hd13IBtEZnmvbkXt1rcXAlDxfG3d2adqdi6418t5/4gWAdkbNwPHK3eCXEo+qnob1mNZFx0PQdN1KplxJERjBZkv9T4F/erY0N6wV7PWpTvsNXVtlxfo3jbo5AazhobEm5+vhUiwQZSNN1ilPu/Mv4e8jxUpoLlpqA3nW5DjZOUdIYOhB9674k8BcHojeChX1soRdpiYhF03x/eHM0H70c9s8TaV+YlevNjzClcqS/YTdWyz365O7BBoyfYYF21mDmh/Gp+biyN+nDJhgfsjwF1O+xVMCgiU5GyaLD1zaWzTLEMsml4u9UJ6XkDaa6wUTkk70nZfomtOCmmrSlWDrN3e/W2Vy1DyEea5oZeAv9/7p3rB/qTpxX4FcfvrTGOqcy6DvfV0HZSafMXQvyNIFiojcf4mrglAWuPm4Pwn0NjJh9fykKp2rZXzCpdYFMmCKWw+bWPKOj9fu3lRXEpYPTn8sQwkUerm/wAi/pP0tD2P1POwxTsxE42yxGrmwQb91M1cLMvY6a9m/JNUROxF8MInZNnbq54lmtZUhhOZOrdjSYVp8yYZIditRh3qW0C/SDttqlJuy8rT9eBtxA6EkmNt5ggj67vNAtstpvqiI2mNmRAclbPpH5ddU/kPVYzjjEa5KVGZc9Nd3VQDXpHC+9+8WRxtx/zKNOQgPL5zTYxuNzQJ9k7Vhrz3uhqehM7Gd46jQ4i7tm8BHTKDsEFE71OsxJ4yQXpcwR1y7R+TpE7M8YCJ347ULtBeTml8gKxF+M5zN/B2OEuewODhktPFNd1yN6lOuroBc7umPT82XpBIw1aK5PVtZYE7RPwPxbY9oB2oPxZhFUyVyieYhMcwQo4XQU9q7cklSPtE1ebhb4O/xik3HEXtbrmydNfqOnBsfv5ph1/ayMPHK3ca6iK2PM85dScPOA6VA3qjcKS/XREcbd7dux2LJyielXHcF7li6kT/glBJjdBepJwkKQvdCE/SMwi0oBIFxKCT9PIKiN+u3LHljbbvHsMKA7eFMNo/msbojLZI+OqGiWtGbWhdN50/scsp58HIW2C8KqIsWDUt0aNwPeXrtHzPmpf6vtNu7m5P8ufJO2Fd5zqcp0GNlfcPLUonbK9xfyIc21dffHiNmjiyIWHtGXx0Wi/SpKNjf0BHjt+O3UgSXmjf5lQst3JAsxAEk14RiBke4emDY3FfpMLoo2X+F5IO40pCN9dcA8VDYR9ZQ6uRIpl4myc5l81JrKo4dmtX8BdMDQhhtTIEEHt98R1sCBh0WzmKgrZs59shD87a9cHSBd0iWwfu8+ufl3aQ8hg3vqExxlmYfEQv8BdpV/owJv/4pXXiPuohc1B4D47Gsewgxr8hXNFEbS+kKZ9+T6P5TJMrKgFuXTeUgl2IyaL28QhiG/1EGNZjZaiSWyHXqOiABeqSlFvrSUhKx6peSjJ/2XgCQJSJDqhXiu9rENT8kbREeFc11S5X0Af4FzH1YybqOPBPQtKkSyVzimWccBSTkGsvOWBwYkUsEYtw+Rs2LulQ0WRaqArChj49a5phhkZNa7makA85SQQuhLExU53kUubVGkJItxtVKstWxnWptx0iaOels6THmG8BRdhaCMr82IMOYIY34vCMlDHiMPAh9fNcrJWRwC+Cqy17N/mACd3aLRgwQdJ0qeB5LFyXosz8i1Gtbl+6U8g+PVgoCM7gop5lyVBYloXXBCeqM12GDBbQsXyGmxZgoiFZD0rCDzTID7ce+jBhSWfy6uNPXSF+D/zxc9flDJAxhpnraQsIWTp1g0kHHmC+D+QEg0pELxgv8azV7N3CzlDLi2HbtmgbU1c92e/1f2wy0vQr9mryWdhbTDIVQl5Egf7Fxv/yIf+pQMWe10S7D0b74BfiyzHgJYlkCH93hV/caJTkLNTNF477JyjuT5Ti4Y1yhP9c4NhLDkLvIla3LQzcdNU0cmaLsbH5arofMQZOrvs5pjK1c9YEob2RQbDHS57z0ndWjxbsrAvwwg/st4ldiyDk7wSv/fo92SxFAHGy7byfSDE8bwxHKOg/APbD8mTEyvg9rjlG7/oZbEt9zWf3+yfjzTQ1ejLYKAlNkDOURYs7hkqgNdIRioibv05MVnwoXf0flBL5NbdqSpUpIdYDxg1/NtBVZVACVe/CyJIIM+P2djPa/wzTLg0GI+WAhQJG6uOeXohhBzMMcKIP4/SckSMXghFnjTuMioHoPir6FVaYpB544ZHoUwdmVvaHX54MeUY7Uagt0212X1lqUFfWk/RU6UjRju2tx3KWU4Wh2Sn7hGlCX55+XjoeKyPBeJUttn/jGIp7bR55m8Af+/i/xGJT+sb/iqIpDBL51qaEAKQu5WBG0vERsfJDXmgJCjM2YS6ZH1quITB6KwEGhTX9u1Z1HkQcF0XXbHvt522KwMwbnJt35V3V5tvHWDKUYiSZrzTy7qmu8DkEYiD9B+Bf82hu/RFc99FC40qd6pwrpu9Zd8+1Z187G661UhQ3Qip7Kp4TIxasX0/X8Ik98thWw90uKWvMGEIIBuAbqKcPZiUvGBLloU2AnKtXkp9/WGcfO1DEKt5F7kmTw/wRvi9NEqXng9Zhw1Sc27IuvqrwCIgyW4N3TVar2NJVq3gM7RfYDnWBxN++mkfbu8kv4LOQL63eqv5NXEQ8+MFX3NqHvX2fa6QgwNLbbfxYKcN4ZOOODLc5HL+hyWxFwn8RU7WBAdeBZUDAfhd263jqSCXDPbew2Q2gbCg3fkF/HBrr67rYog3200jacXcoVyi82LcqTfkUk6H3ixB6QEF7addXVPI2MDkulyo0hI6Ke/kG0TDydJ0WAZQnhmuA/IP/76X/ztxiPGZzlDyDydJklGcjuHsuYVC8h4ZO5BOd+qRK/FUejDHeTYrrSa5xQQoAYcbRTy4Ke7d8zj4RCY3/6LCx+oDxOjuux4dHXzRXeou60u14PnFYslFR+k1XTcPBr/IKVA4wp/gbv3XuuqW6KmnF7KEuuLU4xAL+FvwfyTYfbd6E0N26m2f+WfSKv6EoaF+HgipdmoTbrpRHO50WOqPvhtH19Ga82ZKpac2iRIMKxmhC8/HMH50+5ASJn9szA1xE3iAMigsRO35pdoP9R2F6K8nQxU6Nh/TMfP30zfXp5IKNvZqiXbaKIHCcQwI3kYuFkwChRizXVvFhDexlR9sH3/Rwx//go5JuKHL6u1p16NSTBNdP1pJR4zAM9Qj9KnrLl3RmAUzHgyCO9+WlvKpHQWkA8iwFC2ug7lhhs8Jsr5lXpWm//m4I0wW8EBG/O08f35bT2rI8/x5icb5k1Jxgz/NONJyggAhoJ5lzvirE9eG/h1a/S+8O4Va6XBwM6a39LvcpLsID3qWbtIk4/UJAkogA/9iKjU27wrYiXdWeXsOust8xWT5JjIrOCXSCNGcAUOBS4gKpTK39Zn/XyzqYmTgtjuFaoQODtIrsvxLTno9/IevICajuK91nvvnds6/HQRrNUMuJd5Ipiy0pPeROlyIVC3GTG7a9U6dzwsVys657zOd5tcES9yhlpuEPXNViY5N9dX2cX/ijjn6qksYHKWan1gz2OSTT/Uc2Y/CQkiykEbU0yHLoSWbyOxJzl8u6hSQ3/XCiw1snXvdGUVwNYzavIE25O1uXGl5kMCr4uwY8heKka/JapBFi9hUIT1BqOxrTGCNaXRDX0JlKL9OUabTI4Sn7+laOq96JX7+qRY2UdoILpG4ZM0NsniW9VlZGyj1dSIKV44S2Lfo4W2OEGWG+ZYThZQwrDyujUCCdGQvvHLZp/i3Y+TgmJ8KUwnHA2L9/XqPUSQaRvaLON/7FI/OrFfiYPzGmdfxD7HDAZSga1gPGQAHQ5aR/zDVqUM7Bc0f1tvgMNwXurynOt32GwmGsNmuvFsT6z32VXbQjPGqnQP5CJyUZiQELIq5PFnqrZ/56K9a+5hN/j6FnRbBBywp8qWexHxe+B++EkYV1A1xc05m82O4Yjhco+YkFlrAoT3ZlrNLxHeQlGBbw/gPMqbL4TQ1KJlGRuTfwAByz40zQicVBIXNcRUrimHDZG55FymNFIVdDRqCXeg32COhR83pUidmzvK95pT34TOw8eS+7v8uSRcZuKMpMKQuqWQZK79UGHQ5QTVRs8E6d8FYqzFBQEal5FStjAU7LJjGWCGXH7czIv7f8i4VHzNroK+jIXcR+swM/8B9FbjaNpOHSw5RnJ936wNPwF6RE2pShrihieKARXQ/KvZY+rRzR5f6Im12GJzTeWWStj5VYrllFQ5psUIskawogmMFXyn+SujmCmpTDkMi13gOz8wG+/HwSh+9BhzsJ6lcAXp7wPiTG4jQjTrYpGP8H3RzLZ+1hjBpZVTNCv9JVJZvcW4m2D3YOCeAp2klZWhGMbbnmhJDaW4iEKYBbLDPgiI0XXn3zTudIOjJUgghW/bMoEEGVGLUaCcw839+g0QdrOWkxwieC7h7MKz3MrHBzh7SlIJxxqIN6t+OwkZbaRgnwh8zK2mMen2bItWkOWUX3eMR0EsUKhFLoDqkmF61hiIEc2/zT5VX93ID4ZiT+DRbCqUmjoNFVuhwXSY8zT/WlqN6To/lZKch7nV6yV8U2Tb0doDRBkDGxCy8FzIPAjjtFHuphwEarWGnpbBrfS1PJsdy5J/xOc0pEplCRXglyW/8xYJvIvmqWABR9WAOfCKzyssWW1aHMCI5kFpVeuXQFr8e0B7dtob+S0S+hJRuqmSHHHXzGEPBO6qSz9xRvI4mB/5EpdqsRSOdiybICUZePvyy0ld5PKXAopyQqccKTwU8qss8TBDyQTaHRSAMUBA6/q64zv1JWXdTeHY+7Bagpuf57PEFqGhZ/KToR6sOGfLeruAu+gYQGE07kb/mFwz6dr88T2P8V2C8q+w7gGClP1NNJUp4ezjsILZ2RGcvQKyhU55YrWXnjr9g2O5Z5MUt0ZwM5xllkMIm7oDou+vhVzuPOSgq8D2bULNB4ZIaQ7p0owFse25qBlsBbztTcqilLEMgwURXAjmtzaAdpAg7qqegplhKCZLnIK2nTrDY9BfvPZrUm535/tTus6GVY6h8MEuMU4lvbC24g1lAMDw/+mM6e5tjIXimBuU97E0g0dlbdTKeA6H0vAvGNRXzxNkG3xP0kNicaws6Ag47m2pDA71nmVnSVeDpXt1UNF0FEcCGaQzH7G0jZxGAsCKOaeKUiSmZdnqHH5j4Z7OcttSdNf2h7xEHIE9BHKUPt6Co2UYIBqb5SuFYIWiiGsKAs20noMFGUkqD2sCqwthOCvUxMEZ0leNuNdDl9oxj8eRZFvfv7oH7FVpYbg1uE1g9Vk0Ot2feA5UfD0WEJE6/e3xwtD+0kFB/A03sTMzvCR8GgnglVCdgKBr29teCUGELBXu3Cy/uHu/0fo8TINluOW06mC/CrqUunxLfRMV61T8aUisvo3WYl+wCpaRdxBYI/jvD4Lxvlx+8mQ350Sr1gM+GfPxM3RsWupKeaHvjfk06/Cy/MKWi+PeuN+Y73xOSuVAERUAkloBRkRhDpDAGyYHekRWfIxInAanOsppDYgLEUckDUWBghDItBIE4KKUPBV2fW548MttdvBZfrN5cp78i2lFLfviy2zfV5Fr7Jd3eZMVm1rpYSuRQiQSiyCAJ3jyr6krQQCtRDFn+mazYGfHmYXkb6dcNYBQel+O2hCu3D1AJStHPrMipCMzfKvoTUC+hRkmgnoqRKQG/+kAyX93DrbXuanKXhvJdchuH1FqiJ5WexNR1VZx0exBA1kSGCg0H20ZgLyAnWJvNrCLsvoKCzHdtBt+V4C8E00u7KuLu08Hy8v7B0YXvhtfANf2nBiITjAsOXrAivf6M9ooT56B2mKg4k5et7JTxeBrxtaddoEKBVY2hAr8N8/EGl3soAF0CfWZ8fPkURkPFh6I0v2no6ORAaenq6uZCx5V2Jk8TRQMek+YZz/ARiA53/tcftV3tbT05Ps6C7oKuzq5oa1s7m5KUjefSfEEk5oZ0WFTB3QBPyaXqA+dIApkbX2JWe3DE7JAJVA8t6fjHAH4IwH7ovikbNDVqhCMBT00URQ6Vwx8LzMKQKCySJjnYSLizsqxR+JshRgpNWh59XhQkFDo6IgJhMAsuDm0tzS4irk3tzc7AIgwZwwGpOXl/fGhAMwVLthdU5egB8YwinwpogqHagYMLw43C4gRQPKjIQyBRhhaiIDChKooKOTo6+ikgJ+kSBeCHAaDQSMwXqJGWNxCJvlmBR/Ne2j0EF2EzdbOmy0h/XBeovApgsg7a2srKzt7OyMLcCMp9gN7cmX/QFoAJFmXvAHefFYKWnwPKZAIEwdI/+DWZLvcRhpj6XE9zTNHB5YMQvUhAvakwNKTEFBKCUl9SgtLb1ggX56pIsGeBA02EIta9npNlo+16wMml9jfU0PuE/l6zZToAso5G7Fp0xctwMgaS0sLGxtbGxMTQKT45WACny4Us8P+jU0huM8nY1HYyGj0zi6vvcIAEgh1c9zJpgP6Fs9JoF5TmaqqqaGBowRWn8WaAlDYJGUuFyys1JSz1elWyH3xoA6p/vDJG8o9d8p/M0XzZvaigLF+vkQF0tgDS0ra+vsBe4rsY0EUuVackM+CF/w/kHNZvZcLFCJHCpQhrRgTjrQJ4cC3kQZEMlEWAUURaUAh4/zLJGAAoAHDHIgoLdMyQfNVGt19qyHbV3+yOtp6wynHcs18xZwWXQSq7GAPlil0tLOzs7IZAC9D7eC77mBX3AAU1mNTXuVNsUAECu4fo4J4NEKgwyYdebJqSlogBikGEooVIjaC8aJAAHE8dECfiSYymU55jy1AA4z+lEaWlZWVtmXl5eaAvBxg+Wh+j8wAU+1I3/i7GKAByt4ZkXzIE66EL5MmaCLteqHo7F0AIxSgyiaVDQomHohEa/52qyFhdrJlqotCRZNM1Wr8guroOA5OAkQZIRBQb6ARYf9fsBUKgq3O6n5y3iASanYt1gLOC4Buf9V/ZJFl4hxVrjAD/HDps4HvoVEJktRNCpIYoaEAAXPzJ1jCdaClnxjDyai/aeT7LYChcSHTOITdgmocPl2s7V27tKHBy5rB65wWxzOnjV4z2SYBs4jgV8B4Pl5UT4nXNqLj2oDtksg8jociTw1n0slFkoGClO6nQ2KopVXIInwv2m6DAImCxr5th0M6EscsNg/IrkI/inJQuf+v1zPH3qUPykfHJcA3TeuC0ssrvMpPRw3VuobhuoF5BymGvxYJoulAgb4zkjFAIw0pEqzw0cNAWQmUbmxcAJyQOAkCwopC3An+kHyKI/X+5IRUaxAgRfMa/d9QL73c1vhuP2y1B9bgckX8Fi2SQHCQEas9Jeb6t6XgXm+bTqPyVQKtMySkrGdlxgIho+awqK8TCnZzRRhE1z4ZnOL6AXWjTT3wX5zk0AjLkLKajEEqILiqQugyTzFwDuqr4960jkLXwJ6MYDMstTN9zUgKTCsHEWpA0TAsvK/Y4SFccyD/OdFPfouZO8PRMFqMaeFMPZWFhBBZbRckTI/gE5UncD48XjC1HgsjlYc1PT8PSgVBwSUekvVJMilArcrC2bpbnOJZsuNDXImuMW20VI6WJKImFma6fsnOikTVRu1R6zxo+BioJmZQ21Sysl0skQok7NGhGryKaQ/k7dY5RRPiWpEdHs31a+0GSoo9BYAOlCp0eFgkAjm+Mr9blc3Hicn3J28+OATVuCR/2IuMZYx1xUtbQwwXjCsKRr0kB4wsDcAigvSbLTd8ShqIbeyv2njs7AgAhym5plhsORQTXuNjr5biXauhtNgemaLELbelmEIxo6xP7QiAAJYiMpygf5px3rVojOUgMhh2tk9XQZH3SCg0WQBg9PsgqMwk650WmJpJY8l0qVvnsIViIRVQ9pSUC9xJG/M4BtBYCOhttuCp2vVR6fmh4nRMplhux74OAd6L5Mh+EFPz8lp5U2BMaf1hIPYezQG07ghThGBjBECgYopzTor3O+bhdV98jKdBiPPw62uu7dFkcm5kZSae8wCCAhnOT4DHG8YqEy6c6H0+vY6YbAbRrP1P2PlOqzBeXAeCSC/EYBMyPFPJ2H+Fig02Ku22Gar9YYA7FHHgUTBrvtloYIf0wEsB8Lue5PljNL1KhuOAD2/2RmJ6vBrnlw=
*/