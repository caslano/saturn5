/*
 *  (C) Copyright Nick Thompson 2018.
 *  Use, modification and distribution are subject to the
 *  Boost Software License, Version 1.0. (See accompanying file
 *  LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
 */
#ifndef BOOST_INTEGER_MOD_INVERSE_HPP
#define BOOST_INTEGER_MOD_INVERSE_HPP
#include <stdexcept>
#include <boost/throw_exception.hpp>
#include <boost/integer/extended_euclidean.hpp>

namespace boost { namespace integer {

// From "The Joy of Factoring", Algorithm 2.7.
// Here's some others names I've found for this function:
// PowerMod[a, -1, m] (Mathematica)
// mpz_invert (gmplib)
// modinv (some dude on stackoverflow)
// Would mod_inverse be sometimes mistaken as the modular *additive* inverse?
// In any case, I think this is the best name we can get for this function without agonizing.
template<class Z>
Z mod_inverse(Z a, Z modulus)
{
    if (modulus < Z(2))
    {
        BOOST_THROW_EXCEPTION(std::domain_error("mod_inverse: modulus must be > 1"));
    }
    // make sure a < modulus:
    a = a % modulus;
    if (a == Z(0))
    {
        // a doesn't have a modular multiplicative inverse:
        return Z(0);
    }
    boost::integer::euclidean_result_t<Z> u = boost::integer::extended_euclidean(a, modulus);
    if (u.gcd > Z(1))
    {
        return Z(0);
    }
    // x might not be in the range 0 < x < m, let's fix that:
    while (u.x <= Z(0))
    {
        u.x += modulus;
    }
    // While indeed this is an inexpensive and comforting check,
    // the multiplication overflows and hence makes the check itself buggy.
    //BOOST_ASSERT(u.x*a % modulus == 1);
    return u.x;
}

}}
#endif

/* mod_inverse.hpp
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
*/