/*
 *          Copyright Andrey Semashev 2007 - 2015.
 * Distributed under the Boost Software License, Version 1.0.
 *    (See accompanying file LICENSE_1_0.txt or copy at
 *          http://www.boost.org/LICENSE_1_0.txt)
 */
/*!
 * \file   support/spirit_qi.hpp
 * \author Andrey Semashev
 * \date   19.07.2009
 *
 * This header enables Boost.Spirit.Qi support for Boost.Log.
 */

#ifndef BOOST_LOG_SUPPORT_SPIRIT_QI_HPP_INCLUDED_
#define BOOST_LOG_SUPPORT_SPIRIT_QI_HPP_INCLUDED_

#include <boost/core/enable_if.hpp>
#include <boost/spirit/include/qi_parse.hpp>
#include <boost/spirit/include/qi_domain.hpp>
#include <boost/spirit/include/support_unused.hpp>
#include <boost/spirit/home/support/meta_compiler.hpp> // spirit::compile()
#include <boost/spirit/home/qi/nonterminal/nonterminal_fwd.hpp> // rule forward declaration
#include <boost/log/detail/config.hpp>
#include <boost/log/utility/functional/matches.hpp>
#include <boost/log/detail/header.hpp>

#ifdef BOOST_HAS_PRAGMA_ONCE
#pragma once
#endif

namespace boost {

BOOST_LOG_OPEN_NAMESPACE

namespace aux {

//! This tag type is used if an expression is recognized as a Boost.Spirit.Qi expression
struct boost_spirit_qi_expression_tag;

//! The metafunction detects the matching expression kind and returns a tag that is used to specialize \c match_traits
template< typename ExpressionT >
struct matching_expression_kind< ExpressionT, typename boost::enable_if_c< spirit::traits::matches< spirit::qi::domain, ExpressionT >::value >::type >
{
    typedef boost_spirit_qi_expression_tag type;
};

//! The matching function implementation
template< typename ExpressionT >
struct match_traits< ExpressionT, boost_spirit_qi_expression_tag >
{
    typedef typename spirit::result_of::compile< spirit::qi::domain, ExpressionT, spirit::unused_type >::type compiled_type;

    static compiled_type compile(ExpressionT const& expr)
    {
        return spirit::compile< spirit::qi::domain >(expr);
    }

    template< typename StringT >
    static bool matches(StringT const& str, ExpressionT const& expr)
    {
        typedef typename StringT::const_iterator const_iterator;
        const_iterator it = str.begin(), end = str.end();
        return (spirit::qi::parse(it, end, expr) && it == end);
    }
};

//! The matching function implementation
template< typename IteratorT, typename T1, typename T2, typename T3, typename T4 >
struct match_traits< spirit::qi::rule< IteratorT, T1, T2, T3, T4 >, boost_spirit_qi_expression_tag >
{
    typedef spirit::qi::rule< IteratorT, T1, T2, T3, T4 > compiled_type;
    static compiled_type compile(compiled_type const& expr) { return expr; }

    template< typename StringT >
    static bool matches(StringT const& str, compiled_type const& expr)
    {
        typedef typename StringT::const_iterator const_iterator;
        const_iterator it = str.begin(), end = str.end();
        return (spirit::qi::parse(it, end, expr) && it == end);
    }
};

} // namespace aux

BOOST_LOG_CLOSE_NAMESPACE // namespace log

} // namespace boost

#include <boost/log/detail/footer.hpp>

#endif // BOOST_LOG_SUPPORT_SPIRIT_QI_HPP_INCLUDED_

/* spirit_qi.hpp
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
*/