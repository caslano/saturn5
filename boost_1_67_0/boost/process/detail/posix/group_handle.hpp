// Copyright (c) 2016 Klemens D. Morgenstern
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_POSIX_GROUP_HPP_
#define BOOST_PROCESS_DETAIL_POSIX_GROUP_HPP_

#include <boost/process/detail/config.hpp>
#include <boost/process/detail/posix/child_handle.hpp>
#include <system_error>
#include <unistd.h>

namespace boost { namespace process { namespace detail { namespace posix {

struct group_handle
{
    pid_t grp = -1;

    typedef pid_t handle_t;
    handle_t handle() const { return grp; }

    explicit group_handle(handle_t h) :
        grp(h)
    {
    }

     group_handle() = default;

    ~group_handle() = default;
    group_handle(const group_handle & c) = delete;
    group_handle(group_handle && c) : grp(c.grp)
    {
        c.grp = -1;
    }
    group_handle &operator=(const group_handle & c) = delete;
    group_handle &operator=(group_handle && c)
    {
        grp = c.grp;
        c.grp = -1;
        return *this;
    }

    void add(handle_t proc)
    {   
        if (::setpgid(proc, grp))
            throw_last_error();
    }
    void add(handle_t proc, std::error_code & ec) noexcept
    {
        if (::setpgid(proc, grp))
            ec = get_last_error();
    }

    bool has(handle_t proc)
    {
        return ::getpgid(proc) == grp;
    }
    bool has(handle_t proc, std::error_code &) noexcept
    {
        return ::getpgid(proc) == grp;
    }

    bool valid() const
    {
        return grp != -1;
    }
};

inline  void terminate(group_handle &p, std::error_code &ec) noexcept
{
    if (::killpg(p.grp, SIGKILL) == -1)
        ec = boost::process::detail::get_last_error();
    else
        ec.clear();

    p.grp = -1;
}

inline void terminate(group_handle &p)
{
    std::error_code ec;
    terminate(p, ec);
    boost::process::detail::throw_error(ec, "killpg(2) failed in terminate");
}

inline bool in_group()
{
    return true;
}

}}}}

#endif /* BOOST_PROCESS_DETAIL_WINDOWS_GROUP_HPP_ */

/* group_handle.hpp
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
*/