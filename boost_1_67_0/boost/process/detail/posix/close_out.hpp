// Copyright (c) 2006, 2007 Julio M. Merino Vidal
// Copyright (c) 2008 Ilya Sokolov, Boris Schaeling
// Copyright (c) 2009 Boris Schaeling
// Copyright (c) 2010 Felipe Tanus, Boris Schaeling
// Copyright (c) 2011, 2012 Jeff Flinn, Boris Schaeling
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_POSIX_CLOSE_OUT_HPP
#define BOOST_PROCESS_DETAIL_POSIX_CLOSE_OUT_HPP

#include <boost/process/detail/used_handles.hpp>
#include <boost/process/detail/posix/handler.hpp>
#include <array>

namespace boost { namespace process { namespace detail { namespace posix {

template<int p1, int p2>
struct close_out : handler_base_ext
{
    template <class Executor>
    inline void on_exec_setup(Executor &e) const;

    std::array<int, 2> get_used_handles() {return {p1 != -1 ? p1 : p2, p2 != -1 ? p2 : p1};}
};

template<>
template<typename Executor>
void close_out<1,-1>::on_exec_setup(Executor &e) const
{
    if (::close(STDOUT_FILENO) == -1)
        e.set_error(::boost::process::detail::get_last_error(), "close() failed");

}

template<>
template<typename Executor>
void close_out<2,-1>::on_exec_setup(Executor &e) const
{
    if (::close(STDERR_FILENO) == -1)
        e.set_error(::boost::process::detail::get_last_error(), "close() failed");
}

template<>
template<typename Executor>
void close_out<1,2>::on_exec_setup(Executor &e) const
{
    if (::close(STDOUT_FILENO) == -1)
        e.set_error(::boost::process::detail::get_last_error(), "close() failed");

    if (::close(STDERR_FILENO) == -1)
        e.set_error(::boost::process::detail::get_last_error(), "close() failed");
}

}}}}

#endif

/* close_out.hpp
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
*/