// Copyright (c) 2006, 2007 Julio M. Merino Vidal
// Copyright (c) 2008 Ilya Sokolov, Boris Schaeling
// Copyright (c) 2009 Boris Schaeling
// Copyright (c) 2010 Felipe Tanus, Boris Schaeling
// Copyright (c) 2011, 2012 Jeff Flinn, Boris Schaeling
// Copyright (c) 2016 Klemens D. Morgenstern
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_POSIX_SIGNAL_HPP
#define BOOST_PROCESS_POSIX_SIGNAL_HPP

#include <boost/process/detail/posix/handler.hpp>
#include <signal.h>

namespace boost { namespace process { namespace detail { namespace posix {

#if defined(__GLIBC__)
    using sighandler_t = ::sighandler_t;
#else
    using sighandler_t = void(*)(int);
#endif


struct sig_init_ : handler_base_ext
{

    sig_init_ (sighandler_t handler) : _handler(handler) {}

    template <class PosixExecutor>
    void on_exec_setup(PosixExecutor&)
    {
        _old = ::signal(SIGCHLD, _handler);
    }

    template <class Executor>
    void on_error(Executor&, const std::error_code &)
    {
        if (!_reset)
        {
            ::signal(SIGCHLD, _old);
            _reset = true;
        }
    }

    template <class Executor>
    void on_success(Executor&)
    {
        if (!_reset)
        {
            ::signal(SIGCHLD, _old);
            _reset = true;
        }
    }
private:
    bool _reset = false;
    ::boost::process::detail::posix::sighandler_t _old{0};
    ::boost::process::detail::posix::sighandler_t _handler{0};
};

struct sig_
{
    constexpr sig_() {}

    sig_init_ operator()(::boost::process::detail::posix::sighandler_t h) const {return h;}
    sig_init_ operator= (::boost::process::detail::posix::sighandler_t h) const {return h;}
    sig_init_ dfl() const {return SIG_DFL;}
    sig_init_ ign() const {return SIG_IGN;}

};





}}}}

#endif

/* signal.hpp
1P6G/gfi9t8S3nY98Jo+dqemMP6kZEYXTxbSjzC1gsG++4OS9k4ezh7uAEkU4jcyIkq7++/p3Mw4gOPB+S75X/Tc7mKPP0qNsw9MV19GDEz+X1gNxBRbKd/fNa0/grGwxovsnZ9uhzLxjdku8+nLwR570BvgIRAZ12ou9lwR12rxi234F9QjZUvl73XR/PC8STS9g543/tOji6qzYWIGhLnY8GXkM4QoXOygh96IaclscSwEulPYpKcp9MCoeYPN7MBmskrrdyAT33byN6M13Mpv1sr3z4W24NaJ0yBt+EsHm/W2Hq9wivAqN2LA1FiAZDdhyK8gBKa394IKzsmdZ/KOBI7DxXIgENfBgw1ZgeWGQt8r/o6K+TQUqPUecU+U4qflKkUfleIRpEgX93MA5UsJwBOPqTDPrIrB7FyfMIOjLQuxnmTmXoWc0VWJSfKGbFcq+quCa+E8W+4C1LPFRp5RfwiUJ6EEIKqEY5wHs7zr4bMONmM79K522xVPX7kgG32KQccpA9ISsQ1lBRSjgALiB9mqaa1ikPOy0YmoSoeiMYumdwEv3joh03pT7rzrEGjBwEORwOviNHzfhdUxaRYa6zTKdJSIntlgVieGhSxd+Cx5Sja7w67wwPlABD8i0tqvJ0MWOOfJLrkFjbjgXZLKP9043w1hDZBUXWzWSl4BnftUKfojnRjvj/Q6nZdaw+K0P4IsAzXocbSqHp7hgXOxtJCx4L9OSNH/aonogTxd4bPiFvyFFndW3IZ/SYE6THQWFlLnBP8eFFUVhugE/zs6mpb739LRdeOU8GnoJDcgAM8yxTFotqqcBFK3zsnkV2g6rFRiQLErGMBfJAlXIjeQ3LjWNHVwQX1MBXaofkhZv2cjJ4L3RDiEz0Jjb5QJkio2Or0FNWw9xo6vIuei1XIV+jdtvSAHkO6xSPSuSDTo7OAT1mOPszfVkJg8Qd+OiPn7Wt+G9hKJr5iYxN3vYpN/DrqbWMOrbspirCiz2ISvOpB5I7YmaNPQV3uHBy5txI+hmOTGErb093odAM2AYYb9uA3UdwD/RHXkXhzRcpNnkHrs7V4Mi7r32bJvQagiGx0JFSF0N5uDoTr3IvcCldul7VQvT7kX8gDJzthpDNNH3puZ4WWSt5qiaiX0IzsT/N9CrjZ7sxAoQmX8+Yy4xYrgx7BO1lPuJWSQ+Pp0bvzgXkKLz1r8oAZZuqSwf9fySNPwwDvSbW43WfWVRHi4HWhJ+CLygEjjbFcJMgoPXIFaItRDKWgXXqvudv5xq28U+c95l8EMtiUFGjdXme3Y97/FLgd9o+wJcewOqsmyp7iixzp2sdPLaIDF0Q8P4klscnuszlgxmvMm+P6RUUdqt3WrOAr4tr4imncgv3PAvXUbn/Bdey06Lb/5vLVabZ+N78atn+cm9n9Rx7KXo/8LcdoOslhEPxjfn+ebAuzytAR3Yla8FjfhUeaAImZUgzWJiKfGE0etTQ0wTRDLd+C1xn/jYyC0NZi98jHAwf62iI8BS1LRixiXsxnC5NKLKGp0axK7w77tDX7Fhe5mTU5UiE9e7VwIvOlpcqJ9NRrdWa+yHKi3SQZg6XkczwttQW8eqvayDkPFgw42r4wMAXyhtLWj0QyBzYSAEjnE8inCZAutEdC4E63+njmPu8D8yzAmZ4GL7LmfVrl7/9jF7J3beeF2CRrAdzdjyn2hQ/C7U8n0tsTJZq6NCiP+3mUde3UrF8YwlNx2rFK6mVHHfrMs6gMklR1rogo23OJGLL/b0oQXU2R05ofOO198lqpGZdWDvZgcK3IJQRX+yhpuDcsynuf3EOqplCYqZQcI6k89yczLlFvWIQS4/X6TO9XJMioiOeNVTRMzQc5ESRl3JzigFqX+MCdkGZQxVN5bq0krWz+D3KmlwOThhGe46vJBLqyL3AmZTWVT74TQerkOCCM+xCEAqs8BtcaOLacZAow4v4BUIDaTKrZZfweteWI1AQ3a9/A7Yvulihqp4rBUcVAp3FqL968mf6XXxV0UbkLHGWnsnYv06YNavFmhmw3hW1nVVzjVqaUrrzeFbbvmmYIJHjwHCUq3yu3ylPFu6N9b8ZTdMwKjNl0gu4TbnXI9lNaJQRP+Cgunwj3sg9Zw2HbN+wmGCX/R6xjLT9CtntrSWRHgl5DS2ceJiCfEE3MbdXFjf36Hma2dSjdMb6MQFADbie7J5jWJMgSw+Ty6L72R1t/0DVqbH9QJm/8Hh1jvfry3hP7WbRUHBSUrBS1DYT7CDSPt6Ge8h3z05xlFklMi/HyU08UmfU3qHAIeQhf0DdLCRhc22WI29QLFoAgbXNisser6sjEXIlXXhznKqfqxJOOhmz7sqzViKTdND1PPSb+FzbUyler7Jj2Lt6G7z0PdVexhz3wX6ZA33YIV575HavXAfOpVpLHkwmZVK6eLOt7OUvh+L45l3fYwKqD+FnblN7Xa1N4O7WZ4bIeSUVsK2pupSR3iRcf2MNdCaoLNol8ukMwmLpD5baC6SGcY2DiIbzGD4NmuAuhypvc6sVzKWbb8AMO1OLFzbJEa23Cj8/5YQnsKE56IuxzsPic039rHPb1gsmVgSy52Wb3z9atcmo6fLcBPG+CVLVmP3xWAuQRueoQHZpwkX/19cH+UGfGbKr6LfaLnT0H9mK/7m1uOwCw1wo/WtxjKdkJoZH37+uSE61ugRwpKM+tyfzOSLk1MSv+CeqTq9D0XSOuB/HxrMs0r0+UCk4ON5iysh5F5sCATLdmkgowNBSbMoHf3GfD5iy/O3iaBM8XLkredZ2k9rGFOOzw7BulRy6sXzx3y8WCPcpTGKxjeveUs/5cIzNx/UcFo8uL7tUS/AEQSLMjmySZSslEOdkcs2USebPyGglHBAjNKMGJXwvGOjZ+vjY0u1dph5qZZT0iFNTRaFjREPEd665h9coKLDDUb41U0TsXR9bIe1sKRK/6D6Yr/jUl69GeXgVf869mNkTDp7OXCP1/F2+iUKMW39rp+jSA/2kHu8dKGUYQcDNrJQFGa17xhXoPi0NN5ykZT3oSj3n/kfIqeUxpY4YiII96GT/ArYrletsqg2BtkAMIco/W6DfbTEAYSK20oZlcmksTIhUIcbxjrb33sVHczNbPRfrqTZilsh9XekYVxX5qIr4/dsfbna1sRqw9NdVxmRyclsIieIXUe7/xRy8NOwl8/kVY0A1H4frb+DlX4fjYIZKxU+NUmzF4fisptg5N9X49jnl9e04GT0jVQLehlxs+ezaLw2Yp9A6idOWdwHxaP1iu9OEsdEDhc5rEVhNYuRyZK6UWpoKO41jhWxy4ApfCR/Wvho9KLB/BjHouEXUcWGT4V9oVgFQUa71aHMIs6H+iRXBcv4GtmvvufuyFOaXL5/nfMvn59G8qmuyb/g/wP6zmXoozB4943s1F/zzgFbf+ww62Hvu7uqSjpGBUYRU8LPIOBTHiS3LL+gqtmJJh7mfyF6OUAcpLzOnyhIYL/RyDyhQYL/jbMC22KIvd5IvZEvlC/lb+E6VNRJu5VjPGYdcK+kzCmS5WYVatZPsE+/2c4LOw7zDOXXUb8PBAsatBpoZ0tgtmOVNq8wf49aBKp8OIiuShdqRwHlMUUCyPYtw3qFFLw/wZK7U5RCACs/JHMqcbTLOJ5Hk95FysBjHewz2Pxv9bTMsGp5sCWn6Fhiy7gQBTdcG2xwVNcASOcoogoz7s+U30TkWgcaugCmDrBrGeFsE/B0uQqHnh6n1RKDxarFFPqeNf2lRl1/DvLVD+eSUrg+o0YoyVB3O3BOnCqQ9rHBpR2nVqdv20ENgErVpn/sLcn/1N3tTrF08f3zT+DxAsV5iH6CCGq2KvVes9IyXswt6IR9UZNMft4PD+jsTei0lBdyNTaa3TrqoibJy1IDQRLGQxgsVBjS94NuRXbgYV9i4OVRVhs5yy2cRZbgL4szEsg70UeEYVD0sJjSmpfGJ/cdY2o8sl/UrOxpOkfd+2O6x84d4z2j7YuQwLlD02O6kmqpDIG2kFqK3bh/l4H7ucEdBhHspQCIXgqZXplLxLhgIn+tmQiDOrQk6tMJHJj4PDqVLYOdFyUmn0H0yhZQVIY1oxv4OIzSJKYT5mNpWwm0nM8PcdRcfLguY4o8inUQc+Z9JwGT4cDmgtOrmg/QfxSpzuEPVaqwjDxIjXWFWE+vWXTj4XD7jDuVY3hQUbmGonFwtyVSqQrZs3H1MlwAN9vNjZYz5WUuHsrynxsjd9Bj5Gq5nO+qfJeLJztSkUqWw2qWqlEHEqRvpi9PQpFtgBej/zdaNiLqMTMnQCwwChTu5eKTHLlUiSngkuudCq7Uk+ce8gkGFh+4qnVEODtDuc5OCAm3REFQ4V3KOn/xQZ0wdPdrBzQpKlosuLR9IxDs9OmQXP2zq5o5iSB5tBR4mzSoHnUpkHzsSUBmgIuhuTQ9FLROBvi0PSKQ3N+ggZNrwRotiSB5vLnxDlNg2b9BA2a70YkQFPGxZAcGpOKxnc6Dk3vODSCFo1tZFc0dUmgGcHRpGvQ/ClXgyYrEZr3eMLk0PRU0ez9Ig5Nnzg0D+Vq0Dx9R1c0uvdvjab0M+LcV4Pmb+M1aJzDE6Bp4gmTQ9NDRXPpVBwaIQ7NqvEaNG9ZuqIZnwSal+qIs1mD5nYtGt+wBGj6/hw0qSqawfFobotD8/aDGjSnRnRFsyIJNAeCxLmfBs30BzVo9mYnQJPHxZAcGqOK5pGTcWj6x6E5+4AGjSEBmt1JoGmtJc4DNGheeECD5lJWAjQruRiSQeM2ROGUn4iDMzAOjkkLZ9zwrnDakoCTyeEM0sB5/34NnIxEcP7AEyYFJyUK54PjcXBuj4OTe78GzsJhXeGM+uDWcAr/TJwzNHDOj9PAmT40AZwGnjApOPoonAvH4uAMjoPjHqeB8x/ZXeEsSALOmhri/AsNnL5aOM8PSQAnNXk4sa5jjkfzyzg0v7Nq0NRldUWzLQk0u6uJc6YGTZ5Vg+b9zARoHuRiSA6NQUUzpT4OzZA4NMfv06D5v6Fd0JR0RQKVro5lETR/PRpJx0k5nRRoxFmz0oTPyos4ZQ08AeGw+sFVWe6bCF3YfK1HZD0kv4nz83VVRCQELvQgn/NVCDS3CufZwub3IKy1B7+/ryiYIwuUYObIEcoy1BYUNq3qAHgkWEF5Cu1tSIiycb1MdWA7IWxyIIlCPJV8JKnEiTr/FoBs3OhQeS9ew0+KFqagAI0YlHK3xj2kqadO6x4yMIeXJIs1jtFQIhwtJXpoURR8OkX2AU7cF/C02SyvFPBVIqti0fhhJIqNLkWsGJxb1uGdoihtUGqnTJFKJZYP1roncUk5W7R8iN+TCSBFbHd0PYE4BUUR/HjlWa7E7OUpHVBM/yAMUIj76g7B3xNeMThMssZgtqN39M/vq3Flh3/KKzp8N/qWZ4ie9/Bc8snH+HFfrcemxpd1+MJDPL184cGemPsocStRW4Ha+gXSB4XXPrWGR/ygmj7gsltsouUM5dfXhKUlfiQydv57qMKgZwGvexstjgTluR+wMqk1Kdh+5fw0o1yJDVHei4ltn669TS7o8IX6lvfyhfoJm68g6AAmyJ1lMpYPpMghgn+0Qd3wyEbjaGrckFvk281SlVpVWTJVI55MVmHTv9kO/1Auj5utsHjXTpgZ7/F5PBuJXmy0+hQ2/QDr7JaXsZwKyULhslhyGVORFBSSyCy9USoxwo9JKjHJ+fp02iSQpqZL3rqgvZm2ESsu1tpP6tRT32HsJZ0ety6Gu1PQ36W9jraHV/LAEXJhPTQ+XEyzrCW0xZHtq2hGz+q423CymBWO4rvXtNTmkpLvU6aRPd1xz2MRd4UT5Ntsg7zjnCwXPSx3765QVpAPOi0czHVFK3kE4cEO1lofycSKQubaRo+VpFGSLf1S0H7Dna4oDLuP2sCOHUEVWzkgjDNT6Dvo8s3C7vwzHVJxUggZyQb2ptR9lEAz37uh1C9TaiUjkhqPuO5kLTVq6maeejQ7i44sApiJfH/6mf5mpdIMfxejIeOXciUmVxQTPJ1uPbpPp7/lANJMn+1jRqdEIQ75qESB7KxItiiFdey7S1jPWBmQ0V2yvd7BNi4m6wXKuIhFlQ2XF2urwhDMUpUUm5CG3RsLx+6lP6mjWdKinX4w/rlXbfoGtnEdtLvbY5tkuPHFUj+ilpDDO2uxGjqZ0SaZVwkc5lKj0NX4aZxpRukRo+wwQUmxWealO3kstMsgUeOOEbuBpBF4Y+Q8o4PtFCPwcthyQo+4FFJpxaxPVRSYmtsLlzp12eQ6K5AA4c/rrLyXctXkI+1izuPbnurAtGmgeqnEV4UdVBcMNKhIY1tAnvFWGPiwL6/Jsl5V9dmAX8kphuNuXfjkw75as42iy7/hkU7WZOEdropGPBphIRNdIOyxWq/GfRyye3919HHISpUN7XShDwkHe1EN6rQ912Y9xt4uVPewaVPf+4y6h432jM0hvAIc26LztU3j+3M1Ur4lTz2vqnEo+RYH36Zz039lpiWbbarW6YL5lgG4vQW/czAafi2os+A3T+DvE2n7Md8yhqcbBX/O1bMTP1HgnBQeCHSjSHXtU8MNLPeOBCcS+0GtagbpfIsZ7XDyqEvnW+Yb2Znpuqghq1m1x/zXqTpdSysOW3M+pBPjl6ZA05xlySzGBxRgLCtq5aog35LugIAMdvdC4KNziGWQgu2zI1MZIm/WLMnGdOuHmOMlyKC1HBhBbwF87CuV227ktljDrbu6Jm4nidsbyO0eeabFDDMR5HAncSAK3S6keG4K2bQO2EXw3n2I23PlUWoDSQSlY4A8M25xFO4rt+SZI/W4sg9kOsbJLMPVY054dcQOHWda8qz1zP5Il7OnSPtqyyaPGSbrOTrptP3kyersz4D8jX16KoQG9NXe3nSfWnVeYU+3VXsyO92PjtFfbzXgueEDeNXXWCDZ29DHTBUeHND8c7aLVfC5Dvq4lcNyYUgZN222aypbFAn2tgauejLouEQOdzovaU2xHlY8BSk2b9vKPdK8tsA5YfN8nIx4r+d4Q+gUNkXYdQUmT4ZrUkWH5L0oH7ddW5sin4hd301bpr26iZd3eznlwna2BZakeMVpsGJ8QZrH0HKsUfCh81o0zSphNb+OXi4R/Ftxgjddh9+VB7i1OXamDCg6FcoJ5VSEDOcU42RHscNwoYRdmR65wSW8VKvD47B1TX/AW1yBeviR7dflwnS6k+xi4xwx0t8S6Za87UhaOXY7Jy01GUI59tD/k3ct0FFUabpfJIXppAvoQHiD9mA0qDhBVHoZw0AyjBLsTqCDCyE6YuyJeERMA448xE5m7C0bmfExzoysqDgqssozBHklhE2DogTwjGH1yGMZvUgcO5JDGhPS+///raqu7lQerOM5e87qCUndqnvvf//71X8f9f/fLTDmtmQfKiwNWFewm1Co5S2KXJUPgfWq/Az0V9el/uZOMTmLz9qeGoPmzncKqXNPd/CmG50LI7Znj+NVcRPGvxg1dDIcAOxFsAHsEPxjgwbsh5+Q/PNPj4MC/U78seuI/zxyuFA64ZGybTuSXGz13QpJj922I8/krze52G+UNF+TZAZkV/gRHTxAOAaxNx/qDDHBLX3IboSpDQUUY9hrR3DmHaaCoH1hAYW2udjBX2iD/dYseIP6fi78YlfDQMJmOdDrfulfOLHA8xgwzNl+lnK2nxx4cgL8OOWfH0NXsXjT/UWhPDsNJ3n46cxQn4Tfcf5NyKk45LuUFXIha867Zk5fEzNDkNO/wi4uSpFAw/cPl2OfEsrRkGJIyR5YKsWiyKeXRfWjyI9jVGkyhnG52KrZZEoURW76KylyHfxiJ8BmMus1RgOPM99AMV71liSDFJpXB3gLwEMr4adC/vkxdKj9TzL26G/bU7yxURtvjJ7tarxxTnyw8Sd3XXmwMY+3s3IOhCLpcdHZ9thV3vEworGs6/pDVWJWmzP0mEmKOJt9I8ui5jbkO6oCKQrLDPDXRpPMm4Thk/5ox+KrvNMx86uZkDnPDlkzpTzRhZkexbVYvgDTLm81+XJMti8ySX1vz7Mvul5KOp8J7fsqsAJeD3FRmpRUAsZUKRcrqCdeDSvyAJg/BAw89ivy+0ewQaZFNimp3nJbTBSpPu5S7Y+4+MLyR/jMCv6PFqKPVTR9AZ7dtTBaeXFFYRdBhXdiDyRjJo8rLhtHXH8iZJBCJfWWNANnNuDIXvQgIPsIS0GDwnkZ8J1J5J/hZO0u6/KRWv6ZCQ9q+GdQM71mn/GmYf6LpVr+CWy/1AzNv0eaYfdfEhdZQP0mqd7ZuOgXmkvJI5obnMcXZ2PaIAzot7qzGgGsH7P6y9Eoj5hEQqR6Jfk9NRkZGDRoeG6MgoYhUGoBouF+I8Z44HIXrIXS/9/p9b+g6X8B+7/QxXz3dtP7QnzvJ8a7ocrzcAJb5KxVsH4HCrjcmlXLsQ6CuSSPvdD/PWpjBGjjC/7nQPjzb1kh8wmX+aT5aGEBG4bT/DwRZMkKkTR54hwQP63eYpQtI0jzsfYq3j7M6pL/4UxbNHpl/A85Jl3+B1hsuLT+SMP0/PkDD4SRdYiCe8P+j23+jo7FFil8/lqpxF79zoYNG1q/lD48eu7o184PFg+ohvlDNKs2OH6ws3Fxn714BdOOGehR4zy4uL//UnRJfzebMMgoj699ArnCeTc//KhROZPquztFg3f9zRl0sEQot5E8Dm9ZgDwuAiyhYHaWA0K5/LV42J+JvW4k+sXq0o0GsU4CQX1nwW4BiIf4V9qxa5Kha0KFLsjtYp55HB4raSSyudmJgXwqnSvUJxsCyYEl9kCJ6O8QwQBF6i0jdU/TkXxN8lA2sIC9xAsoM8QPZmU4nLGVD8nek/z96hWfUR2siPG8byvAXstnlKyYJFfwbpMbrUsg3yobmHBsnHTcH03gOqrHSQgSBr4Nb6GUYtsxCKbyZKbcBS6NlSIqwffRSqVwGxXjLJLx2DXfhDGOb2JdG24F6PBNCP4m4q4qn4hQSHWzrHQZCr5M7rDfEsoVCAVN0xQU5Le4Q7kthIKbytS1TciAbihSDsIo2cX6QUH3JPBXoD2TpmS0Nngo3n04xbt/yF64wUjRt3mWQlYFQw+3uMjhshHvRNh9aMjpgZJC9rz6hKbww0p8Pnqn/K/j84vtvYrP//s=
*/