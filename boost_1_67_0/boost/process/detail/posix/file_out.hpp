// Copyright (c) 2006, 2007 Julio M. Merino Vidal
// Copyright (c) 2008 Ilya Sokolov, Boris Schaeling
// Copyright (c) 2009 Boris Schaeling
// Copyright (c) 2010 Felipe Tanus, Boris Schaeling
// Copyright (c) 2011, 2012 Jeff Flinn, Boris Schaeling
// Copyright (c) 2016 Klemens D. Morgenstern
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_POSIX_FILE_OUT_HPP
#define BOOST_PROCESS_POSIX_FILE_OUT_HPP

#include <boost/process/detail/posix/handler.hpp>
#include <boost/process/detail/posix/file_descriptor.hpp>
#include <boost/process/detail/used_handles.hpp>
#include <unistd.h>

namespace boost { namespace process { namespace detail { namespace posix {

template<int p1, int p2>
struct file_out : handler_base_ext, ::boost::process::detail::uses_handles
{
    file_descriptor file;
    int handle = file.handle();

    template<typename T>
    file_out(T&& t) : file(std::forward<T>(t), file_descriptor::write), handle(file.handle()) {}
    file_out(FILE * f) : handle(fileno(f)) {}

    std::array<int, 3> get_used_handles()
    {
        const auto pp1 = p1 != -1 ? p1 : p2;
        const auto pp2 = p2 != -1 ? p2 : p1;

        return {handle, pp1, pp2};
    }

    template <typename Executor>
    void on_exec_setup(Executor &e) const;
};

template<>
template<typename Executor>
void file_out<1,-1>::on_exec_setup(Executor &e) const
{
    if (::dup2(handle, STDOUT_FILENO) == -1)
         e.set_error(::boost::process::detail::get_last_error(), "dup2() failed");
}

template<>
template<typename Executor>
void file_out<2,-1>::on_exec_setup(Executor &e) const
{
    if (::dup2(handle, STDERR_FILENO) == -1)
         e.set_error(::boost::process::detail::get_last_error(), "dup2() failed");
}

template<>
template<typename Executor>
void file_out<1,2>::on_exec_setup(Executor &e) const
{
    if (::dup2(handle, STDOUT_FILENO) == -1)
         e.set_error(::boost::process::detail::get_last_error(), "dup2() failed");

    if (::dup2(handle, STDERR_FILENO) == -1)
         e.set_error(::boost::process::detail::get_last_error(), "dup2() failed");

}

}}}}

#endif

/* file_out.hpp
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
*/