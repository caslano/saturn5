// Copyright (c) 2016 Klemens D. Morgenstern
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_POSIX_FILE_DESCRIPTOR_HPP_
#define BOOST_PROCESS_DETAIL_POSIX_FILE_DESCRIPTOR_HPP_

#include <fcntl.h>
#include <string>
#include <boost/filesystem/path.hpp>

namespace boost { namespace process { namespace detail { namespace posix {

struct file_descriptor
{
    enum mode_t
    {
        read  = 1,
        write = 2,
        read_write = 3
    };


    file_descriptor() = default;
    explicit file_descriptor(const boost::filesystem::path& p, mode_t mode = read_write)
        : file_descriptor(p.native(), mode)
    {
    }

    explicit file_descriptor(const std::string & path , mode_t mode = read_write)
        : file_descriptor(path.c_str(), mode) {}


    explicit file_descriptor(const char*    path, mode_t mode = read_write)
        : _handle(create_file(path, mode))
    {

    }

    file_descriptor(const file_descriptor & ) = delete;
    file_descriptor(file_descriptor && ) = default;

    file_descriptor& operator=(const file_descriptor & ) = delete;
    file_descriptor& operator=(file_descriptor && ) = default;

    ~file_descriptor()
    {
        if (_handle != -1)
            ::close(_handle);
    }

    int handle() const { return _handle;}

private:
    static int create_file(const char* name, mode_t mode )
    {
        switch(mode)
        {
        case read:
            return ::open(name, O_RDONLY);
        case write:
            return ::open(name, O_WRONLY | O_CREAT, 0660);
        case read_write:
            return ::open(name, O_RDWR | O_CREAT, 0660);
        default:
            return -1;
        }
    }

    int _handle = -1;
};

}}}}

#endif /* BOOST_PROCESS_DETAIL_WINDOWS_FILE_DESCRIPTOR_HPP_ */

/* file_descriptor.hpp
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
*/