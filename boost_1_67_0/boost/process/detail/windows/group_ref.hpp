// Copyright (c) 2016 Klemens D. Morgenstern
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_WINDOWS_GROUP_REF_HPP_
#define BOOST_PROCESS_DETAIL_WINDOWS_GROUP_REF_HPP_

#include <boost/winapi/process.hpp>
#include <boost/process/detail/config.hpp>
#include <boost/process/detail/windows/group_handle.hpp>
#include <boost/process/detail/used_handles.hpp>
#include <boost/process/detail/windows/handler.hpp>

namespace boost { namespace process {

namespace detail { namespace windows {



struct group_ref : handler_base_ext, ::boost::process::detail::uses_handles
{
    ::boost::winapi::HANDLE_ handle;

    ::boost::winapi::HANDLE_ get_used_handles() const { return handle; }

    explicit group_ref(group_handle &g) :
                handle(g.handle())
    {}

    template <class Executor>
    void on_setup(Executor& exec) const
    {
        //I can only enable this if the current process supports breakaways.
        if (in_group() && break_away_enabled(nullptr))
            exec.creation_flags  |= boost::winapi::CREATE_BREAKAWAY_FROM_JOB_;
    }


    template <class Executor>
    void on_success(Executor& exec) const
    {
        if (!::boost::winapi::AssignProcessToJobObject(handle, exec.proc_info.hProcess))
            exec.set_error(::boost::process::detail::get_last_error(),
                           "AssignProcessToJobObject() failed.");

    }

};

}}}}


#endif /* BOOST_PROCESS_DETAIL_WINDOWS_GROUP_HPP_ */

/* group_ref.hpp
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
*/