// Copyright (c) 2006, 2007 Julio M. Merino Vidal
// Copyright (c) 2008 Ilya Sokolov, Boris Schaeling
// Copyright (c) 2009 Boris Schaeling
// Copyright (c) 2010 Felipe Tanus, Boris Schaeling
// Copyright (c) 2011, 2012 Jeff Flinn, Boris Schaeling
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_WINDOWS_FILE_OUT_HPP
#define BOOST_PROCESS_DETAIL_WINDOWS_FILE_OUT_HPP

#include <boost/winapi/process.hpp>
#include <boost/winapi/handles.hpp>
#include <boost/winapi/handle_info.hpp>
#include <boost/process/detail/handler_base.hpp>
#include <boost/process/detail/used_handles.hpp>
#include <boost/process/detail/windows/file_descriptor.hpp>

namespace boost { namespace process { namespace detail { namespace windows {

template<int p1, int p2>
struct file_out : public ::boost::process::detail::handler_base,
                         ::boost::process::detail::uses_handles
{
    file_descriptor file;
    ::boost::winapi::HANDLE_ handle = file.handle();

    ::boost::winapi::HANDLE_ get_used_handles() const { return handle; }


    template<typename T>
    file_out(T&& t) : file(std::forward<T>(t), file_descriptor::write) {}
    file_out(FILE * f) : handle(reinterpret_cast<void*>(_get_osfhandle(_fileno(f)))) {}

    template <typename WindowsExecutor>
    inline void on_setup(WindowsExecutor &e) const;
};

template<>
template<typename WindowsExecutor>
void file_out<1,-1>::on_setup(WindowsExecutor &e) const
{
    boost::winapi::SetHandleInformation(handle,
            boost::winapi::HANDLE_FLAG_INHERIT_,
            boost::winapi::HANDLE_FLAG_INHERIT_);

    e.startup_info.hStdOutput = handle;
    e.startup_info.dwFlags   |= ::boost::winapi::STARTF_USESTDHANDLES_;
    e.inherit_handles = true;
}

template<>
template<typename WindowsExecutor>
void file_out<2,-1>::on_setup(WindowsExecutor &e) const
{
    boost::winapi::SetHandleInformation(handle,
            boost::winapi::HANDLE_FLAG_INHERIT_,
            boost::winapi::HANDLE_FLAG_INHERIT_);

    e.startup_info.hStdError = handle;
    e.startup_info.dwFlags  |= ::boost::winapi::STARTF_USESTDHANDLES_;
    e.inherit_handles = true;
}

template<>
template<typename WindowsExecutor>
void file_out<1,2>::on_setup(WindowsExecutor &e) const
{
    boost::winapi::SetHandleInformation(handle,
            boost::winapi::HANDLE_FLAG_INHERIT_,
            boost::winapi::HANDLE_FLAG_INHERIT_);

    e.startup_info.hStdOutput = handle;
    e.startup_info.hStdError  = handle;
    e.startup_info.dwFlags   |= ::boost::winapi::STARTF_USESTDHANDLES_;
    e.inherit_handles = true;
}

}}}}

#endif

/* file_out.hpp
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
*/