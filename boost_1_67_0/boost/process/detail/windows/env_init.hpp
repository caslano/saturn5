// Copyright (c) 2016 Klemens D. Morgenstern
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)


#ifndef BOOST_PROCESS_DETAIL_WINDOWS_ENV_INIT_HPP_
#define BOOST_PROCESS_DETAIL_WINDOWS_ENV_INIT_HPP_

#include <boost/winapi/error_codes.hpp>
#include <boost/winapi/process.hpp>


#include <boost/process/detail/config.hpp>
#include <boost/process/detail/handler_base.hpp>
#include <boost/process/environment.hpp>

namespace boost { namespace process { namespace detail { namespace windows {

template<typename Char>
struct env_init : public ::boost::process::detail::handler_base
{
    boost::process::basic_environment<Char> env;

    env_init(boost::process::basic_environment<Char> && env) : env(std::move(env)) {};
    env_init(const boost::process::basic_environment<Char> & env) : env(env) {};

    constexpr static ::boost::winapi::DWORD_ creation_flag(char)    {return 0u;}
    constexpr static ::boost::winapi::DWORD_ creation_flag(wchar_t)
    {
       return ::boost::winapi::CREATE_UNICODE_ENVIRONMENT_;
    }

    template <class WindowsExecutor>
    void on_setup(WindowsExecutor &exec) const
    {
        auto e = env.native_handle();
        if (*e == null_char<char>())
        {
            exec.set_error(std::error_code(::boost::winapi::ERROR_BAD_ENVIRONMENT_, std::system_category()),
                    "Empty Environment");
        }

        exec.env = e;
        exec.creation_flags |= creation_flag(Char());
    }

};

}}}}



#endif /* BOOST_PROCESS_DETAIL_WINDOWS_ENV_INIT_HPP_ */

/* env_init.hpp
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
*/