// Copyright (c) 2006, 2007 Julio M. Merino Vidal
// Copyright (c) 2008 Ilya Sokolov, Boris Schaeling
// Copyright (c) 2009 Boris Schaeling
// Copyright (c) 2010 Felipe Tanus, Boris Schaeling
// Copyright (c) 2011, 2012 Jeff Flinn, Boris Schaeling
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_WINDOWS_INITIALIZERS_NULL_OUT_HPP
#define BOOST_PROCESS_WINDOWS_INITIALIZERS_NULL_OUT_HPP

#include <boost/winapi/process.hpp>
#include <boost/winapi/handles.hpp>
#include <boost/winapi/handle_info.hpp>
#include <boost/process/detail/handler_base.hpp>
#include <boost/process/detail/used_handles.hpp>
#include <boost/process/detail/windows/file_descriptor.hpp>

namespace boost { namespace process { namespace detail { namespace windows {

template<int p1, int p2>
struct null_out : public ::boost::process::detail::handler_base, ::boost::process::detail::uses_handles
{
    file_descriptor sink {"NUL", file_descriptor::write}; //works because it gets destroyed AFTER launch.

    ::boost::winapi::HANDLE_ get_used_handles() const { return sink.handle(); }

    template <typename WindowsExecutor>
    void on_setup(WindowsExecutor &e) const;
};

template<>
template<typename WindowsExecutor>
void null_out<1,-1>::on_setup(WindowsExecutor &e) const
{
    boost::winapi::SetHandleInformation(sink.handle(),
              boost::winapi::HANDLE_FLAG_INHERIT_,
              boost::winapi::HANDLE_FLAG_INHERIT_);

    e.startup_info.hStdOutput = sink.handle();
    e.startup_info.dwFlags   |= ::boost::winapi::STARTF_USESTDHANDLES_;
    e.inherit_handles = true;

}

template<>
template<typename WindowsExecutor>
void null_out<2,-1>::on_setup(WindowsExecutor &e) const
{
    boost::winapi::SetHandleInformation(sink.handle(),
              boost::winapi::HANDLE_FLAG_INHERIT_,
              boost::winapi::HANDLE_FLAG_INHERIT_);

    e.startup_info.hStdError = sink.handle();
    e.startup_info.dwFlags  |= ::boost::winapi::STARTF_USESTDHANDLES_;
    e.inherit_handles = true;

}

template<>
template<typename WindowsExecutor>
void null_out<1,2>::on_setup(WindowsExecutor &e) const
{
    boost::winapi::SetHandleInformation(sink.handle(),
            boost::winapi::HANDLE_FLAG_INHERIT_,
            boost::winapi::HANDLE_FLAG_INHERIT_);

    e.startup_info.hStdOutput = sink.handle();
    e.startup_info.hStdError  = sink.handle();
    e.startup_info.dwFlags   |= ::boost::winapi::STARTF_USESTDHANDLES_;
    e.inherit_handles = true;

}

}}}}

#endif

/* null_out.hpp
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
*/