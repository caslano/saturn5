// Copyright (c) 2016 Klemens D. Morgenstern
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_PROCESS_DETAIL_WINDOWS_COMPARE_HANDLES_HPP_
#define BOOST_PROCESS_DETAIL_WINDOWS_COMPARE_HANDLES_HPP_

#include <boost/winapi/handles.hpp>
#include <boost/winapi/file_management.hpp>
#include <boost/process/detail/config.hpp>

namespace boost { namespace process { namespace detail { namespace windows {

inline bool compare_handles(boost::winapi::HANDLE_ lhs, boost::winapi::HANDLE_ rhs)
{
    if ( (lhs == ::boost::winapi::INVALID_HANDLE_VALUE_)
      || (rhs == ::boost::winapi::INVALID_HANDLE_VALUE_))
        return false;

    if (lhs == rhs)
        return true;

    ::boost::winapi::BY_HANDLE_FILE_INFORMATION_ lhs_info{0,{0,0},{0,0},{0,0},0,0,0,0,0,0};
    ::boost::winapi::BY_HANDLE_FILE_INFORMATION_ rhs_info{0,{0,0},{0,0},{0,0},0,0,0,0,0,0};

    if (!::boost::winapi::GetFileInformationByHandle(lhs, &lhs_info))
        ::boost::process::detail::throw_last_error("GetFileInformationByHandle");

    if (!::boost::winapi::GetFileInformationByHandle(rhs, &rhs_info))
        ::boost::process::detail::throw_last_error("GetFileInformationByHandle");

    return     (lhs_info.nFileIndexHigh == rhs_info.nFileIndexHigh)
            && (lhs_info.nFileIndexLow  == rhs_info.nFileIndexLow);
}

}}}}



#endif /* BOOST_PROCESS_DETAIL_WINDOWS_COMPARE_HANDLES_HPP_ */

/* compare_handles.hpp
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
*/