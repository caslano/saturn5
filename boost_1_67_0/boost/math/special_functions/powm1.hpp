//  (C) Copyright John Maddock 2006.
//  Use, modification and distribution are subject to the
//  Boost Software License, Version 1.0. (See accompanying file
//  LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_MATH_POWM1
#define BOOST_MATH_POWM1

#ifdef _MSC_VER
#pragma once
#pragma warning(push)
#pragma warning(disable:4702) // Unreachable code (release mode only warning)
#endif

#include <boost/math/special_functions/math_fwd.hpp>
#include <boost/math/special_functions/log1p.hpp>
#include <boost/math/special_functions/expm1.hpp>
#include <boost/math/special_functions/trunc.hpp>
#include <boost/assert.hpp>

namespace boost{ namespace math{ namespace detail{

template <class T, class Policy>
inline T powm1_imp(const T x, const T y, const Policy& pol)
{
   BOOST_MATH_STD_USING
   static const char* function = "boost::math::powm1<%1%>(%1%, %1%)";

   if (x > 0)
   {
      if ((fabs(y * (x - 1)) < 0.5) || (fabs(y) < 0.2))
      {
         // We don't have any good/quick approximation for log(x) * y
         // so just try it and see:
         T l = y * log(x);
         if (l < 0.5)
            return boost::math::expm1(l);
         if (l > boost::math::tools::log_max_value<T>())
            return boost::math::policies::raise_overflow_error<T>(function, 0, pol);
         // fall through....
      }
   }
   else
   {
      // y had better be an integer:
      if (boost::math::trunc(y) != y)
         return boost::math::policies::raise_domain_error<T>(function, "For non-integral exponent, expected base > 0 but got %1%", x, pol);
      if (boost::math::trunc(y / 2) == y / 2)
         return powm1_imp(T(-x), y, pol);
   }
   return pow(x, y) - 1;
}

} // detail

template <class T1, class T2>
inline typename tools::promote_args<T1, T2>::type 
   powm1(const T1 a, const T2 z)
{
   typedef typename tools::promote_args<T1, T2>::type result_type;
   return detail::powm1_imp(static_cast<result_type>(a), static_cast<result_type>(z), policies::policy<>());
}

template <class T1, class T2, class Policy>
inline typename tools::promote_args<T1, T2>::type 
   powm1(const T1 a, const T2 z, const Policy& pol)
{
   typedef typename tools::promote_args<T1, T2>::type result_type;
   return detail::powm1_imp(static_cast<result_type>(a), static_cast<result_type>(z), pol);
}

} // namespace math
} // namespace boost

#ifdef _MSC_VER
#pragma warning(pop)
#endif

#endif // BOOST_MATH_POWM1






/* powm1.hpp
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
*/