/*
 * Copyright Nick Thompson, 2020
 * Use, modification and distribution are subject to the
 * Boost Software License, Version 1.0. (See accompanying file
 * LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
 */
#ifndef BOOST_MATH_QUADRATURE_WAVELET_TRANSFORMS_HPP
#define BOOST_MATH_QUADRATURE_WAVELET_TRANSFORMS_HPP
#include <boost/math/special_functions/daubechies_wavelet.hpp>
#include <boost/math/quadrature/trapezoidal.hpp>

namespace boost::math::quadrature {

template<class F, typename Real, int p>
class daubechies_wavelet_transform
{
public:
    daubechies_wavelet_transform(F f, int grid_refinements = -1, Real tol = 100*std::numeric_limits<Real>::epsilon(),
    int max_refinements = 12) : f_{f}, psi_(grid_refinements), tol_{tol}, max_refinements_{max_refinements}
    {}

    daubechies_wavelet_transform(F f, boost::math::daubechies_wavelet<Real, p> wavelet, Real tol = 100*std::numeric_limits<Real>::epsilon(),
    int max_refinements = 12) : f_{f}, psi_{wavelet}, tol_{tol}, max_refinements_{max_refinements}
    {}

    auto operator()(Real s, Real t)->decltype(std::declval<F>()(std::declval<Real>())) const
    {
        using std::sqrt;
        using std::abs;
        using boost::math::quadrature::trapezoidal;
        auto g = [&] (Real u) {
            return f_(s*u+t)*psi_(u);
        };
        auto [a,b] = psi_.support();
        return sqrt(abs(s))*trapezoidal(g, a, b, tol_, max_refinements_);
    }

private:
    F f_;
    boost::math::daubechies_wavelet<Real, p> psi_;
    Real tol_;
    int max_refinements_;
};


}
#endif
/* wavelet_transforms.hpp
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
*/