//  Copyright 2015 Klemens Morgenstern
//
// This file provides a demangling for function names, i.e. entry points of a dll.
//
//  Distributed under the Boost Software License, Version 1.0.
//  See http://www.boost.org/LICENSE_1_0.txt

#ifndef BOOST_DLL_DEMANGLE_SYMBOL_HPP_
#define BOOST_DLL_DEMANGLE_SYMBOL_HPP_

#include <boost/dll/config.hpp>
#include <string>
#include <algorithm>
#include <memory>

#if defined(_MSC_VER) // MSVC, Clang-cl, and ICC on Windows

namespace boost
{
namespace dll
{
namespace detail
{

typedef void * (__cdecl * allocation_function)(std::size_t);
typedef void   (__cdecl * free_function)(void *);

extern "C" char* __unDName( char* outputString,
        const char* name,
        int maxStringLength,    // Note, COMMA is leading following optional arguments
        allocation_function pAlloc,
        free_function pFree,
        unsigned short disableFlags
        );


inline std::string demangle_symbol(const char *mangled_name)
{

    allocation_function alloc =  [](std::size_t size){return static_cast<void*>(new char[size]);};
    free_function free_f      = [](void* p){delete [] static_cast<char*>(p);};



    std::unique_ptr<char> name { __unDName(
            nullptr,
            mangled_name,
            0,
            alloc,
            free_f,
            static_cast<unsigned short>(0))};

    return std::string(name.get());
}
inline std::string demangle_symbol(const std::string& mangled_name)
{
    return demangle_symbol(mangled_name.c_str());
}


}}}
#else

#include <boost/core/demangle.hpp>

namespace boost
{
namespace dll
{
namespace detail
{

inline std::string demangle_symbol(const char *mangled_name)
{

    if (*mangled_name == '_')
    {
        //because it start's with an underline _
        auto dm = boost::core::demangle(mangled_name);
        if (!dm.empty())
            return dm;
        else
            return (mangled_name);
    }

    //could not demangled
    return "";


}

//for my personal convenience
inline std::string demangle_symbol(const std::string& mangled_name)
{
    return demangle_symbol(mangled_name.c_str());
}


}
namespace experimental
{
using ::boost::dll::detail::demangle_symbol;
}

}}

#endif

#endif /* BOOST_DEMANGLE_HPP_ */

/* demangle_symbol.hpp
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
*/