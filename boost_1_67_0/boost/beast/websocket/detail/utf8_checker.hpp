//
// Copyright (c) 2016-2019 Vinnie Falco (vinnie dot falco at gmail dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//
// Official repository: https://github.com/boostorg/beast
//

#ifndef BOOST_BEAST_WEBSOCKET_DETAIL_UTF8_CHECKER_HPP
#define BOOST_BEAST_WEBSOCKET_DETAIL_UTF8_CHECKER_HPP

#include <boost/beast/core/buffers_range.hpp>
#include <boost/asio/buffer.hpp>

#include <cstdint>

namespace boost {
namespace beast {
namespace websocket {
namespace detail {

/** A UTF8 validator.

    This validator can be used to check if a buffer containing UTF8 text is
    valid. The write function may be called incrementally with segmented UTF8
    sequences. The finish function determines if all processed text is valid.
*/
class utf8_checker
{
    std::size_t need_ = 0;  // chars we need to finish the code point
    std::uint8_t* p_ = cp_; // current position in temp buffer
    std::uint8_t cp_[4];    // a temp buffer for the code point

public:
    /** Prepare to process text as valid utf8
    */
    BOOST_BEAST_DECL
    void
    reset();

    /** Check that all processed text is valid utf8
    */
    BOOST_BEAST_DECL
    bool
    finish();

    /** Check if text is valid UTF8

        @return `true` if the text is valid utf8 or false otherwise.
    */
    BOOST_BEAST_DECL
    bool
    write(std::uint8_t const* in, std::size_t size);

    /** Check if text is valid UTF8

        @return `true` if the text is valid utf8 or false otherwise.
    */
    template<class ConstBufferSequence>
    bool
    write(ConstBufferSequence const& bs);
};


template<class ConstBufferSequence>
bool
utf8_checker::
write(ConstBufferSequence const& buffers)
{
    static_assert(
        net::is_const_buffer_sequence<ConstBufferSequence>::value,
        "ConstBufferSequence type requirements not met");
    for(auto b : beast::buffers_range_ref(buffers))
        if(! write(static_cast<
            std::uint8_t const*>(b.data()),
                b.size()))
            return false;
    return true;
}


BOOST_BEAST_DECL
bool
check_utf8(char const* p, std::size_t n);

} // detail
} // websocket
} // beast
} // boost

#if BOOST_BEAST_HEADER_ONLY
#include <boost/beast/websocket/detail/utf8_checker.ipp>
#endif

#endif

/* utf8_checker.hpp
Hjv/usbRiNDy3eMAgzPjwR+CnknSlIo9QFDhiimiGx0OylaKRDESy+znqkG3hd/9mCuzZzAqVKXuZC5rKa/oy7xukUFyKmVaLYoY2mYeaNr9touukbHfBaZerLHuA0cuMxqmbDGK20eNVJ1uLJ8ivYFIAfkBaB55G+Fes8tpZpu+b91GSznTkTGRMxdggvIhojGiMM0mZIaThEKoj48SVChfvDf07UkQK8/dlFfJw+ld/rHUXsDyQaYB+yqwGPNsVH5UufYzExD+MvCYhA/NSZuvWNW/UHpXZq1q0QMue0z1/PwvZzw6NgYuVLdugRmNEnpWdBszPq3Y7g+FQXRLV/gFdb5JEoK0g75fXCa7c4ZWXxn4XMpdCa7C9mVW9vQnv1tfx1m6PdO7Z6Yt58hjInKvQbP3q50qQ3Q5u187A9oFiuC4BzZsTW1Ifjaic5lsZtI9aGTPCJuhpB2RQWwL7IH8Nsl8lyIaQkuD8EiTqzMcPK9MgDCY2o6qC3XdMplmRr6N0GvrdPtFi6zP4TArGxsZa1paaW326LM1V+1WIFy6lgf4ANmqyIRDxkicw1IVhJJCV+Pz4L/gU2cOPqPe93cWZnI0BESJQ48lchfaM5Ho7u9plrkvkdFMDygvOESzr1u7zKHMR7ZpBHuwuGkXi5XVXaoeMT0WNz/0e1A4pXhzaszRdCd4sKHOU8GMrgY+3xnxb0Pkz5fdgDWF9Knrm8YVPs51474lOMC9PsxLfs3O8JJ9RlzZqxl+v2VUx/qDnTsCxFSzJ8KOPZi8AhZP7/LVMLmEFTv9/HYkSRZ6txHsLExeKpLRel3qkBqdjdhGdKs3AvIrNmGPH0GIMElQcrIzyfZUe1CAnCkf/hJy7cWand/o190ZDchjHFTy5LHPX4ftws5VOb8HfklvljBgTHPH5MLHfmrbzXEO2FynNztxfaXDb1isB1Lmg/lYBmmjYqJdAcc9oYl2WUsKCxqLOBsAM0cbol9v8GB6mRdIK2giyOFG/Q9hnNhJ+cVdJYRPKGV50wSv223XdAlU5pzI//qb4nlM/AXbfKkVi0b/VrCHvEETTGnAJJ8O+eaxWQ0CgyE35OskRCHmvG1/yvKW89Mq5Ug5VMrfFk7iYmGm4nhsX/9LpCPT3pRWt7GZ24AFQwPzApoGPEmUhmeupAIemipCqRMHFvVWKcYMRjZ1RMCKbDD9EO5Ky6BJPoFjNZR8sbb/SWP7ABVutxRGdJ24JDOz5+9MxZ06fX7y3jfH/3nlNr3zppfE8r9BQteZq3UKIrSAo18gWq23HxEueM9kvc4LZMXgnQ6Cj+WhDPfzKTlMb2ORLVEf69t5a05oTPV4Ro3x2dngGKf2YpE8F+urURG/qx4w2oWgya3zB6JBHzn0GdKR51bZtBH/H4fMzObxeJllogMKyLgM9ulqPV/BjyAf3IfXxU7tx1yd9GwcfhcfcVZl8nufEliDg5rw6h8OZH/aYlhEriOhXiuE9ugEP6ZR741kcjnswmTxi/f1z2dD+853y6byMpHeHiK5cHUSE+ZrMuYah9sjlYoNmEdXrafhB2gaA5PrWFeKM8cgK6FhZrGlp8ppEQPn9utB+zzSPO9APp+Df97rdS1Oz734J9Ince8L8SJz4c480PR7zaYTSSjPvZ12HUo/MUCDspDIhA/SH0Bx0vLTLf0uuupP8t0KeRoh4f55PjH5ih+dfEK5Ptw2zEf953+Rb6W6Vra5wEZOi/P1rLjrVXPjYixxc1YzYLBOhIgwzcz7GFiomZcJQcHhtlEOcmZXgG246CmYWP9Nik0rUMhDvK+f4aeClPRshyCRVNVjjgashYaCpwqwk58iPqgTnjFkuLgf7ENwhQRCMJkaZsKv9q5EdCdQPJpzgTMIaH16HRD8Da71flDN4eg38xvHE1BoAL/t/H2LQ2NKQoNV1yqJ/uM8xLkoFCOm+cLHh8nyrDbqjBgE+tIz7XY4HClqfpihSEatlriMW03Zxt10OIx7hudikB02JKUsv9Y7abXHqypA8TTgraxQpyJVNTuJ+xBdbJyI1QVNNsQvjXLLRb81ge26RH2REKWqmGE9amTa4Gvds5wZHud/tno2rcOQYTcaI+9/icQqwW7qism/3kSw+1qQFF+qs9AMVAQb7o16Zcy/OgYaYZCOBmQYyAcUUjfj9x0+dYXEp98V2+/ew3Xqc40pJCJ8Dgaru/Kg3jqsJuDtUe0HBhjC3wOCaMfQcR0kMtRFBFDaoHiPolM8gMa43peyAMEM7Tf4AclS9gme3mNcc162481VvVFx+FEus33l6PDkrYhmFs1juDyHUt0IL3LAFi92GJFIYGR/r8yUYRmMGPdsdjo5dl8snabV5Z+IXy7M1RHZ7/X2oIfz5cDTNUIiIBBcMyERm5JmLhJqad3+GVXUOcn5MgVOmPM/klpaj1qh3igAb4m0BT8y9e1yh0uXB/tkiLuGdLlIreWt2m9kyNOYvw0uXor5S8tcHIaRSYUSlpl0yMtixutWZ3zmL+XY+8ZSWlXZsWOzq0TTv+1eMHEVutPWN3G1sWfRelXBIvfWWRMUGg15k2RnbKkRiAIsgwPardabsmWUdX8wl4YODwEE7iOUblcH1/uZMXn3uMYFkGF6G1org8Lu9R2nE+/UFFGmMAxpwK/SvmJ4O9zuQbBj1+gxSef6yWCqbETYDr4yV8hgDNQuwf6ZImqLZwY2406VuuSKMAd2JxckmuOT5zwIobo7K4FJMGO4Yrf3/v0uq48ZokJONSvDDUyWFCf1/6BFGwj2ngMJzWEUBgga1uuJnAKBhr7xyDL1UjG7f0Cy+J9SIv14slyJm69UONqVuRLtNdNlqH+7QGEDWyy9BJuvdPqepsK9pfGwRdX63WNBqm9rEzbJyb3putD0tu1uh9aw5EyZSk/0j1F4QKJuEgMsGFpJVg4itJC3djeNzWVpWRG+bmqooBzfRQQ2Cy//BwGMWcu/d+2YbROOrh5MoDHDt7RGRA+YrjWzy3uRDBgCk9K1NPjGD1PnXBmEx2m8C13/EsHEjWtFlBsodgZAcp0k9FtwJI+lZrGgFIQ+/T8sgALvICLsMjw9wps8ZywO+svYPZWaR/sAlgZOO3J+NA5T9SQuR91k93f3BnBe+totiwLtnnkab8eKzbZ6vBE0sqlS152UF/7huhEWfbexymuZfomQ45s4le0MkHeOZZFiQoZOP52A66k9gi2rPbe31aH6ukgezZwHwo/NJH1vvTfiTxXSk8EB68FlMxskcw4gtAEVLqnF4WBwIiP4uLNLRko2x/NpAu80K56BCSzvhXCh6TQW1seamP56PwwicCGSjgw01O4Zk4t2rvti+uL0rXg0MxFTuHJ+iYzBIoXCSKAuVeIfM62eSF6lkoBeS7dE/TmbHhjCTgvOS7b3jYH1jadhj6VF0D6kJColAK7fOPAwvfgEz4n+bWdh15w8djYQ3RPmpXpkCfcUgrsuzmwqzdacZyCv0+P+kK/y31oxuBEQq8OeXLo9dOe+4oDkNNpjkOg82wDgtW3bPmv7rHXWtm3btm3btm3btvnu8818nV7JTH+00+S+06ST8bftGX+H2BWobzmv61s2okni7CU5EmrK4kvEA0O5f3YxGLlztyP9aRT8o80IAGk1msKlg3w371pZNfjfUy35LaSujnP2baotIjWu2tkTi/WnDhhScUW5Nzurd1in7lR70xY3zgprZOyIpjJ6qnngEmYPp/9K+3FZYY3fWMKW7UdfzCdSqyfEREWcJg/WdtQ9i3Ce3ZvqQG4vBPzuZXOdI8ExMEd6BjJzth6suv8trMPWDaqV3LFeOrI9V+dfk1/gOmw1FIQYqGc4cgbHbAv+AY4ERu93zrON9dtX3Ye4dOEBd9R7yh1an5PTavxu/JLKzwytqnFUb75IwXdSj27ZquPZtpJgjT91WwKAW+026orbR3HfbmbigMex5xIEZWsGACz9+KyK4E+MItbXc99bjGfFWtsLqujp4BPHPdlIgl0nnDHmQqZgAerASHIBIDecVHoB6D8UHXAtj9MjCDNf7AG96h10pHiJGePGSmstJ8wfFRZCKgWf4pmCUw3j/Ebgb/2rjLt87gfNeminOGnRrh2VRtNMGGk2PTupNmMO91OH19HQXBNjflTBcVx9VAhXvZgLBobLGkcTwvtoCMZAGVxjuuImCLrRMJY4SiABLFx2hIYOwvkdCAFFy8EhcZjPtevlaePh3iQsQ5lQ6IHUvlFTSNWsnd3e3L3dnUPhV4Oq36h+OWT7dBOOluJNG2HG9b5P877duKUeVWeKPZCb7CUh9DT6NiPbbr90SjgLGEdoMrZHdIWJln0lpSZ7dn2XkxxJ9c69ob1CSOvwyCAvZ8uZF8B9Ug7s7u8A66lad2KcIWMWCd2Szh143oBegTuaeJsxfYajYtRYm7jqDp9XTlV7AlhqoVnDCO+EpriCxqSbD0LZst2cBXYOeOMYqA48Q+TeEHWogXmESsTYd42gTSJKVpNpToJ0lxid678KfDgA/5NiGUXtMIe+5964KGcX8Be07uhbCxkUhNheBtzKxuZCXxJheu5Vrbkr5mBygSCZkbEU5pTk2HEFqcixxx6Nbr4mXuyOFlESauCBr600spa5QDpp7bnTYkOHnMZeXhhLxRflzRcBAtufqF/QK6GBbreqwBO4sluYzOzhI4cEoFQZDgS3vqWam22XX0zFggJn71K2K8F4OOLxENnIfavfOscMFRod3IR66IUlduoZPgTbeGw7JKiLhf92Z3JIleZje6bOrtipS+tKa7QX0GHlBlQGjA6rbGJ6Qt7EIBNVhO5i8LnFx12kWIJZB4gaogxesLt/MQ6MRXgVuHuBqYX362RGTwMVKlsGyubEAbNvlrlaUM0QeUSVigpmX1I4mzwMT6+KahmV6ebSxjVHi+/AvOYWBZG2T1JivYv+iRKe6l3K8Y2AodPShzTlr9YKatEDGxaMvZwdwj2UopdV1to/CyrYAi06tJ4284GP0Ytq2K6dOMrYRA8OEPsn3GzUPT9o/GAQ9p2Fdg1kwCHTFItJAwXNhhRcOBZMpm8JC+DeUWYC4Xwik1sA6ez0csduHuOhdBm7E1KZ77vJnWNKzQKgRydM1pfsfbGW2fHt5DuvArIBzhGxbd+EslizDApPJToHrp62szui53TADrXvHg07SBwS9YXdG4wXt13nvpjHQEbdA3w0ku9jRb4K9Keshym6vRK4mqr+CYuiOWwXP8YBDic/K04ZDP3Il+VklW48UzmJBUrd43HC8omXhoid01INAWmm435Vagxf0lApOAo95Xwgk2wwP4IZwGgLVBOz3O0HjhjBNEozhgCoAt75RNUsPSGeraHkinwfms0LNSPLAGlwH7gVbC2Dw1raBy7c23Mopvmu608Jd/oL6+sXt7Fovnqyhlg9sXPePcOgjxQQ0lrI7wiL69bP2BNe2LaAXJsitr2eydisGsV/GlxUQY5Qnd3gxozGBdf+XhMS2zVqxFBkZSF04QbPD6j0KX0e9rEiyxE0C0/y6hp1cP5OnAMsPm46pr0LM4aF6x/dGNW9ZMVmRtUtm22yhMenVMjVXoK5Lc4ax++n31G0dY59xeBaPOpUTEd6KX7EvisqxsUeUREc662XsVjScPzVgxzu515SsV/cEKJdFjW5B28jhoojdH8iYnLUWP4+1N35m2Wfg7K/XnYDYGWPW/1JjS5rWagCQ+PRgngYpo16/Qy4uQiMO7nXpU50NAhDmMD4xyX7t9ZkIDhFLybU4pZ4bLKMK2dSwxlTUtFE7y2ZGOWD4IMu29p4iRfralAEQPrjyikrmBW7OzlsCnFDPYA4u7eVFV2cl4Corjx+RRJASoz5KLVketoL6HfG5Mj5wlac/iN/WNJ3k8of42Jlqu25/o/yXhLXWRSmM3RGKP2V2jYILAoJt45FO9esYu2VhxyHra96g1Tff+LrvO88mjUBAvAUV26H0c/90rj0TGKjI1mSkWJpzV9HMhVA9MphzmwctnmbEfd7G4LLwiMEfjN9VWTdQvkuNOSFc/nuD67wTyvf7nl82ol5qFI+Y1F0K0HKNTp1nBHmvncm/VwKq6K3xaxDr7kDl3J9ATBMdiZlJ0RLgC3MVIeO3b1Ce5Jhe2r5IlY1Lprlzh5gqhal8yQEOSyJVh8qqfMzu8COiXEokeDu1aJkLgvIpWVHzGQ6V++e7mVOKMS4rLWRbM1dh13HVck/CChQOg+1Y8YUMrCwsEJglW4mrFV/Z/2JDqbTH8vFlsn1ygv1nkfqXVXid5t0Z0kQPalhozuYYV2ztdCM2RgesWdQSFiCpDDudCdN3Zj0OxVwg5KkYMrLaieXa6uenCZ26XHbxuTLmV1iyuH63HmXtEekZv3N6IdnFuv9+teIeX2rfZvv0+3IxBTWwpt5sLfpcSNfIsaYul7NT42/xjbGN9n7UUlLEAtyrXiwab3zMUXCNxwYQ3WnBjAIeWnHe9uT6dp1M0VzapZ+P2ABPrHFGfaIVJcttbV7crs2C23xZfXJoH9qxdWZdjDkIaW2A8ahVzTrlWqSanPmfkYzOOhv4rUwwZ2NcbVKdHuZ406sk9BwLAOFwcE6lkpq5dCoUt5UDSPK6g0jgsT7y1BTS/G61vgUdGAJQqxsa325sTSQ7YbnpUy6FPyiTy7W+o8ObsfZ3RB4YZpXsiDPgX1EZhxrEkGjbWWr5fGhOVd3A6uiXktaCLw5+w+7ELuArG2yQT3zlG9tV8ohmz7CKC36weZgiGTV7/PHTOnbWx1v7uHV/EkV1IUDru8oBIDEXkvUFWKm3xH9fJ6VbbIOJNF44DzIFBHG8QHgUfQ4JXS9wyDXYNb2oUDxDXi2Mkh/2HdSbsPnnfCNN8edlj191B3IRoqP95RfuTGKnQuinvPWBx0Xr49haE/8kr4t402KKHvJZr1iPtg5nQZwIsa+c4vTErCewK4QJ9AEehCvIc++p334on5UVZ9EgbyWqeP044uR77RdOZqm4V8erCEAiVdejIDLQfGJ/ALmsmrNvcn6b7AqVNd/ihfL0zu3T81HzqjEYKmJzG9WTF3w3CMCM7gkp8X4Og9O+oQj/7koyJYi1A2mJ2nLfigO3mySj1aqr7T9XOwVHzUmwvqfxiUEFcMmrdTCaeOCOmhoZ9tlA05+FE6Axv8Jcscc3/GHX9RbprD9o/yXziLBgzNHd+H+pAwfVzd54a62lGWGAo2DM3mUULOb4qppwQxWqWxCwIXDGDbKjP++QS06G/OHJYRbe315lwKz2ksKVTD3ijFx2MpBnw8mP/YCXk+rz+J0gsvpmHhYLVk+xR/8ZU0TDZBxGgW5Vv4vlpz+Zyy3CzBSojga5DI8f6eJJZI+yjBi/pHdctrbpgGTmEM2QJC1IZnSABcO/Z9MlUNN650WjGMO8w87iafNnpUICDBKoAHPvoAz7yA8W33YAN+MvFRbXIhxZetPILnmBElWLGeWP3aZCtDPlmilXRh6zXqW6SJO3CRGZHFaMgh6gReS0KtM9+ewTULEfIMfTvXfYwdbo3ZZj6bu5YcTpVTbc+EKjbdSTQPvIhFskmhrqTqZByyhTV8if6zlV+QtL66vs8H9mFsTQWA2NuRnGaCuvF90niTqKcwD5zWrqpsBnHoJ+weQo5CdKxZORw8H+Wl01Ikegf6iVO8eK7Lm9IgLUMp7d9TW/rvwD/ZRrG8LVK+29M8UGVpgJLwF7wd+QbZn5ZQE71WlcNf/aw1Hu4cEbUyFvrmAqRisjdrvPgg0GR0Dv7OowJq8cPmVPXMo8w+GGz0lypha7ccLlFWlapeO47ox/qc9F479ESwUlP0pL6Y5FMvWos9iX2RPkmFqyYppF3TctWZHJpjZakEKSmAIQOicO5WRPK2WIWKRIWbK1JvJcSQUoMbF7erGJFxnVwcdli+qUAYNnLeOt+3iZgRaPG6TTglEETVRU97BmMB3qOTNFQ/7VirmyatIVT0KRRBoYF5CiFH51ss3l/McLJ7TMJLXXYWV/S/lPTgVOMva7mQh0ilIn0qZRiyUxLymjLvSaNPWYKYeH4S7/cq31rJT1mzVsCUo2ZZ3zn2mMAwKLvoQdaYc3ydJ8TTrPPvc/AbuB/B8HU0A34F3GGwoRoBmbNxlCvvq6LkvyaAwRwVuYPSXd4SSxaH0n/aIOsFTL43o/lFY4gUXYhFMwy/iTBliTlxe1eYdb54M3gG9G+m/iXezpY0+uUWqM1JDd1syNa4l1hQ7AKZlhtgf7kujBjUNByM0o543jknXA0NqnJRZOE5Luro0Wi3xsdgwoEaHWvVvhfs+LaDmzHY25Yfgkymkplfpu//iMxu21QSm9hlTCAu4FRL+ASFgovRdoLb1kgFa1DHDETMjQEe2pmS0zyvoQq43AGb1j9XAU/DDN8T4EDD85a2lUJSbFf9juwF3RAbyej7HGuC+mtH3xCIj1ZIGiwkca77Xj5pM6WbU8AKgKMZSIpCPRZIWkVIrlEa6VVF1Te4nNy8lAsabUOiraynnxKbRsLaROGtvgyqi6zUAPYOINVXLnhuqlLchanncng2vzuluKkieyDm/UD351j4px9Mjy9XNnrjoElr3xBY8eGuo1y5uKQSjUdDlAR1pQfYCPybIMrE09ndFzruTN/t4qH9s11UDzccx5L15ThePmr3np14pqHnPr+RQRe6UoStSdsgyxCEs8JmQ82hvWqUBqrGxd0Kw7gCvcPK2pcxPl9Ymq1GxeWxAOkrSgOkJGrbyvoyDMaZEmsV1S093VjQQtN9MnIEDrZUuu1/Nyqr4RZHZ03mIudxghCgWI9XSjyHqIbiify19VIwO67K+iAr/qpUgbASUmLnWAheQj2IXgsyP6ZKfiMWKFiQESVB8jI+M8VJPACb1c6rwIDk53aBjlZwloeACuugYGNqcr5NQAZooeGo/t0fPcUZ+EpROsho4CIB42kyLkde0n1SK4sKBopVIbYilPRZ/xc1TSVJPk890RM8hILJ9b75ABN9GKYiufKytT6oJfVp8OD3CoLFVf8VrUlHvT+4M/YsjwmSFZnfaYGSoLWogMuulH6m8Xvrx1Vx62gK7n7rb2hSkv8XscSe0kSbXDx5f6nK/nTCG1VwnyyrowuZzm8C/nYLGf1O+zyGCPWaEKRCsHLIktqOOXfWGxNJ+bcV9fHs=
*/