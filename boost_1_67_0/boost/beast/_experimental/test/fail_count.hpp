//
// Copyright (c) 2016-2019 Vinnie Falco (vinnie dot falco at gmail dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//
// Official repository: https://github.com/boostorg/beast
//

#ifndef BOOST_BEAST_TEST_FAIL_COUNT_HPP
#define BOOST_BEAST_TEST_FAIL_COUNT_HPP

#include <boost/beast/core/detail/config.hpp>
#include <boost/beast/_experimental/test/error.hpp>
#include <cstdlib>

namespace boost {
namespace beast {
namespace test {

/** A countdown to simulated failure

    On the Nth operation, the class will fail with the specified
    error code, or the default error code of @ref error::test_failure.

    Instances of this class may be used to build objects which
    are specifically designed to aid in writing unit tests, for
    interfaces which can throw exceptions or return `error_code`
    values representing failure.
*/
class fail_count
{
    std::size_t n_;
    std::size_t i_ = 0;
    error_code ec_;

public:
    fail_count(fail_count&&) = default;

    /** Construct a counter

        @param n The 0-based index of the operation to fail on or after
        @param ev An optional error code to use when generating a simulated failure
    */
    BOOST_BEAST_DECL
    explicit
    fail_count(
        std::size_t n,
        error_code ev = error::test_failure);

    /// Throw an exception on the Nth failure
    BOOST_BEAST_DECL
    void
    fail();

    /// Set an error code on the Nth failure
    BOOST_BEAST_DECL
    bool
    fail(error_code& ec);
};

} // test
} // beast
} // boost

#ifdef BOOST_BEAST_HEADER_ONLY
#include <boost/beast/_experimental/test/impl/fail_count.ipp>
#endif

#endif

/* fail_count.hpp
+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
*/