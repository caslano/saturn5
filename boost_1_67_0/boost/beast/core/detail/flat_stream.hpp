//
// Copyright (c) 2016-2019 Vinnie Falco (vinnie dot falco at gmail dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//
// Official repository: https://github.com/boostorg/beast
//

#ifndef BOOST_BEAST_CORE_DETAIL_FLAT_STREAM_HPP
#define BOOST_BEAST_CORE_DETAIL_FLAT_STREAM_HPP

#include <boost/beast/core/buffer_traits.hpp>
#include <boost/asio/buffer.hpp>
#include <cstdlib>

namespace boost {
namespace beast {
namespace detail {

class flat_stream_base
{
public:
    // Largest buffer size we will flatten.
    // 16KB is the upper limit on reasonably sized HTTP messages.
    static std::size_t constexpr max_size = 16 * 1024;

    // Largest stack we will use to flatten
    static std::size_t constexpr max_stack = 8 * 1024;

    struct flatten_result
    {
        std::size_t size;
        bool flatten;
    };

    // calculates the flatten settings for a buffer sequence
    template<class BufferSequence>
    static
    flatten_result
    flatten(
        BufferSequence const& buffers, std::size_t limit)
    {
        flatten_result result{0, false};
        auto first = net::buffer_sequence_begin(buffers);
        auto last = net::buffer_sequence_end(buffers);
        if(first != last)
        {
            result.size = buffer_bytes(*first);
            if(result.size < limit)
            {
                auto it = first;
                auto prev = first;
                while(++it != last)
                {
                    auto const n = buffer_bytes(*it);
                    if(result.size + n > limit)
                        break;
                    result.size += n;
                    prev = it;
                }
                result.flatten = prev != first;
            }
        }
        return result;
    }
};

} // detail
} // beast
} // boost

#endif

/* flat_stream.hpp
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
*/