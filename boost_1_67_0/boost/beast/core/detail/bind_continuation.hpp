//
// Copyright (c) 2016-2019 Vinnie Falco (vinnie dot falco at gmail dot com)
//
// Distributed under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//
// Official repository: https://github.com/boostorg/beast
//

#ifndef BOOST_BEAST_DETAIL_BIND_CONTINUATION_HPP
#define BOOST_BEAST_DETAIL_BIND_CONTINUATION_HPP

#include <boost/beast/core/detail/config.hpp>
#include <boost/beast/core/detail/remap_post_to_defer.hpp>
#include <boost/asio/bind_executor.hpp>
#include <boost/core/empty_value.hpp>
#include <type_traits>
#include <utility>

namespace boost {
namespace beast {
namespace detail {

#if 0
/** Mark a completion handler as a continuation.

    This function wraps a completion handler to associate it with an
    executor whose `post` operation is remapped to the `defer` operation.
    It is used by composed asynchronous operation implementations to
    indicate that a completion handler submitted to an initiating
    function represents a continuation of the current asynchronous
    flow of control.

    @param handler The handler to wrap.
    The implementation takes ownership of the handler by performing a decay-copy.

    @see

    @li <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4242.html">[N4242] Executors and Asynchronous Operations, Revision 1</a>
*/
template<class CompletionHandler>
#if BOOST_BEAST_DOXYGEN
__implementation_defined__
#else
net::executor_binder<
    typename std::decay<CompletionHandler>::type,
    detail::remap_post_to_defer<
        net::associated_executor_t<CompletionHandler>>>
#endif
bind_continuation(CompletionHandler&& handler)
{
    return net::bind_executor(
        detail::remap_post_to_defer<
            net::associated_executor_t<CompletionHandler>>(
                net::get_associated_executor(handler)),
        std::forward<CompletionHandler>(handler));
}

/** Mark a completion handler as a continuation.

    This function wraps a completion handler to associate it with an
    executor whose `post` operation is remapped to the `defer` operation.
    It is used by composed asynchronous operation implementations to
    indicate that a completion handler submitted to an initiating
    function represents a continuation of the current asynchronous
    flow of control.

    @param ex The executor to use

    @param handler The handler to wrap
    The implementation takes ownership of the handler by performing a decay-copy.

    @see

    @li <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4242.html">[N4242] Executors and Asynchronous Operations, Revision 1</a>
*/
template<class Executor, class CompletionHandler>
#if BOOST_BEAST_DOXYGEN
__implementation_defined__
#else
net::executor_binder<typename
    std::decay<CompletionHandler>::type,
    detail::remap_post_to_defer<Executor>>
#endif
bind_continuation(
    Executor const& ex, CompletionHandler&& handler)
{
    return net::bind_executor(
        detail::remap_post_to_defer<Executor>(ex),
        std::forward<CompletionHandler>(handler));
}
#else
// VFALCO I turned these off at the last minute because they cause
//        the completion handler to be moved before the initiating
//        function is invoked rather than after, which is a foot-gun.
//
// REMINDER: Uncomment the tests when this is put back
template<class F>
F&&
bind_continuation(F&& f)
{
    return std::forward<F>(f);
}
#endif

} // detail
} // beast
} // boost

#endif

/* bind_continuation.hpp
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
*/