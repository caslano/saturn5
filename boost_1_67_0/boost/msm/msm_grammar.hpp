// Copyright 2008 Christophe Henry
// henry UNDERSCORE christophe AT hotmail DOT com
// This is an extended version of the state machine available in the boost::mpl library
// Distributed under the same license as the original.
// Copyright for the original version:
// Copyright 2005 David Abrahams and Aleksey Gurtovoy. Distributed
// under the Boost Software License, Version 1.0. (See accompanying
// file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_MSM_GRAMMAR_H
#define BOOST_MSM_GRAMMAR_H

#include <boost/proto/core.hpp>
#include <boost/msm/common.hpp>


namespace boost { namespace msm
{
// base grammar for all of msm's proto-based grammars
struct basic_grammar : proto::_
{};

// Forward-declare an expression wrapper
template<typename Expr>
struct msm_terminal;

struct msm_domain
    : proto::domain< proto::generator<msm_terminal>, basic_grammar >
{};

template<typename Expr>
struct msm_terminal
    : proto::extends<Expr, msm_terminal<Expr>, msm_domain>
{
    typedef
        proto::extends<Expr, msm_terminal<Expr>, msm_domain>
        base_type;
    // Needs a constructor
    msm_terminal(Expr const &e = Expr())
        : base_type(e)
    {}
};

// grammar forbidding address of for terminals
struct terminal_grammar : proto::not_<proto::address_of<proto::_> >
{};

// Forward-declare an expression wrapper
template<typename Expr>
struct euml_terminal;

struct sm_domain
    : proto::domain< proto::generator<euml_terminal>, terminal_grammar, boost::msm::msm_domain >
{};

struct state_grammar : 
    proto::and_<
        proto::not_<proto::address_of<proto::_> >,
        proto::not_<proto::shift_right<proto::_,proto::_> >,
        proto::not_<proto::shift_left<proto::_,proto::_> >,
        proto::not_<proto::bitwise_and<proto::_,proto::_> >
    >
{};
struct state_domain
    : proto::domain< proto::generator<euml_terminal>, boost::msm::state_grammar,boost::msm::sm_domain >
{};

template<typename Expr>
struct euml_terminal
    : proto::extends<Expr, euml_terminal<Expr>, boost::msm::sm_domain>
{
    typedef
        proto::extends<Expr, euml_terminal<Expr>, boost::msm::sm_domain>
        base_type;
    // Needs a constructor
    euml_terminal(Expr const &e = Expr())
        : base_type(e)
    {}
    // Unhide Proto's overloaded assignment operator
    using base_type::operator=;
};

} } // boost::msm
#endif //BOOST_MSM_GRAMMAR_H


/* msm_grammar.hpp
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
*/