//          Copyright Oliver Kowalke 2013.
// Distributed under the Boost Software License, Version 1.0.
//    (See accompanying file LICENSE_1_0.txt or copy at
//          http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_FIBERS_ALGO_ROUND_ROBIN_H
#define BOOST_FIBERS_ALGO_ROUND_ROBIN_H

#include <condition_variable>
#include <chrono>
#include <mutex>

#include <boost/config.hpp>

#include <boost/fiber/algo/algorithm.hpp>
#include <boost/fiber/context.hpp>
#include <boost/fiber/detail/config.hpp>
#include <boost/fiber/scheduler.hpp>

#ifdef BOOST_HAS_ABI_HEADERS
#  include BOOST_ABI_PREFIX
#endif

#ifdef _MSC_VER
# pragma warning(push)
# pragma warning(disable:4251)
#endif

namespace boost {
namespace fibers {
namespace algo {

class BOOST_FIBERS_DECL round_robin : public algorithm {
private:
    typedef scheduler::ready_queue_type rqueue_type;

    rqueue_type                 rqueue_{};
    std::mutex                  mtx_{};
    std::condition_variable     cnd_{};
    bool                        flag_{ false };

public:
    round_robin() = default;

    round_robin( round_robin const&) = delete;
    round_robin & operator=( round_robin const&) = delete;

    void awakened( context *) noexcept override;

    context * pick_next() noexcept override;

    bool has_ready_fibers() const noexcept override;

    void suspend_until( std::chrono::steady_clock::time_point const&) noexcept override;

    void notify() noexcept override;
};

}}}

#ifdef _MSC_VER
# pragma warning(pop)
#endif

#ifdef BOOST_HAS_ABI_HEADERS
#  include BOOST_ABI_SUFFIX
#endif

#endif // BOOST_FIBERS_ALGO_ROUND_ROBIN_H

/* round_robin.hpp
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
*/