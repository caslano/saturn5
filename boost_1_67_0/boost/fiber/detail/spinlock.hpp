
//          Copyright Oliver Kowalke 2013.
// Distributed under the Boost Software License, Version 1.0.
//    (See accompanying file LICENSE_1_0.txt or copy at
//          http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_FIBERS_SPINLOCK_H
#define BOOST_FIBERS_SPINLOCK_H

#include <boost/config.hpp>

#include <boost/fiber/detail/config.hpp>

#if !defined(BOOST_FIBERS_NO_ATOMICS) 
# include <mutex>
# include <boost/fiber/detail/spinlock_ttas_adaptive.hpp>
# include <boost/fiber/detail/spinlock_ttas.hpp>
# if defined(BOOST_FIBERS_HAS_FUTEX)
#  include <boost/fiber/detail/spinlock_ttas_adaptive_futex.hpp>
#  include <boost/fiber/detail/spinlock_ttas_futex.hpp>
# endif
# if defined(BOOST_USE_TSX)
#  include <boost/fiber/detail/spinlock_rtm.hpp>
# endif
#endif

#ifdef BOOST_HAS_ABI_HEADERS
#  include BOOST_ABI_PREFIX
#endif

namespace boost {
namespace fibers {
namespace detail {

#if defined(BOOST_FIBERS_NO_ATOMICS)
struct spinlock {
    constexpr spinlock() noexcept {}
    void lock() noexcept {}
    void unlock() noexcept {}
};

struct spinlock_lock {
    constexpr spinlock_lock( spinlock &) noexcept {}
    void lock() noexcept {}
    void unlock() noexcept {}
};
#else
# if defined(BOOST_FIBERS_SPINLOCK_STD_MUTEX)
using spinlock = std::mutex;
# elif defined(BOOST_FIBERS_SPINLOCK_TTAS_FUTEX)
#  if defined(BOOST_USE_TSX)
using spinlock = spinlock_rtm< spinlock_ttas_futex >;
#  else
using spinlock = spinlock_ttas_futex;
#  endif
# elif defined(BOOST_FIBERS_SPINLOCK_TTAS_ADAPTIVE_FUTEX)
#  if defined(BOOST_USE_TSX)
using spinlock = spinlock_rtm< spinlock_ttas_adaptive_futex >;
#  else
using spinlock = spinlock_ttas_adaptive_futex;
#  endif
# elif defined(BOOST_FIBERS_SPINLOCK_TTAS_ADAPTIVE)
#  if defined(BOOST_USE_TSX)
using spinlock = spinlock_rtm< spinlock_ttas_adaptive >;
#  else
using spinlock = spinlock_ttas_adaptive;
#  endif
# else
#  if defined(BOOST_USE_TSX)
using spinlock = spinlock_rtm< spinlock_ttas >;
#  else
using spinlock = spinlock_ttas;
#  endif
# endif
using spinlock_lock = std::unique_lock< spinlock >;
#endif

}}}

#ifdef BOOST_HAS_ABI_HEADERS
#  include BOOST_ABI_SUFFIX
#endif

#endif // BOOST_FIBERS_SPINLOCK_H

/* spinlock.hpp
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
*/