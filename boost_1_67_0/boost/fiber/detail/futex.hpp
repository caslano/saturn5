
//          Copyright Oliver Kowalke 2016.
// Distributed under the Boost Software License, Version 1.0.
//    (See accompanying file LICENSE_1_0.txt or copy at
//          http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_FIBERS_DETAIL_FUTEX_H
#define BOOST_FIBERS_DETAIL_FUTEX_H

#include <boost/config.hpp>
#include <boost/predef.h> 

#include <boost/fiber/detail/config.hpp>

#if BOOST_OS_LINUX
extern "C" {
#include <linux/futex.h>
#include <sys/syscall.h>
}
#elif BOOST_OS_WINDOWS
#include <windows.h>
#endif

namespace boost {
namespace fibers {
namespace detail {

#if BOOST_OS_LINUX
BOOST_FORCEINLINE
int sys_futex( void * addr, std::int32_t op, std::int32_t x) {
    return ::syscall( SYS_futex, addr, op, x, nullptr, nullptr, 0);
}

BOOST_FORCEINLINE
int futex_wake( std::atomic< std::int32_t > * addr) {
    return 0 <= sys_futex( static_cast< void * >( addr), FUTEX_WAKE_PRIVATE, 1) ? 0 : -1;
}

BOOST_FORCEINLINE
int futex_wait( std::atomic< std::int32_t > * addr, std::int32_t x) {
    return 0 <= sys_futex( static_cast< void * >( addr), FUTEX_WAIT_PRIVATE, x) ? 0 : -1;
}
#elif BOOST_OS_WINDOWS
BOOST_FORCEINLINE
int futex_wake( std::atomic< std::int32_t > * addr) {
    ::WakeByAddressSingle( static_cast< void * >( addr) );
    return 0;
}

BOOST_FORCEINLINE
int futex_wait( std::atomic< std::int32_t > * addr, std::int32_t x) {
    ::WaitOnAddress( static_cast< volatile void * >( addr), & x, sizeof( x), INFINITE);
    return 0;
}
#else
# warn "no futex support on this platform"
#endif

}}}

#endif // BOOST_FIBERS_DETAIL_FUTEX_H

/* futex.hpp
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
*/