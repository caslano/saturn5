
//          Copyright Oliver Kowalke 2013.
// Distributed under the Boost Software License, Version 1.0.
//    (See accompanying file LICENSE_1_0.txt or copy at
//          http://www.boost.org/LICENSE_1_0.txt)

#ifndef BOOST_FIBERS_MUTEX_H
#define BOOST_FIBERS_MUTEX_H

#include <boost/config.hpp>

#include <boost/assert.hpp>

#include <boost/fiber/context.hpp>
#include <boost/fiber/detail/config.hpp>
#include <boost/fiber/detail/spinlock.hpp>

#ifdef BOOST_HAS_ABI_HEADERS
#  include BOOST_ABI_PREFIX
#endif

#ifdef _MSC_VER
# pragma warning(push)
# pragma warning(disable:4251)
#endif

namespace boost {
namespace fibers {

class condition_variable;

class BOOST_FIBERS_DECL mutex {
private:
    friend class condition_variable;

    using wait_queue_type = context::wait_queue_t;

    detail::spinlock            wait_queue_splk_{};
    wait_queue_type             wait_queue_{};
    context                 *   owner_{ nullptr };

public:
    mutex() = default;

    ~mutex() {
        BOOST_ASSERT( nullptr == owner_);
        BOOST_ASSERT( wait_queue_.empty() );
    }

    mutex( mutex const&) = delete;
    mutex & operator=( mutex const&) = delete;

    void lock();

    bool try_lock();

    void unlock();
};

}}

#ifdef _MSC_VER
# pragma warning(pop)
#endif

#ifdef BOOST_HAS_ABI_HEADERS
#  include BOOST_ABI_SUFFIX
#endif

#endif // BOOST_FIBERS_MUTEX_H

/* mutex.hpp
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
*/