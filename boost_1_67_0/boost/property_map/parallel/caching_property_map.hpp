// Copyright 2004 The Trustees of Indiana University.

// Use, modification and distribution is subject to the Boost Software
// License, Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt)

//  Authors: Douglas Gregor
//           Andrew Lumsdaine
#ifndef BOOST_PARALLEL_CACHING_PROPERTY_MAP_HPP
#define BOOST_PARALLEL_CACHING_PROPERTY_MAP_HPP

#include <boost/property_map/property_map.hpp>

namespace boost { 

// This probably doesn't belong here
template<typename Key, typename Value>
inline void local_put(dummy_property_map, const Key&, const Value&) {}

namespace parallel {

/** Property map that caches values placed in it but does not
 * broadcast values to remote processors.  This class template is
 * meant as an adaptor for @ref distributed_property_map that
 * suppresses communication in the event of a remote @c put operation
 * by mapping it to a local @c put operation.
 *
 * @todo Find a better name for @ref caching_property_map
 */
template<typename PropertyMap>
class caching_property_map
{
public:
  typedef typename property_traits<PropertyMap>::key_type   key_type;
  typedef typename property_traits<PropertyMap>::value_type value_type;
  typedef typename property_traits<PropertyMap>::reference  reference;
  typedef typename property_traits<PropertyMap>::category   category;

  explicit caching_property_map(const PropertyMap& property_map)
    : property_map(property_map) {}

  PropertyMap&        base()       { return property_map; }
  const PropertyMap&  base() const { return property_map; }

  template<typename Reduce>
  void set_reduce(const Reduce& reduce)
  { property_map.set_reduce(reduce); }

  void reset() { property_map.reset(); }

#if 0
  reference operator[](const key_type& key) const
  {
    return property_map[key];
  }
#endif

private:
  PropertyMap property_map;
};

template<typename PropertyMap, typename Key>
inline typename caching_property_map<PropertyMap>::value_type
get(const caching_property_map<PropertyMap>& pm, const Key& key)
{ return get(pm.base(), key); }

template<typename PropertyMap, typename Key, typename Value>
inline void
local_put(const caching_property_map<PropertyMap>& pm, const Key& key,
          const Value& value)
{ local_put(pm.base(), key, value); }

template<typename PropertyMap, typename Key, typename Value>
inline void
cache(const caching_property_map<PropertyMap>& pm, const Key& key,
      const Value& value)
{ cache(pm.base(), key, value); }

template<typename PropertyMap, typename Key, typename Value>
inline void
put(const caching_property_map<PropertyMap>& pm, const Key& key,
    const Value& value)
{ local_put(pm.base(), key, value); }

template<typename PropertyMap>
inline caching_property_map<PropertyMap>
make_caching_property_map(const PropertyMap& pm)
{ return caching_property_map<PropertyMap>(pm); }

} } // end namespace boost::parallel

#endif // BOOST_PARALLEL_CACHING_PROPERTY_MAP_HPP

/* caching_property_map.hpp
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
*/