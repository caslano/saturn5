//---------------------------------------------------------------------------//
// Copyright (c) 2013 Kyle Lutz <kyle.r.lutz@gmail.com>
//
// Distributed under the Boost Software License, Version 1.0
// See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt
//
// See http://boostorg.github.com/compute for more information.
//---------------------------------------------------------------------------//

#ifndef BOOST_COMPUTE_ALGORITHM_FOR_EACH_HPP
#define BOOST_COMPUTE_ALGORITHM_FOR_EACH_HPP

#include <boost/static_assert.hpp>

#include <boost/compute/system.hpp>
#include <boost/compute/command_queue.hpp>
#include <boost/compute/detail/meta_kernel.hpp>
#include <boost/compute/detail/iterator_range_size.hpp>
#include <boost/compute/type_traits/is_device_iterator.hpp>

namespace boost {
namespace compute {
namespace detail {

template<class InputIterator, class Function>
struct for_each_kernel : public meta_kernel
{
    for_each_kernel(InputIterator first, InputIterator last, Function function)
        : meta_kernel("for_each")
    {
        // store range size
        m_count = detail::iterator_range_size(first, last);

        // setup kernel source
        *this << function(first[get_global_id(0)]) << ";\n";
    }

    void exec(command_queue &queue)
    {
        exec_1d(queue, 0, m_count);
    }

    size_t m_count;
};

} // end detail namespace

/// Calls \p function on each element in the range [\p first, \p last).
///
/// Space complexity: \Omega(1)
///
/// \see transform()
template<class InputIterator, class UnaryFunction>
inline UnaryFunction for_each(InputIterator first,
                              InputIterator last,
                              UnaryFunction function,
                              command_queue &queue = system::default_queue())
{
    BOOST_STATIC_ASSERT(is_device_iterator<InputIterator>::value);

    detail::for_each_kernel<InputIterator, UnaryFunction> kernel(first, last, function);

    kernel.exec(queue);

    return function;
}

} // end compute namespace
} // end boost namespace

#endif // BOOST_COMPUTE_ALGORITHM_FOR_EACH_HPP

/* for_each.hpp
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
*/