//---------------------------------------------------------------------------//
// Copyright (c) 2013 Kyle Lutz <kyle.r.lutz@gmail.com>
//
// Distributed under the Boost Software License, Version 1.0
// See accompanying file LICENSE_1_0.txt or copy at
// http://www.boost.org/LICENSE_1_0.txt
//
// See http://boostorg.github.com/compute for more information.
//---------------------------------------------------------------------------//

#ifndef BOOST_COMPUTE_ALGORITHM_INPLACE_MERGE_HPP
#define BOOST_COMPUTE_ALGORITHM_INPLACE_MERGE_HPP

#include <iterator>

#include <boost/static_assert.hpp>

#include <boost/compute/system.hpp>
#include <boost/compute/command_queue.hpp>
#include <boost/compute/algorithm/merge.hpp>
#include <boost/compute/container/vector.hpp>
#include <boost/compute/type_traits/is_device_iterator.hpp>

namespace boost {
namespace compute {

/// Merges the sorted values in the range [\p first, \p middle) with
/// the sorted values in the range [\p middle, \p last) in-place.
///
/// Space complexity: \Omega(n)
template<class Iterator>
inline void inplace_merge(Iterator first,
                          Iterator middle,
                          Iterator last,
                          command_queue &queue = system::default_queue())
{
    BOOST_STATIC_ASSERT(is_device_iterator<Iterator>::value);
    BOOST_ASSERT(first < middle && middle < last);

    typedef typename std::iterator_traits<Iterator>::value_type T;

    const context &context = queue.get_context();

    ptrdiff_t left_size = std::distance(first, middle);
    ptrdiff_t right_size = std::distance(middle, last);

    vector<T> left(left_size, context);
    vector<T> right(right_size, context);

    copy(first, middle, left.begin(), queue);
    copy(middle, last, right.begin(), queue);

    ::boost::compute::merge(
        left.begin(),
        left.end(),
        right.begin(),
        right.end(),
        first,
        queue
    );
}

} // end compute namespace
} // end boost namespace

#endif // BOOST_COMPUTE_ALGORITHM_INPLACE_MERGE_HPP

/* inplace_merge.hpp
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
*/