 //////////////////////////////////////////////////////////////////////////////
//
// (C) Copyright Ion Gaztanaga 2011-2012. Distributed under the Boost
// Software License, Version 1.0. (See accompanying file
// LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
//
// See http://www.boost.org/libs/interprocess for documentation.
//
//////////////////////////////////////////////////////////////////////////////

#ifndef BOOST_INTERPROCESS_DETAIL_WINAPI_WRAPPER_COMMON_HPP
#define BOOST_INTERPROCESS_DETAIL_WINAPI_WRAPPER_COMMON_HPP

#ifndef BOOST_CONFIG_HPP
#  include <boost/config.hpp>
#endif
#
#if defined(BOOST_HAS_PRAGMA_ONCE)
#  pragma once
#endif

#include <boost/interprocess/detail/config_begin.hpp>
#include <boost/interprocess/detail/workaround.hpp>
#include <boost/interprocess/detail/win32_api.hpp>
#include <boost/interprocess/detail/posix_time_types_wrk.hpp>
#include <boost/interprocess/errors.hpp>
#include <boost/interprocess/exceptions.hpp>
#include <limits>

namespace boost {
namespace interprocess {
namespace ipcdetail {

inline bool winapi_wrapper_timed_wait_for_single_object(void *handle, const boost::posix_time::ptime &abs_time);
 
inline void winapi_wrapper_wait_for_single_object(void *handle)
{
   winapi_wrapper_timed_wait_for_single_object(handle, boost::posix_time::pos_infin);
}

inline bool winapi_wrapper_try_wait_for_single_object(void *handle)
{
   return winapi_wrapper_timed_wait_for_single_object(handle, boost::posix_time::min_date_time);
}

inline bool winapi_wrapper_timed_wait_for_single_object(void *handle, const boost::posix_time::ptime &abs_time)
{
   const boost::posix_time::ptime cur_time = microsec_clock::universal_time();
   //Windows uses relative wait times so check for negative waits
   //and implement as 0 wait to allow try-semantics as POSIX mandates.
   unsigned long time = 0u;
   if (abs_time == boost::posix_time::pos_infin){
      time = winapi::infinite_time;
   }
   else if(abs_time > cur_time){
      time = (abs_time - cur_time).total_milliseconds();
   }

   unsigned long ret = winapi::wait_for_single_object(handle, time);
   if(ret == winapi::wait_object_0){
      return true;
   }
   else if(ret == winapi::wait_timeout){
      return false;
   }
   else if(ret == winapi::wait_abandoned){ //Special case for orphaned mutexes
      winapi::release_mutex(handle);
      throw interprocess_exception(owner_dead_error);
   }
   else{
      error_info err = system_error_code();
      throw interprocess_exception(err);
   }
}

}  //namespace ipcdetail {
}  //namespace interprocess {
}  //namespace boost {

#include <boost/interprocess/detail/config_end.hpp>

#endif   //BOOST_INTERPROCESS_DETAIL_WINAPI_WRAPPER_COMMON_HPP

/* winapi_wrapper_common.hpp
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
*/